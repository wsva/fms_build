module.exports=[65344,a=>{"use strict";a.s(["default",()=>z],65344);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(60955),f=a.i(95032),g=a.i(18745),h=a.i(27700),i=a.i(13046),j=a.i(75090),k=a.i(84476),l=a.i(47977);class m{init_status="error";init_error="not initialized";position=0;start_time="";end_time="";start_ms=0;end_ms=0;extend_start_ms=0;extend_end_ms=0;content_list=[];translation_list=[];constructor(a,b){if(a.length<2){this.init_error="too few lines";return}if(!a[0].match(/^\d+$/)){this.init_error=`invalid position number: ${a[0]}`;return}let c=o(a[1]);if(!c){this.init_error=`invalid time format: ${a[1]}`;return}this.init_status="success",this.init_error="",this.position=parseInt(a[0]),this.start_time=c.start_time,this.start_ms=c.start_ms,this.end_time=c.end_time,this.end_ms=c.end_ms,b?(a.length>2&&this.content_list.push(this.cleanStyle(a[2])),a.length>3&&a.slice(3).forEach(a=>this.translation_list.push(this.cleanStyle(a)))):a.length>2&&a.slice(2).forEach(a=>this.content_list.push(this.cleanStyle(a)))}append(a){this.end_time=a.end_time,this.end_ms=a.end_ms,this.content_list.push(...a.content_list),this.translation_list.push(...a.translation_list)}playMedia(a,b){a.paused||a.pause();let c=b?this.extend_start_ms:this.start_ms,d=b?this.extend_end_ms:this.end_ms;a.currentTime=c/1e3,a.play();let e=setTimeout(()=>{a.removeEventListener("pause",f),a.pause()},d-c);function f(){clearTimeout(e)}a.addEventListener("pause",f)}getTip(){let a=this.content_list.join(" ").replaceAll(/[a-zA-Z0-9äÄöÖüÜßé]/g,"_"),b=0,c="";for(let d of a)"_"===d?b++:b>0&&(c+=`${b}`,b=0),c+=d;return b>0&&(c+=`${b}`),c}cleanStyle(a){return a.replace(/<font[^>]*>/g,"").replace(/<\/font>/g,"")}content(){return this.content_list.join(" ")}translation(){return this.translation_list.join("\n")}first_line(){return this.content_list.length>0?this.content_list[0]:""}last_line(){return this.content_list.length>0?this.content_list[this.content_list.length-1]:""}time_str(){return`${this.start_time} --> ${this.end_time}`}}let n=(a,b,c,d)=>36e5*parseInt(a)+6e4*parseInt(b)+1e3*parseInt(c)+parseInt(d),o=a=>{let b=a.match(/((\d{2}):(\d{2}):(\d{2}),(\d{3})) --> ((\d{2}):(\d{2}):(\d{2}),(\d{3}))/);return b?{start_time:b[1],start_ms:n(b[2],b[3],b[4],b[5]),end_time:b[6],end_ms:n(b[7],b[8],b[9],b[10])}:null},p=a=>{let b=[];for(let c of a){if(b.length>0&&b[b.length-1].last_line().match(/[a-zA-Z0-9äÄöÖüÜßé,:-]$/)&&c.first_line().match(/^[0-9a-z]/)){b[b.length-1].append(c);continue}b.push(c)}for(let a=0;a<b.length;a++)b[a].position=a+1;return b},q=a=>{let b=a.replaceAll(/[a-zA-Z0-9äÄöÖüÜßé]/g,"_"),c=0,d="";for(let a of b)"_"===a?c++:c>0&&(d+=`${c}`,c=0),d+=a;return c>0&&(d+=`${c}`),d},r=a=>a.replaceAll(/[^a-zA-Z0-9äÄöÖüÜßé]/g,""),s=(a,b)=>{let c=[],d="";for(let e of a){if(e.match(/[a-zA-Z0-9äÄöÖüÜßé]/)){d+=e;continue}""!==d&&(c.push({isWord:!0,content:d}),d=""),b||c.push({isWord:!1,content:e})}return""!==d&&c.push({isWord:!0,content:d}),c};var t=a.i(13516),u=a.i(88206),v=a.i(328);function w({item:a,index:e,media:f,with_translation:g}){let[h,i]=(0,c.useState)(""),[k,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1),p=b=>b===a.content()||r(b)===r(a.content());return(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start w-full gap-1",children:[(0,b.jsx)(u.Tooltip,{content:"turn green on success: punctuation does not matter",children:(0,b.jsx)(t.Avatar,{size:"sm",radius:"sm",name:`${a.position}`,color:k?"success":"default"})}),(0,b.jsx)(u.Tooltip,{content:"shortcut: Ctrl+S, Ctrl+D, or type two spaces at the end",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",tabIndex:-1,onPress:()=>{f.paused?a.playMedia(f,!1):f.pause()},children:(0,b.jsx)(v.MdPlayCircle,{size:30})})}),(0,b.jsx)(u.Tooltip,{isOpen:n,placement:"top",className:"bg-slate-300",content:(0,b.jsx)("div",{className:"flex flex-col items-start justify-start text-xl px-4 py-2",children:(0,b.jsx)("div",{children:(b=>{let c=s(b,!0).map(a=>a.content),d=s(a.content(),!1);for(let a=0;a<d.length;a++)d[a].isWord&&!c.includes(d[a].content)&&(d[a].content=q(d[a].content));return d.map(a=>a.content).join("")})(h)})}),children:(0,b.jsx)(j.Input,{"aria-label":"input answer",variant:"bordered",id:`d-s-i-${e}`,classNames:{input:"text-xl font-bold"},value:h,onChange:b=>{let c=b.target.value;c.endsWith("  ")?f.paused?a.playMedia(f,!1):f.pause():(i(c),!k&&p(c)&&m(!0),k&&!p(c)&&m(!1))},onFocus:()=>{o(!0)},onBlur:()=>{o(!1)},onKeyDown:b=>{b.ctrlKey&&"sS".includes(b.key)&&(f.paused?a.playMedia(f,!1):f.pause(),b.preventDefault()),b.ctrlKey&&"dD".includes(b.key)&&(f.paused?a.playMedia(f,!0):f.pause(),b.preventDefault())}})}),g?(0,b.jsx)(u.Tooltip,{placement:"top-end",className:"bg-slate-300",content:(0,b.jsx)("div",{className:"flex flex-col items-start justify-start text-xl px-4 py-2",children:(0,b.jsx)("pre",{children:a.translation_list.length>0?a.translation().replaceAll(/\d/g,"x"):"no translation"})}),children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",tabIndex:-1,children:(0,b.jsx)(v.MdHelpOutline,{size:30})})}):null,(0,b.jsx)(u.Tooltip,{placement:"top-end",className:"bg-slate-300",content:(0,b.jsx)("div",{className:"text-xl px-4 py-2",children:a.content()}),children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",tabIndex:-1,children:(0,b.jsx)(v.MdHelp,{size:30})})}),(0,b.jsx)(u.Tooltip,{color:"primary",content:"add card",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",tabIndex:-1,as:l.Link,target:"_blank",href:`/card/add?edit=y&question=${encodeURIComponent(a.content())}`,children:(0,b.jsx)(v.MdFavorite,{size:20})})})]})}var x=a.i(39154);let y=({href:a,children:c})=>(0,b.jsx)(l.Link,{href:a,className:"text-blue-600 underline",target:"_blank",children:c});function z(){let[a,l]=(0,c.useState)(),[n,o]=(0,c.useState)(),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)([]),D=(0,c.useRef)(null),E=(0,c.useRef)(null),F=(0,c.useRef)(null),G=(0,c.useRef)(null),H=a=>{A(a);let b=((a,b)=>{let c=(a=>{let b=a.trim().replaceAll("\r\n","\n").replaceAll("\r","\n").split("\n"),c=[],d=[];for(let a of b){if(""===(a=a.trim())){d.length>0&&(c.push(d),d=[]);continue}d.push(a)}return d.length>0&&c.push(d),c})(a),d=[],e=c.map(a=>{let c=new m(a,b);return"error"===c.init_status&&d.push(c.init_error),c}).filter(a=>a.content_list.length>0);if(0===d.length){let a=p(p(p(e)));for(let b=0;b<a.length;b++)a[b].position=b+1,a[b].extend_start_ms=b>0?a[b-1].start_ms:a[b].start_ms,a[b].extend_end_ms=b+1<a.length?a[b+1].end_ms:a[b].end_ms;return{status:"success",data:a}}return{status:"error",error:d.join("\n")}})(a,q);"success"===b.status?b.data.length>0&&(C(b.data),v("")):v(b.error)},I=a=>()=>{let b=1e3*a.currentTime;for(let a=0;a<B.length;a++)if(b<=B[a].end_ms){let b=document.getElementById(`d-s-i-${a}`);b?.scrollIntoView({behavior:"smooth",block:"center"}),b?.focus();break}},J=a=>{a.addEventListener("timeupdate",I(a)),a.addEventListener("seeking",I(a))};return F.current&&J(F.current),G.current&&J(G.current),(0,b.jsxs)("div",{children:[a&&(0,b.jsx)("div",{className:"sticky top-0 p-4 z-50",children:(0,b.jsx)("audio",{className:"w-full",ref:F,controls:!0,src:a})}),n&&(0,b.jsx)("div",{className:"flex flex-row items-end justify-end fixed bottom-0 end-0 p-4 z-50",children:(0,b.jsx)("video",{className:"h-[30vh] w-auto max-w-full",ref:G,controls:!0,src:n})}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(j.Input,{className:"hidden",type:"file",ref:D,onChange:a=>{let b=a.target.files[0];return b.type.startsWith("audio/")?void l(URL.createObjectURL(b)):b.type.startsWith("video/")?void o(URL.createObjectURL(b)):void 0}}),!a&&!n&&(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:()=>D.current?.click(),children:"select audio/video"}),(0,b.jsx)(j.Input,{className:"hidden",type:"file",ref:E,onChange:async a=>{let b=a.target.files[0],c=(await b.text()).trim().replaceAll("\r\n","\n").replaceAll("\r","\n"),d=[];for(let a of c.split("\n"))if(!(d.length<1)||"1"===a){if(d.length>0&&a.endsWith("`;"))break;d.push(a)}H(d.join("\n"))}}),(!!a||!!n)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.ButtonGroup,{variant:"solid",color:"primary",isDisabled:!a&&!n,children:(0,b.jsxs)(f.Dropdown,{placement:"bottom-end",children:[(0,b.jsx)(g.DropdownTrigger,{children:(0,b.jsxs)(d.Button,{children:["select subtitle ",(0,b.jsx)(x.BiCaretDown,{})]})}),(0,b.jsxs)(h.DropdownMenu,{disallowEmptySelection:!0,className:"max-w-[300px]",selectionMode:"single",onSelectionChange:a=>{"no_translation"===a.currentKey?r(!1):r(!0),E.current?.click()},children:[(0,b.jsx)(i.DropdownItem,{description:"This subtitle file does not contain translations.",children:"No Translation"},"no_translation"),(0,b.jsx)(i.DropdownItem,{description:"This subtitle file contains translations.",children:"With Translation"},"with_translation")]})]})}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",isDisabled:!a&&!n,onPress:()=>t(!s),children:"edit subtitle"})]})]}),u.length>0&&(0,b.jsx)("pre",{className:"my-4",children:u}),s&&(0,b.jsx)(k.Textarea,{variant:"bordered",value:z,className:"my-4",onChange:a=>H(a.target.value)}),!a&&!n&&(0,b.jsxs)("div",{className:"text-xl",children:[(0,b.jsx)("p",{children:"1, Practice dictation using videos (or audios) and their corresponding subtitles"}),(0,b.jsx)("p",{children:"2, Subtitle files should be in srt format"}),(0,b.jsx)("p",{children:"3, Example: TED"}),(0,b.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,b.jsxs)("p",{children:["1, Download video from ",(0,b.jsx)(y,{href:"https://www.ted.com",children:"www.ted.com"}),': click "Share" to download MP4']}),(0,b.jsx)("p",{children:"2, Subtitles are already included in the video. You can extract them using an ffmpeg command:"}),(0,b.jsx)("p",{className:"ps-8",children:'ffprobe exampe.mp4 2>&1 | grep "Subtitle:"'}),(0,b.jsx)("p",{className:"ps-8",children:"find english subtitle, for example: #0:6[0x7](eng), to extract it:"}),(0,b.jsx)("p",{className:"ps-8",children:"ffmpeg -i exampe.mp4 -map 0:6 exampe.srt"})]}),(0,b.jsx)("p",{children:"4, Example: ARD Mediathek"}),(0,b.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,b.jsxs)("p",{children:["1, Download video and subtitle using ",(0,b.jsx)(y,{href:"https://mediathekview.de/download/",children:"MediathekView"})]}),(0,b.jsxs)("p",{children:["2, Process and prepare subtitles ",(0,b.jsx)(y,{href:"/listening/subtitle/prepare",children:"here"})]})]}),(0,b.jsx)("p",{children:"5, Example: logo"}),(0,b.jsxs)("div",{className:"ms-8 bg-slate-100",children:[(0,b.jsx)("p",{children:"1, Download video/audio and html file from logo会员群"}),(0,b.jsx)("p",{children:"2, Use html file directly as subtitle file"})]})]}),(!!a||!!n)&&0===B.length&&(0,b.jsxs)("div",{className:"text-xl",children:[(0,b.jsx)("p",{children:"1, 如果是 logo 的用于听写的 html 文件，直接上传即可（选 With Translation）"}),(0,b.jsx)("p",{children:"2, 如果是其他字幕，文件应当是 srt 格式"}),(0,b.jsx)("p",{children:"3, 根据字幕中是否含有译文，点击不同的选项，同时应符合以下要求"}),(0,b.jsx)("p",{className:"ps-8",children:"a, 如果不包含译文，则每条字幕中原文可以有多行"}),(0,b.jsx)("p",{className:"ps-8",children:"b, 如果包含译文，则每条字幕中原文只能占一行，但译文可以有多行"}),(0,b.jsx)("p",{className:"ps-8",children:"c, 如果包含译文，原文在上，译文在下，且只能有一种译文"}),(0,b.jsx)("p",{className:"ps-8",children:"d, 原文和译文都要去掉格式信息，只保留文本"}),(0,b.jsx)("p",{children:"4, 如下字幕格式，包含原文和译文："}),(0,b.jsx)("pre",{className:"ps-8 bg-slate-100",children:"45\n00:02:32,560 --> 00:02:34,240\nWie bitte?\n你说什么？"}),(0,b.jsx)("p",{children:"5, 如下字幕格式，因为原文占用了 2 行，因此不再支持译文："}),(0,b.jsx)("pre",{className:"ps-8 bg-slate-100",children:"45\n00:02:32,560 --> 00:02:34,240\nWie \nbitte?"}),(0,b.jsxs)("p",{children:["6, 如下字幕格式是",(0,b.jsx)("b",{children:"不正确"}),"的，因为原文除了文本，还有字体、颜色等格式信息："]}),(0,b.jsx)("pre",{className:"ps-8 bg-slate-100",children:'45\n00:02:32,560 --> 00:02:34,240\n<font color="#ffffff">Wie bitte?</font>'})]}),(0,b.jsx)("div",{className:"flex flex-col items-center justify-start w-full gap-2 my-8",children:B.map((c,d)=>(0,b.jsx)(w,{item:c,index:d,with_translation:q,media:a?F.current:G.current},d))})]})}}];

//# sourceMappingURL=src_app_listen_dictation_page_tsx_f9e232a2._.js.map