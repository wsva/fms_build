module.exports=[54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},80455,(a,b,c)=>{b.exports=a.x("jsdom",()=>require("jsdom"))},66680,(a,b,c)=>{b.exports=a.x("node:crypto",()=>require("node:crypto"))},84476,a=>{"use strict";a.s(["Textarea",()=>C],84476);var b=a.i(47531),c=a.i(5554),d=a.i(65248),e=a.i(72131);function f(){return(f=Object.assign.bind()).apply(null,arguments)}var g="undefined"!=typeof document?e.useLayoutEffect:function(){},h=function(a){var b=e.default.useRef(a);return g(function(){b.current=a}),b},i=function(a,b){if("function"==typeof a)return void a(b);a.current=b},j=function(a,b){var c=e.default.useRef();return e.default.useCallback(function(d){a.current=d,c.current&&i(c.current,null),c.current=b,b&&i(b,d)},[b])},k="undefined"!=typeof document,l={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},m=function(a){Object.keys(l).forEach(function(b){a.style.setProperty(b,l[b],"important")})},n=null,o=function(a,b){var c=a.scrollHeight;return"border-box"===b.sizingStyle.boxSizing?c+b.borderSize:c-b.paddingSize},p=function(){},q=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],r=!!k&&!!document.documentElement.currentStyle,s=function(a){var b=window.getComputedStyle(a);if(null===b)return null;var c=q.reduce(function(a,c){return a[c]=b[c],a},{}),d=c.boxSizing;if(""===d)return null;r&&"border-box"===d&&(c.width=parseFloat(c.width)+parseFloat(c.borderRightWidth)+parseFloat(c.borderLeftWidth)+parseFloat(c.paddingRight)+parseFloat(c.paddingLeft)+"px");var e=parseFloat(c.paddingBottom)+parseFloat(c.paddingTop),f=parseFloat(c.borderBottomWidth)+parseFloat(c.borderTopWidth);return{sizingStyle:c,paddingSize:e,borderSize:f}};function t(a,b,c){var d=h(c);e.useLayoutEffect(function(){var c=function(a){return d.current(a)};if(a)return a.addEventListener(b,c),function(){return a.removeEventListener(b,c)}},[])}var u=function(a,b){t(document.body,"reset",function(c){a.current.form===c.target&&b(c)})},v=function(a){t(window,"resize",a)},w=function(a){t(document.fonts,"loadingdone",a)},x=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],y=e.forwardRef(function(a,b){var c=a.cacheMeasurements,d=a.maxRows,g=a.minRows,h=a.onChange,i=void 0===h?p:h,l=a.onHeightChange,q=void 0===l?p:l,r=function(a,b){if(null==a)return{};var c={};for(var d in a)if(({}).hasOwnProperty.call(a,d)){if(-1!==b.indexOf(d))continue;c[d]=a[d]}return c}(a,x),t=void 0!==r.value,y=e.useRef(null),z=j(y,b),A=e.useRef(0),B=e.useRef(),C=function(){var a=y.current,b=c&&B.current?B.current:s(a);if(b){B.current=b;var e,f,h,i,j,k,l,p,r,t,u,v=(e=a.value||a.placeholder||"x",void 0===(f=g)&&(f=1),void 0===(h=d)&&(h=1/0),n||((n=document.createElement("textarea")).setAttribute("tabindex","-1"),n.setAttribute("aria-hidden","true"),m(n)),null===n.parentNode&&document.body.appendChild(n),i=b.paddingSize,j=b.borderSize,l=(k=b.sizingStyle).boxSizing,Object.keys(k).forEach(function(a){n.style[a]=k[a]}),m(n),n.value=e,p=o(n,b),n.value=e,p=o(n,b),n.value="x",t=(r=n.scrollHeight-i)*f,"border-box"===l&&(t=t+i+j),p=Math.max(t,p),u=r*h,"border-box"===l&&(u=u+i+j),[p=Math.min(u,p),r]),w=v[0],x=v[1];A.current!==w&&(A.current=w,a.style.setProperty("height",w+"px","important"),q(w,{rowHeight:x}))}};return k?(e.useLayoutEffect(C),u(y,function(){if(!t){var a=y.current.value;requestAnimationFrame(function(){var b=y.current;b&&a!==b.value&&C()})}}),v(C),w(C),e.createElement("textarea",f({},r,{onChange:function(a){t||C(),i(a)},ref:z}))):e.createElement("textarea",f({},r,{onChange:i,ref:z}))}),z=a.i(68424),A=a.i(87924),B=(0,d.forwardRef)(({style:a,minRows:d=3,maxRows:f=8,cacheMeasurements:g=!1,disableAutosize:h=!1,onHeightChange:i,...j},k)=>{let{Component:l,label:m,description:n,startContent:o,endContent:p,hasHelper:q,shouldLabelBeOutside:r,shouldLabelBeInside:s,isInvalid:t,errorMessage:u,getBaseProps:v,getLabelProps:w,getInputProps:x,getInnerWrapperProps:B,getInputWrapperProps:C,getHelperWrapperProps:D,getDescriptionProps:E,getErrorMessageProps:F,isClearable:G,getClearButtonProps:H}=(0,b.useInput)({...j,ref:k,isMultiline:!0}),[I,J]=(0,e.useState)(d>1),[K,L]=(0,e.useState)(!1),M=m?(0,A.jsx)("label",{...w(),children:m}):null,N=x(),O=h?(0,A.jsx)("textarea",{...N,style:(0,c.mergeProps)(N.style,null!=a?a:{})}):(0,A.jsx)(y,{...N,cacheMeasurements:g,"data-hide-scroll":(0,c.dataAttr)(!K),maxRows:f,minRows:d,style:(0,c.mergeProps)(N.style,null!=a?a:{}),onHeightChange:(a,b)=>{1===d&&J(a>=2*b.rowHeight),f>d&&L(a>=f*b.rowHeight),null==i||i(a,b)}}),P=(0,e.useMemo)(()=>G?(0,A.jsx)("button",{...H(),children:(0,A.jsx)(z.CloseFilledIcon,{})}):null,[G,H]),Q=(0,e.useMemo)(()=>o||p?(0,A.jsxs)("div",{...B(),children:[o,O,p]}):(0,A.jsx)("div",{...B(),children:O}),[o,N,p,B]),R=t&&u,S=R||n;return(0,A.jsxs)(l,{...v(),children:[r?M:null,(0,A.jsxs)("div",{...C(),"data-has-multiple-rows":(0,c.dataAttr)(I),children:[s?M:null,Q,P]}),q&&S?(0,A.jsx)("div",{...D(),children:R?(0,A.jsx)("div",{...F(),children:u}):(0,A.jsx)("div",{...E(),children:n})}):null]})});B.displayName="HeroUI.Textarea";var C=B},64831,a=>{"use strict";a.s(["saveText",()=>c]);var b=a.i(5050),c=(0,b.createServerReference)("40ce8cc6c0154c0ea0e7d3199ca3f8b4c033d103f6",b.callServer,void 0,b.findSourceMapURL,"saveText")},40490,88560,a=>{"use strict";a.s(["highlightDifferences",()=>e],40490);var b=a.i(87924);function c(a){return(a=a.replace(/\s+/g," ").trim())?a.split(/(\s+|[.,!?;:\-â€”()"'â€œâ€â€žÂ«Â»â€¦])/).filter(a=>null!=a&&""!==a).filter(a=>a.trim().length>0||" "===a):[]}function d(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let e=(a,e)=>{let f=c(a),g=c(e),{matchesB:h}=function(a,b){let c=a.length,d=b.length,e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let f=c-1;f>=0;f--)for(let c=d-1;c>=0;c--)a[f]===b[c]?e[f][c]=1+e[f+1][c+1]:e[f][c]=Math.max(e[f+1][c],e[f][c+1]);let f=0,g=0,h=[];for(;f<c&&g<d;)a[f]===b[g]?(h.push(g),f++,g++):e[f+1][g]>=e[f][g+1]?f++:g++;return{matchesB:h}}(f,g),i=new Set(h);return g.map((a,c)=>i.has(c)?(0,b.jsx)("span",{children:d(a)},c):(0,b.jsx)("span",{style:{background:"#ffeb3b"},children:d(a)},c))};a.s(["removeAudio",()=>g],88560);var f=a.i(5050),g=(0,f.createServerReference)("601ef646b871a52ce0437cafc30ff4ea7af6f2bc88",f.callServer,void 0,f.findSourceMapURL,"removeAudio")},85539,a=>{"use strict";a.s(["cacheBlobInMemory",()=>d,"dropWeakCache",()=>f,"getBlobFromWeakCache",()=>e]);let b=new Map,c=new FinalizationRegistry(a=>{b.delete(a)});function d(a,d){if("undefined"==typeof WeakRef)return;let e=new WeakRef(d);b.set(a,e);try{c.register(d,a,d)}catch(a){console.log(a)}}function e(a){let c=b.get(a);if(!c)return null;let d=c.deref();return d||(b.delete(a),null)}function f(a){b.delete(a)}},80768,a=>{"use strict";a.s(["deleteBlobFromIndexedDB",()=>f,"getBlobFromIndexedDB",()=>e,"saveBlobToIndexedDB",()=>d]);let b="blobs";function c(){return new Promise((a,c)=>{let d=indexedDB.open("audio-store",1);d.onupgradeneeded=a=>{let c=a.target.result;c.objectStoreNames.contains(b)||c.createObjectStore(b,{keyPath:"uuid"})},d.onsuccess=()=>{a(d.result)},d.onerror=()=>{c(d.error)}})}async function d(a,d){let e=await c();return new Promise((c,f)=>{let g=e.transaction(b,"readwrite").objectStore(b),h={uuid:a,audioBlob:d,createdAt:Date.now()},i=g.put(h);i.onsuccess=()=>c(),i.onerror=()=>f(i.error)})}async function e(a){let d=await c();return new Promise((c,e)=>{let f=d.transaction(b,"readonly").objectStore(b).get(a);f.onsuccess=()=>{let a=f.result;c(a?a.audioBlob:null)},f.onerror=()=>e(f.error)})}async function f(a){let d=await c();return new Promise((c,e)=>{let f=d.transaction(b,"readwrite").objectStore(b).delete(a);f.onsuccess=()=>c(),f.onerror=()=>e(f.error)})}},92316,a=>{"use strict";a.s(["saveAudio",()=>c]);var b=a.i(5050),c=(0,b.createServerReference)("707f4b2160c2edada34bba60776f8b1dee00b1d86e",b.callServer,void 0,b.findSourceMapURL,"saveAudio")},20531,a=>{"use strict";a.s(["saveAudioDB",()=>c]);var b=a.i(5050),c=(0,b.createServerReference)("4093e35777aec5153852dddf00fdc2babe65422cc5",b.callServer,void 0,b.findSourceMapURL,"saveAudioDB")},20494,a=>{"use strict";a.s(["default",()=>y],20494);var b=a.i(87924),c=a.i(68114),d=a.i(32496),e=a.i(4655),f=a.i(24647),g=a.i(72571),h=a.i(84476),i=a.i(72131),j=a.i(20094),k=a.i(5050),l=(0,k.createServerReference)("409efbd58194f274e133da9018cd159d7e89fa382b",k.callServer,void 0,k.findSourceMapURL,"getAudioDBAll"),m=(0,k.createServerReference)("40cd2bd38e26fa897427be5c4518ffa6698af92dae",k.callServer,void 0,k.findSourceMapURL,"getText"),n=(0,k.createServerReference)("407d60f121f18a6b64a3f93a7768521d08948ecfe3",k.callServer,void 0,k.findSourceMapURL,"removeAudioDB"),o=a.i(20531),p=a.i(64831),q=a.i(88303),r=a.i(40490),s=a.i(328),t=a.i(85539),u=a.i(80768),v=a.i(88560),w=a.i(92316),x=a.i(84850);function y({uuid:a,user_id:k}){let[y,z]=(0,i.useState)(),[A,B]=(0,i.useState)(!1),[C,D]=(0,q.useImmer)([]),[E,F]=(0,i.useState)(!1),[G,H]=(0,i.useState)(!1),[I,J]=(0,i.useState)("local"),[K,L]=(0,i.useState)([]),[M,N]=(0,i.useState)(!1),[O,P]=(0,i.useState)(!1),[Q,R]=(0,i.useState)(),S=async a=>{F(!0);let b=await m(a);"success"===b.status&&z(b.data);let d=await l(a);if("success"===d.status){let a=d.data.map(a=>({...(0,c.toExactType)(a),in_db:!0,on_fs:!0,modified_db:!1,modified_fs:!1}));D(b=>{for(let c of(b.length=0,a))b.push(c)})}F(!1)},T=async()=>{if(H(!0),y){if("error"===(await (0,p.saveText)({...y,updated_at:new Date})).status){j.toast.error("save text failed"),H(!1);return}j.toast.success("saved successfully!"),H(!1)}},U=async()=>{if(!Q)return;H(!0);let a=(0,t.getBlobFromWeakCache)(Q.uuid);if(a||(a=await (0,u.getBlobFromIndexedDB)(Q.uuid)),!a){j.toast.error("Blob of audio not found"),H(!1);return}if("success"===(await (0,w.saveAudio)(a,"practice",`${Q.uuid}.wav`)).status)await (0,u.deleteBlobFromIndexedDB)(Q.uuid),(0,t.dropWeakCache)(Q.uuid);else{j.toast.error("save audio failed"),H(!1);return}if("error"===(await (0,o.saveAudioDB)({uuid:Q.uuid,user_id:k,text_uuid:Q.text_uuid,recognized:Q.recognized,audio_path:Q.audio_path,created_by:k,created_at:Q.created_at||new Date,updated_at:new Date})).status){j.toast.error("save db failed"),H(!1);return}D(a=>{a.push({...Q,in_db:!0,on_fs:!0,modified_db:!1,modified_fs:!1})}),R(void 0),j.toast.success("added and saved successfully!"),H(!1)},V=async b=>(b.modified_fs&&(await (0,u.deleteBlobFromIndexedDB)(b.uuid),(0,t.dropWeakCache)(b.uuid)),b.on_fs&&"success"!==(await (0,v.removeAudio)("practice",`${b.uuid}.wav`)).status)?void j.toast.error("delete audio file failed"):b.in_db&&"success"!==(await n(b.uuid)).status?void j.toast.error("delete audio in database failed"):void(j.toast.success("delete audio success"),D(b=>{let c=b.findIndex(b=>b.uuid===a);-1!==c&&b.splice(c,1)})),W=async()=>{let b=async(b,d)=>{let e=(0,c.getUUID)();await (0,u.saveBlobToIndexedDB)(e,d),(0,t.cacheBlobInMemory)(e,d),R({uuid:e,user_id:k,text_uuid:a,recognized:"success"===b.status?b.data:"",audio_path:`/api/data/practice/${e}.wav`,in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}),"error"===b.status&&j.toast.error(b.error)};await (0,x.toggleRecording)({mode:"audio",stateRecorder:K,setStateRecorder:L,stateRecording:M,setStateRecording:N,recognize:!0,sttEngine:I,setStateProcessing:P,handleAudio:b})};return(0,i.useEffect)(()=>{S(a)},[]),(0,b.jsxs)("div",{className:"w-full space-y-4 mb-10",children:[E&&(0,b.jsx)("div",{className:"flex flex-row w-full items-center justify-center gap-4 my-4",children:(0,b.jsx)(g.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"})}),y?.user_id===k?(0,b.jsxs)("div",{className:"flex flex-col w-full gap-2 my-4 p-2 rounded-lg bg-sand-300",children:[(0,b.jsx)("div",{className:"flex flex-row w-full items-end justify-end",children:(0,b.jsx)(d.Button,{variant:"solid",size:"sm",color:"primary",isDisabled:!A||G,onPress:T,children:"Save"})}),(0,b.jsx)(h.Textarea,{size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:y.text,onChange:a=>{z({...y,text:a.target.value}),B(!0)}})]}):(0,b.jsx)("div",{className:"flex flex-col w-full gap-2 my-4 p-2 rounded-lg bg-sand-300 text-xl",children:y?.text}),(0,b.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 my-4",children:[(0,b.jsx)(e.Select,{className:"max-w-sm",selectedKeys:[I],onChange:a=>J(a.target.value),startContent:(0,b.jsx)("div",{className:"whitespace-nowrap font-bold",children:"AI Engine"}),children:x.EngineList.map(a=>(0,b.jsx)(f.SelectItem,{textValue:a.value,children:a.value},a.key))}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!M&&O,onPress:async()=>{Q&&R(void 0),await W()},children:M?"â¹ Stop Recording":O?"Processing":"ðŸŽ¤ Read a Sentence"})]}),Q&&(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center w-full gap-2 my-4",children:[(0,b.jsxs)("div",{className:"flex flex-col w-full p-2 rounded-lg bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:async()=>{let a=(0,t.getBlobFromWeakCache)(Q.uuid);if(a||((a=await (0,u.getBlobFromIndexedDB)(Q.uuid))?(0,t.cacheBlobInMemory)(Q.uuid,a):j.toast.error("Blob of audio not found")),a){let b=URL.createObjectURL(a),c=new Audio(b);c.play(),c.onended=()=>{URL.revokeObjectURL(b)}}},children:(0,b.jsx)(s.MdPlayCircle,{size:20})})]}),(0,b.jsx)("div",{className:"text-xl",children:(0,r.highlightDifferences)(y.text,Q.recognized)})]}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",isDisabled:G,onPress:U,children:"Add & Save"})]}),C.length>0&&(0,b.jsx)("div",{className:"flex flex-col w-full gap-4 my-4 bg-sand-300",children:C.map((a,c)=>(0,b.jsxs)("div",{className:"flex flex-col w-full ps-2",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start w-full",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:async()=>{if(a.modified_fs){let b=(0,t.getBlobFromWeakCache)(a.uuid);if(b||((b=await (0,u.getBlobFromIndexedDB)(a.uuid))?(0,t.cacheBlobInMemory)(a.uuid,b):j.toast.error("Blob of audio not found")),b){let a=URL.createObjectURL(b),c=new Audio(a);c.play(),c.onended=()=>{URL.revokeObjectURL(a)}}}else new Audio(a.audio_path).play()},children:(0,b.jsx)(s.MdPlayCircle,{size:20})})]}),(0,b.jsx)("div",{className:"flex flex-row items-center justify-end",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",color:"danger",className:"w-fit h-fit",onPress:()=>{window.confirm("Are you sure to delete?")&&V(a)},children:(0,b.jsx)(s.MdDelete,{size:20})})})]}),(0,b.jsx)("div",{className:"text-xl text-balance hyphens-auto",children:(0,r.highlightDifferences)(y?.text||"",a.recognized)}),(0,b.jsxs)("div",{className:"text-md text-gray-400",children:["by ",a.user_id]})]},`${c}-${a.uuid}`))})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e0cb29fd._.js.map