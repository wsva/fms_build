module.exports=[81628,a=>{"use strict";a.s(["default",()=>q],81628);var b=a.i(87924),c=a.i(72131),d=a.i(5050),e=(0,d.createServerReference)("60e43ce3a107e78d88e44cae7c65828edb5fd1ff66",d.callServer,void 0,d.findSourceMapURL,"getTorstenVoice"),f=a.i(32496),g=a.i(95032),h=a.i(13046),i=a.i(27700),j=a.i(18745),k=a.i(328);let l="http://localhost:8000/stt",m=async()=>{try{let a=new AbortController,b=setTimeout(()=>a.abort(),2e3);return await fetch(l,{method:"GET",signal:a.signal,cache:"no-cache"}),clearTimeout(b),!0}catch(a){return console.warn("STT server unreachable:",a),!1}},n=async(a,b)=>{if(!await m())return{status:"error",error:"STT service not available."};let c=new FormData;c.append("file",a,"sentence.wav"),c.append("language",b);let d=a=>a.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");try{let a=await fetch(l,{method:"POST",body:c}),b=await a.json();if(b.text)return{status:"success",data:d(b.text)};if(b.error)return{status:"error",error:d("Error: "+b.error)}}catch(a){return console.error(a),{status:"error",error:"Transcription failed. Please try again."}}return{status:"error",error:"Unknown error."}},o=({row:a})=>{let[d,e]=(0,c.useState)(!1),[l,m]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),q=(0,c.useRef)([]),r=(0,c.useRef)(null),s=async()=>{if(!d){let a=new MediaRecorder(await navigator.mediaDevices.getUserMedia({audio:!0}));r.current=a,q.current=[],a.ondataavailable=a=>q.current.push(a.data),a.start(),e(!0)}if(d&&r.current){let a=r.current;a.stop(),e(!1),m("Transcribing..."),a.onstop=async()=>{let a=new Blob(q.current,{type:"audio/wav"});if(!a||0===a.size)return void console.warn("Empty audio blob â€” skipping transcription.");let b=await n(a,"auto");"success"===b.status?m(b.data):m(b.error),q.current=[],r.current=null}}},t=async()=>{m("Transcribing...");let b=await fetch(`/torsten_voice/${a.source}/${a.id}.wav`),c=await b.blob(),d=await n(c,"auto");"success"===d.status?m(d.data):m(d.error)};return(0,b.jsxs)("div",{className:"card shadow-sm p-3 bg-sand-300 hover:-translate-y-1 transition-transform",children:[(0,b.jsxs)("div",{className:"card-subtitle mb-2 text-muted flex justify-between items-center",children:[(0,b.jsx)(f.Button,{isIconOnly:!0,variant:"light",size:"sm",onPress:()=>{new Audio(`/torsten_voice/${a.source}/${a.id}.wav`).play()},children:(0,b.jsx)(k.MdPlayCircle,{size:30})}),(0,b.jsxs)(g.Dropdown,{placement:"bottom-end",children:[(0,b.jsx)(j.DropdownTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{isIconOnly:!0,variant:"light",title:"More options",children:(0,b.jsx)(k.MdMoreVert,{size:24})})}),(0,b.jsxs)(i.DropdownMenu,{children:[(0,b.jsx)(h.DropdownItem,{onPress:t,children:"Transcribe Original Audio"},"original"),(0,b.jsx)(h.DropdownItem,{onPress:()=>{let b=`/torsten_voice/${a.source}/${a.id}.wav`;window.open(b,"_blank")},children:"Download Original Audio"},"download")]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mt-3",children:[(0,b.jsx)(f.Button,{size:"sm",onPress:s,children:d?"Stop Recording":"Speaking"}),(0,b.jsx)(f.Button,{size:"sm",onPress:()=>p(!o),children:"Answer"})]}),l?(0,b.jsx)("div",{className:"mt-2 border rounded p-2 bg-light",children:l}):null,o?(0,b.jsxs)("div",{className:"mt-2 border rounded p-2 bg-light",children:[(0,b.jsx)("p",{children:a.text}),(0,b.jsx)("br",{}),(0,b.jsx)("p",{children:`subset: ${a.subset}, style: ${a.style}`})]}):null]})};var p=a.i(73836);function q(){let[a,d]=(0,c.useState)(""),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(1),[l,m]=(0,c.useState)(0),n=async a=>{g(!0);let b=await e(a,20);"success"===b.status?(i(b.data),m(b.total_pages||0)):d(b.error),g(!1)};return(0,c.useEffect)(()=>{n(1)},[]),(0,b.jsxs)("div",{className:"container py-4",children:[a?(0,b.jsx)("div",{children:a}):null,(0,b.jsxs)("div",{className:"flex flex-row w-full items-center justify-center gap-4",children:[(0,b.jsx)("div",{children:"Page"}),(0,b.jsx)(p.Pagination,{showControls:!0,loop:!0,variant:"bordered",total:l,page:j,isDisabled:f,onChange:a=>{k(a),n(a)}})]}),h?(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 my-4",children:h.map(a=>(0,b.jsx)(o,{row:a},a.id))}):null,(0,b.jsxs)("div",{className:"flex flex-row w-full items-center justify-center gap-4",children:[(0,b.jsx)("div",{children:"Page"}),(0,b.jsx)(p.Pagination,{showControls:!0,loop:!0,variant:"bordered",total:l,page:j,isDisabled:f,onChange:a=>{k(a),n(a)}})]})]})}}];

//# sourceMappingURL=src_app_speak_torsten_voice_page_tsx_e11303cd._.js.map