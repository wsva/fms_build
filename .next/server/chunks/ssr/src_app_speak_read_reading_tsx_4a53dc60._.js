module.exports=[23614,a=>{"use strict";a.s(["default",()=>G],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(72571),f=a.i(84476),g=a.i(88206),h=a.i(328),i=a.i(84850),j=a.i(20094);function k(a){return(a=a.replace(/\s+/g," ").trim())?a.split(/(\s+|[.,!?;:\-â€”()"'â€œâ€â€žÂ«Â»â€¦])/).filter(a=>null!=a&&""!==a).filter(a=>a.trim().length>0||" "===a):[]}function l(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var m=a.i(5050),n=(0,m.createServerReference)("602b4b9610748f50f5d9212be52fabf8937722fedb",m.callServer,void 0,m.findSourceMapURL,"removeAudio"),o=(0,m.createServerReference)("701ca0c1407451144cc2052cc1b144094ba63982c8",m.callServer,void 0,m.findSourceMapURL,"saveAudio"),p=(0,m.createServerReference)("403287c0dcd54d17656ec8fe7932ef755a95f8b610",m.callServer,void 0,m.findSourceMapURL,"removeSentence"),q=(0,m.createServerReference)("40a403d15643e0ce9de9737de774cbe283ae04363f",m.callServer,void 0,m.findSourceMapURL,"saveSentence"),r=(0,m.createServerReference)("6030e387b76a121d9727d926f238ee50afc34d8471",m.callServer,void 0,m.findSourceMapURL,"callTTS");function s({user_id:a,item:e,onUpdate:m,onDelete:s}){let[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),B=(0,c.useRef)([]),C=(0,c.useRef)(null),D=async()=>{e.modified_fs&&e.audioBlob&&("success"===(await o(e.audioBlob,"reading",`${e.uuid}.wav`)).status?(j.toast.success("save audio success"),m({...e,on_fs:!0,modified_fs:!1})):j.toast.error("save audio failed")),e.modified_db&&("success"===(await q({uuid:e.uuid,chapter_uuid:e.chapter_uuid,order_num:e.order_num,original:e.original,recognized:e.recognized,audio_path:`/api/data/reading/${e.uuid}.wav`,created_by:a,created_at:e.created_at||new Date,updated_at:new Date})).status?(j.toast.success("save sentence success"),m({...e,in_db:!0,modified_db:!1})):j.toast.error("save sentence failed"))},E=async()=>{if(e.on_fs){if("success"!==(await n("reading",`${e.uuid}.wav`)).status)return void j.toast.error("delete audio failed");j.toast.success("delete audio success")}if(e.in_db){if("success"!==(await p(e.uuid)).status)return void j.toast.error("delete sentence failed");j.toast.success("delete sentence success")}s(e.uuid)};return(0,b.jsxs)("div",{className:"flex flex-row items-start justify-start w-full bg-sand-300",children:[e.modified_db||e.modified_fs?(0,b.jsx)(g.Tooltip,{placement:"bottom",content:"unsaved",children:(0,b.jsx)("div",{className:"text-red-500",children:"â—"})}):(0,b.jsx)("div",{className:"text-transparent",children:"â—"}),(0,b.jsxs)("div",{className:"flex flex-col w-full p-2",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,b.jsx)(g.Tooltip,{placement:"top",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:!t&&v,onPress:()=>{(0,i.toggleRecording)(t,u,B,C,!0,w,a=>{console.log(a)},(a,b)=>{"success"===a.status?m({...e,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}):j.toast.error(a.error)})},children:t?(0,b.jsx)(h.MdMic,{size:20}):(0,b.jsx)(h.MdMicOff,{size:20})})}),(0,b.jsx)(g.Tooltip,{placement:"top",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{new Audio(e.audioBlob?URL.createObjectURL(e.audioBlob):e.audio_path).play()},children:(0,b.jsx)(h.MdPlayCircle,{size:20})})})]}),(0,b.jsx)("div",{className:"text-xl",children:((a,c)=>{let d=k(a),e=k(c),{matchesB:f}=function(a,b){let c=a.length,d=b.length,e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let f=c-1;f>=0;f--)for(let c=d-1;c>=0;c--)a[f]===b[c]?e[f][c]=1+e[f+1][c+1]:e[f][c]=Math.max(e[f+1][c],e[f][c+1]);let f=0,g=0,h=[];for(;f<c&&g<d;)a[f]===b[g]?(h.push(g),f++,g++):e[f+1][g]>=e[f][g+1]?f++:g++;return{matchesB:h}}(d,e),g=new Set(f);return e.map((a,c)=>g.has(c)?(0,b.jsx)("span",{children:l(a)},c):(0,b.jsx)("span",{style:{background:"#ffeb3b"},children:l(a)},c))})(e.original,e.recognized)})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"original text:"}),(0,b.jsx)(g.Tooltip,{placement:"top",content:"edit original",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>y(!x),children:x?(0,b.jsx)(h.MdEditOff,{size:20}):(0,b.jsx)(h.MdEdit,{size:20})})}),(0,b.jsx)(g.Tooltip,{placement:"top",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:z,onPress:async()=>{let a=`/api/data/tts/${e.uuid}.wav`;if(!await fetch(a,{method:"HEAD"}).then(a=>a.ok).catch(()=>!1)){A(!0);let a=await r(e.uuid,e.original);if(A(!1),"error"===a.status)return void console.error(a.error)}new Audio(a).play().catch(a=>console.error("error: ",a))},children:(0,b.jsx)(h.MdPlayCircle,{size:20})})})]}),x?(0,b.jsx)(f.Textarea,{size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:e.original,onChange:a=>{m({...e,original:a.target.value,modified_db:!0})}}):(0,b.jsx)("div",{className:"text-xl",children:e.original})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center w-fit gap-1 py-2",children:[(0,b.jsx)(g.Tooltip,{placement:"left",content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>m(e,e.order_num+1),children:(0,b.jsx)(h.MdArrowUpward,{size:20})})}),(0,b.jsx)("div",{children:e.order_num}),(0,b.jsx)(g.Tooltip,{placement:"left",content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>m(e,e.order_num-1),children:(0,b.jsx)(h.MdArrowDownward,{size:20})})}),(0,b.jsx)(g.Tooltip,{placement:"left",content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:D,children:(0,b.jsx)(h.MdOutlineSave,{size:20})})}),(0,b.jsx)(g.Tooltip,{placement:"left",content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:E,children:(0,b.jsx)(h.MdDelete,{size:20})})})]})]})}var t=a.i(68114),u=(0,m.createServerReference)("409b807b67c98a75dbb2348895ce1562fe0bf9bd92",m.callServer,void 0,m.findSourceMapURL,"getBookAll"),v=a.i(91971),w=a.i(88517),x=a.i(75090),y=a.i(4655),z=a.i(24647);function A({user_id:a,onSelect:e}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(""),[k,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),o=async()=>{let b=await u(a);"success"===b.status&&g(b.data)},p=async()=>{if(!a)return void j.toast.error("not logged in");n(!0),"success"===(await (0,w.saveBook)({uuid:(0,t.getUUID)(),user_id:a,name:h,created_by:a,created_at:new Date,updated_at:new Date})).status?(j.toast.success("save book success"),i("")):j.toast.error("save book failed"),n(!1)},q=async a=>{n(!0),"success"===(await (0,v.removeBook)(a)).status?j.toast.success("delete book success"):j.toast.error("delete book failed"),n(!1)};return(0,c.useEffect)(()=>{(async()=>{let b=await u(a);"success"===b.status&&g(b.data)})()},[a]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(y.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;await e(b)},children:f.map(a=>(0,b.jsx)(z.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>l(!k),children:k?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:o,children:"refresh"})]}),k&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(x.Input,{label:"Name of Book",size:"sm",onChange:a=>i(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:m,onPress:p,children:"add"})]}),f.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>q(a.uuid),children:"delete"})]},a.uuid))]})]})}var B=(0,m.createServerReference)("4062d9c44f8dd4e97c356fcb8ea1b0b1cd969310a1",m.callServer,void 0,m.findSourceMapURL,"getSentenceAll"),C=(0,m.createServerReference)("40052a5a9dfc20045421302b600a49c97243aeee04",m.callServer,void 0,m.findSourceMapURL,"getChapterAll"),D=(0,m.createServerReference)("40a5d21b077fc0ec64484bbad7f0399d9f40d72787",m.callServer,void 0,m.findSourceMapURL,"removeChapter"),E=(0,m.createServerReference)("40fb403ddde7ec1136671e3f4d376b9eed49bcbdd6",m.callServer,void 0,m.findSourceMapURL,"saveChapter");function F({user_id:a,book_uuid:e,onSelect:f}){let[g,h]=(0,c.useState)([]),[i,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),r=async()=>{let a=await C(e);"success"===a.status&&h(a.data)},s=async()=>a?e?void(q(!0),"success"===(await E({uuid:(0,t.getUUID)(),book_uuid:e,order_num:parseInt(i,10),name:l,created_by:a,created_at:new Date,updated_at:new Date})).status?(j.toast.success("save chapter success"),m("")):j.toast.error("save chapter failed"),q(!1)):void j.toast.error("no book selected"):void j.toast.error("not logged in"),u=async a=>{q(!0),"success"===(await D(a)).status?j.toast.success("delete chapter success"):j.toast.error("delete chapter failed"),q(!1)};return(0,c.useEffect)(()=>{(async()=>{let a=await C(e);"success"===a.status&&h(a.data)})()},[e]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(y.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;await f(b)},children:g.map(a=>(0,b.jsxs)(z.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>o(!n),children:n?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:r,children:"refresh"})]}),n&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(x.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:a=>k(a.target.value)}),(0,b.jsx)(x.Input,{label:"Name of Book",size:"sm",onChange:a=>m(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:p,onPress:s,children:"add"})]}),g.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[a.order_num," - ",a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>u(a.uuid),children:"delete"})]},a.uuid))]})]})}function G({email:a}){let[f,g]=(0,c.useState)(""),[h,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1),[n,p]=c.default.useState(!1),[r,u]=(0,c.useState)([]),[v,w]=c.default.useState(!1),x=(0,c.useRef)([]),y=(0,c.useRef)(null),z=async a=>{w(!0);let b=await B(a);"success"===b.status&&u(b.data.map((a,b)=>({...(0,t.toExactType)(a),order_num:b+1,in_db:!0,on_fs:!0,modified_db:a.order_num!==b,modified_fs:!1}))),w(!1)},C=(a,b)=>{if(b){if(b<1&&(b=1),b>r.length&&(b=r.length),a.order_num!==b){let c=[...r],d=c.splice(a.order_num-1,1)[0];c.splice(b-1,0,d),u(c.map((a,b)=>({...a,order_num:b+1,modified_db:a.order_num===b+1})))}}else u(b=>b.map((b,c)=>b.uuid===a.uuid?{...a,order_num:c+1,modified_db:a.order_num===c+1}:{...b,order_num:c+1,modified_db:b.order_num===c+1}))},D=a=>{u(b=>b.filter(b=>b.uuid!==a)),u(a=>a.map((a,b)=>({...a,order_num:b+1,modified_db:a.order_num!==b+1})))},E=async()=>{try{await Promise.all(r.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await o(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");u(a=>a.map(a=>a.uuid===b.uuid?{...a,on_fs:!0,modified_fs:!1}:a))}let d=await q({uuid:b.uuid,chapter_uuid:b.chapter_uuid,order_num:b.order_num,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed");return u(a=>a.map(a=>a.uuid===b.uuid?{...a,in_db:!0,modified_db:!1}:a)),!0})),j.toast.success("All sentences saved successfully!")}catch(a){j.toast.error(a.message||"Failed to save sentences")}};return(0,c.useEffect)(()=>{let a=a=>{if(a.ctrlKey&&"y"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}};return document.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[l,n]),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 my-2",children:[(0,b.jsx)(A,{user_id:a,onSelect:async a=>{g(a)}}),(0,b.jsx)(F,{user_id:a,book_uuid:f,onSelect:async a=>{k(a),await z(a)}})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!l&&n,onPress:()=>{f&&h?(0,i.toggleRecording)(l,m,x,y,!0,p,a=>{console.log(a)},(a,b)=>{"success"===a.status?u(c=>[...c,{uuid:(0,t.getUUID)(),chapter_uuid:h,order_num:r.length+1,original:a.data,recognized:a.data,audioBlob:b,in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}]):j.toast.error(a.error)}):alert("select book and chapter first")},children:l?"â¹ Stop Recording (Ctrl+Y)":"ðŸŽ¤ Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:E,children:"save all sentences"})]}),v&&(0,b.jsx)(e.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),r.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...r].reverse().map(c=>(0,b.jsx)(s,{user_id:a,item:c,onUpdate:C,onDelete:D},c.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map