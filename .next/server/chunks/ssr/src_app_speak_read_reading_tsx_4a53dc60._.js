module.exports=[23614,a=>{"use strict";a.s(["default",()=>C],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(72571),f=a.i(75090),g=a.i(47977),h=a.i(88206),i=a.i(328),j=a.i(84850),k=a.i(20094);function l({rsp:a,onUpdate:e,onDelete:l}){let[m,n]=(0,c.useState)(!1),[o,p]=c.default.useState(!1),[q,r]=(0,c.useState)(a.original),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)([]),v=(0,c.useRef)(null);return(0,b.jsxs)("div",{className:"flex flex-col w-full gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(h.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,b.jsx)(i.MdHelpOutline,{size:24})}),s?(0,b.jsx)(f.Input,{size:"lg",className:"w-full",onValueChange:b=>{r(b),e(a.uuid,b,"",null)},value:q}):(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:q}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(h.Tooltip,{content:s?"done":"edit",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>t(!s),children:s?(0,b.jsx)(i.MdDone,{size:30}):(0,b.jsx)(i.MdEdit,{size:30})})}),(0,b.jsx)(h.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>l(a.uuid),children:(0,b.jsx)(i.MdDelete,{size:30})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(h.Tooltip,{placement:"right",content:"recognised from audio",children:(0,b.jsx)(i.MdHelpOutline,{size:24})}),(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:a.recognized}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!m&&o,onPress:()=>{(0,j.toggleRecording)(m,n,u,v,!0,p,a=>{console.log(a)},(b,c)=>{"success"===b.status?e(a.uuid,"",b.data,c):k.toast.error(b.error)})},children:m?(0,b.jsx)(i.MdMic,{size:30}):(0,b.jsx)(i.MdMicOff,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,b.jsx)(i.MdPlayCircle,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:g.Link,href:a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path,download:`reading_${a.uuid}.wav`,children:(0,b.jsx)(i.MdDownloadForOffline,{size:30})})})]})]}),(a.modified_db||a.modified_fs)&&(0,b.jsx)("div",{className:"text-red-500",children:"unsaved"})]})}var m=a.i(68114),n=a.i(5050),o=(0,n.createServerReference)("404bf7b2307228a423d14e9c7673e6d5addebaea75",n.callServer,void 0,n.findSourceMapURL,"getBookAll"),p=a.i(70232),q=a.i(48320),r=a.i(4655),s=a.i(24647);function t({user_id:a,onSelect:e}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(""),[l,n]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),v=async()=>{let b=await o(a);"success"===b.status&&h(b.data)},w=async()=>{if(!a)return void k.toast.error("not logged in");u(!0),"success"===(await (0,q.saveBook)({uuid:(0,m.getUUID)(),user_id:a,name:i,created_by:a,created_at:new Date,updated_at:new Date})).status?(k.toast.success("save book success"),j("")):k.toast.error("save book failed"),u(!1)},x=async a=>{u(!0),"success"===(await (0,p.removeBook)(a)).status?k.toast.success("delete book success"):k.toast.error("delete book failed"),u(!1)};return(0,c.useEffect)(()=>{v()},[i]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(r.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;await e(b)},children:g.map(a=>(0,b.jsx)(s.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>n(!l),children:l?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:v,children:"refresh"})]}),l&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(f.Input,{label:"Name of Book",size:"sm",onChange:a=>j(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:t,onPress:w,children:"add"})]}),g.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>x(a.uuid),children:"delete"})]},a.uuid))]})]})}var u=(0,n.createServerReference)("401ce1d186071dfc33e6ed3c3d0f8d3fc2009ce44d",n.callServer,void 0,n.findSourceMapURL,"getSentenceAll"),v=(0,n.createServerReference)("40a8c0842dd459741d3b3c9caeca940515e565152b",n.callServer,void 0,n.findSourceMapURL,"saveSentence"),w=(0,n.createServerReference)("40f642efbe313a1e69a8823eceb17818ebf8a7b08e",n.callServer,void 0,n.findSourceMapURL,"getChapterAll"),x=(0,n.createServerReference)("4099a3ea4795b55790f5eb864e5002ff1d37b1a24f",n.callServer,void 0,n.findSourceMapURL,"removeChapter"),y=(0,n.createServerReference)("408c32c88857ee1d19d33dbca0ace3948040b804e6",n.callServer,void 0,n.findSourceMapURL,"saveChapter");function z({user_id:a,book_uuid:e,onSelect:g}){let[h,i]=(0,c.useState)([]),[j,l]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(!1),[t,u]=(0,c.useState)(!1),v=async()=>{let a=await w(e);"success"===a.status&&i(a.data)},z=async()=>a?e?void(u(!0),"success"===(await y({uuid:(0,m.getUUID)(),book_uuid:e,order_num:parseInt(j,10),name:n,created_by:a,created_at:new Date,updated_at:new Date})).status?(k.toast.success("save chapter success"),o("")):k.toast.error("save chapter failed"),u(!1)):void k.toast.error("no book selected"):void k.toast.error("not logged in"),A=async a=>{u(!0),"success"===(await x(a)).status?k.toast.success("delete chapter success"):k.toast.error("delete chapter failed"),u(!1)};return(0,c.useEffect)(()=>{v()},[e,n]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(r.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;await g(b)},children:h.map(a=>(0,b.jsxs)(s.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>q(!p),children:p?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:v,children:"refresh"})]}),p&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(f.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:a=>l(a.target.value)}),(0,b.jsx)(f.Input,{label:"Name of Book",size:"sm",onChange:a=>o(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:t,onPress:z,children:"add"})]}),h.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[a.order_num," - ",a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>A(a.uuid),children:"delete"})]},a.uuid))]})]})}var A=a.i(10098),B=(0,n.createServerReference)("70456b0e211f7e701155e4b9d7697547f0cd7c8d23",n.callServer,void 0,n.findSourceMapURL,"saveAudio");function C({email:a}){let[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=c.default.useState(!1),[r,s]=(0,c.useState)([]),[w,x]=c.default.useState(!1),[y,C]=c.default.useState(!1),D=(0,c.useRef)([]),E=(0,c.useRef)(null),F=async a=>{C(!0);let b=await u(a);"success"===b.status&&s(b.data.map(a=>({...(0,m.toExactType)(a),modified_db:!1,modified_fs:!1}))),C(!1)},G=(a,b,c,d)=>{s(e=>e.map(e=>e.uuid===a?{...e,original:b||e.original,recognized:c||e.recognized,audioBlob:d||e.audioBlob,modified_db:!!b,modified_fs:!!d}:e))},H=a=>{s(b=>b.filter(b=>b.uuid!==a))},I=async()=>{try{await Promise.all(r.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await B(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");s(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_fs:!1}:a))}if(b.modified_db){let d=await v({uuid:b.uuid,chapter_uuid:h,order_num:c,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed");s(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_db:!1}:a))}return!0})),k.toast.success("All sentences saved successfully!")}catch(a){k.toast.error(a.message||"Failed to save sentences")}},J=async()=>{x(await (0,A.checkSTTServiceStatus)())};return(0,c.useEffect)(()=>{let a=a=>{if(a.ctrlKey&&"y"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}};document.addEventListener("keydown",a),J();let b=setInterval(J,3e4);return()=>{clearInterval(b),window.removeEventListener("keydown",a)}},[n,p]),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,b.jsxs)(d.Button,{size:"sm",variant:"solid",color:w?"success":"danger",onPress:J,children:["Speech-to-Text service is ",w?"available":"not available",", click to refresh"]})}),(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsx)(t,{user_id:a,onSelect:async a=>{g(a)}}),(0,b.jsx)(z,{user_id:a,book_uuid:f,onSelect:async a=>{i(a),await F(a)}})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!n&&p,onPress:()=>{f&&h?(0,j.toggleRecording)(n,o,D,E,w,q,a=>{console.log(a)},(a,b)=>{"success"===a.status?s(c=>[...c,{uuid:(0,m.getUUID)(),chapter_uuid:"",order_num:r.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):k.toast.error(a.error)}):alert("select book and chapter first")},children:n?"‚èπ Stop Recording (Ctrl+Y)":"üé§ Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:I,children:"save all sentences"})]}),y&&(0,b.jsx)(e.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),r.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...r].reverse().map(a=>(0,b.jsx)(l,{rsp:a,onUpdate:G,onDelete:H},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map