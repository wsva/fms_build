module.exports=[23614,a=>{"use strict";a.s(["default",()=>H],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(72571),f=a.i(47977),g=a.i(84476),h=a.i(88206),i=a.i(328),j=a.i(84850),k=a.i(20094);function l(a){return(a=a.replace(/\s+/g," ").trim())?a.split(/(\s+|[.,!?;:\-—()"'“”„«»…])/).filter(a=>null!=a&&""!==a).filter(a=>a.trim().length>0||" "===a):[]}function m(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var n=a.i(5050),o=(0,n.createServerReference)("60a7cf5dba0891e624e5cedd27b1f70241153b8f34",n.callServer,void 0,n.findSourceMapURL,"removeAudio"),p=(0,n.createServerReference)("707142c7e23c3e36f12ee3106812a99288fe0f71bd",n.callServer,void 0,n.findSourceMapURL,"saveAudio"),q=(0,n.createServerReference)("401218469ca26f3a848a312a5c84569cbd1a46ad72",n.callServer,void 0,n.findSourceMapURL,"removeSentence"),r=(0,n.createServerReference)("40f5266c6f2b7a67540c13b3ee0e1eccae835b54b5",n.callServer,void 0,n.findSourceMapURL,"saveSentence");function s({user_id:a,item:e,onUpdate:n,onDelete:s}){let[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(e),[z,A]=(0,c.useState)(!1),B=(0,c.useRef)([]),C=(0,c.useRef)(null),D=async()=>{x.modified_fs&&x.audioBlob&&("success"===(await p(x.audioBlob,"reading",`${x.uuid}.wav`)).status?(k.toast.success("save audio success"),y({...x,modified_fs:!1})):k.toast.error("save audio failed")),x.modified_db&&("success"===(await r({...x,audio_path:`/api/data/reading/${x.uuid}.wav`,created_by:a,created_at:x.created_at||new Date,updated_at:new Date})).status?(k.toast.success("save sentence success"),y({...x,modified_db:!1})):k.toast.error("save sentence failed")),n(x)},E=async()=>"success"!==(await o("reading",`${x.uuid}.wav`)).status?void k.toast.error("save audio failed"):(k.toast.success("save audio success"),"success"!==(await q(x.uuid)).status)?void k.toast.error("save sentence failed"):(k.toast.success("save sentence success"),void s(x.uuid));return(0,b.jsxs)("div",{className:"flex flex-col w-full gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,b.jsx)("div",{className:"text-xl",children:((a,c)=>{let d=l(a),e=l(c),{matchesB:f}=function(a,b){let c=a.length,d=b.length,e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let f=c-1;f>=0;f--)for(let c=d-1;c>=0;c--)a[f]===b[c]?e[f][c]=1+e[f+1][c+1]:e[f][c]=Math.max(e[f+1][c],e[f][c+1]);let f=0,g=0,h=[];for(;f<c&&g<d;)a[f]===b[g]?(h.push(g),f++,g++):e[f+1][g]>=e[f][g+1]?f++:g++;return{matchesB:h}}(d,e),g=new Set(f);return e.map((a,c)=>g.has(c)?(0,b.jsx)("span",{children:m(a)},c):(0,b.jsx)("span",{style:{background:"#ffeb3b"},children:m(a)},c))})(x.original,x.recognized)})]}),z?(0,b.jsx)(g.Textarea,{label:"original text",size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:x.original,onChange:a=>{y({...x,original:a.target.value,modified_db:!0}),n(x)}}):(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"text-md text-gray-400",children:"original text:"}),(0,b.jsx)("div",{className:"text-xl",children:x.original})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,b.jsx)("div",{className:"text-red-500 w-full",children:x.modified_db||x.modified_fs?"unsaved":""}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"edit original",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>A(!z),children:z?(0,b.jsx)(i.MdEditOff,{size:30}):(0,b.jsx)(i.MdEdit,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:D,children:(0,b.jsx)(i.MdOutlineSave,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!t&&v,onPress:()=>{(0,j.toggleRecording)(t,u,B,C,!0,w,a=>{console.log(a)},(a,b)=>{"success"===a.status?(y({...x,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}),n(x)):k.toast.error(a.error)})},children:t?(0,b.jsx)(i.MdMic,{size:30}):(0,b.jsx)(i.MdMicOff,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(x.audioBlob?URL.createObjectURL(x.audioBlob):x.audio_path).play()},children:(0,b.jsx)(i.MdPlayCircle,{size:30})})}),(0,b.jsx)(h.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:f.Link,href:x.audioBlob?URL.createObjectURL(x.audioBlob):x.audio_path,download:`reading_${x.uuid}.wav`,children:(0,b.jsx)(i.MdDownloadForOffline,{size:30})})}),(0,b.jsx)(h.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:E,children:(0,b.jsx)(i.MdDelete,{size:30})})})]})]})}var t=a.i(68114),u=(0,n.createServerReference)("404e39daa266800bfab84af6a3ff8c8bb4b665070a",n.callServer,void 0,n.findSourceMapURL,"getBookAll"),v=a.i(97148),w=a.i(81390),x=a.i(75090),y=a.i(4655),z=a.i(24647);function A({user_id:a,onSelect:e}){let[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(""),[j,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),o=async()=>{let b=await u(a);"success"===b.status&&g(b.data)},p=async()=>{if(!a)return void k.toast.error("not logged in");n(!0),"success"===(await (0,w.saveBook)({uuid:(0,t.getUUID)(),user_id:a,name:h,created_by:a,created_at:new Date,updated_at:new Date})).status?(k.toast.success("save book success"),i("")):k.toast.error("save book failed"),n(!1)},q=async a=>{n(!0),"success"===(await (0,v.removeBook)(a)).status?k.toast.success("delete book success"):k.toast.error("delete book failed"),n(!1)};return(0,c.useEffect)(()=>{o()},[h]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(y.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;await e(b)},children:f.map(a=>(0,b.jsx)(z.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>l(!j),children:j?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:o,children:"refresh"})]}),j&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(x.Input,{label:"Name of Book",size:"sm",onChange:a=>i(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:m,onPress:p,children:"add"})]}),f.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>q(a.uuid),children:"delete"})]},a.uuid))]})]})}var B=(0,n.createServerReference)("407f93ffd293bb40245876d20b937dffb4f78fb3e9",n.callServer,void 0,n.findSourceMapURL,"getSentenceAll"),C=(0,n.createServerReference)("40ec7e8fdc94232e6bd976e3bbead4c41e1bc9e0cc",n.callServer,void 0,n.findSourceMapURL,"getChapterAll"),D=(0,n.createServerReference)("403e8dda2c014db1a9522ebc9af1bb1eb29bad6fc3",n.callServer,void 0,n.findSourceMapURL,"removeChapter"),E=(0,n.createServerReference)("408f391ab831c77f31a6c2112a8ba200423efa97e3",n.callServer,void 0,n.findSourceMapURL,"saveChapter");function F({user_id:a,book_uuid:e,onSelect:f}){let[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(!1),r=async()=>{let a=await C(e);"success"===a.status&&h(a.data)},s=async()=>a?e?void(q(!0),"success"===(await E({uuid:(0,t.getUUID)(),book_uuid:e,order_num:parseInt(i,10),name:l,created_by:a,created_at:new Date,updated_at:new Date})).status?(k.toast.success("save chapter success"),m("")):k.toast.error("save chapter failed"),q(!1)):void k.toast.error("no book selected"):void k.toast.error("not logged in"),u=async a=>{q(!0),"success"===(await D(a)).status?k.toast.success("delete chapter success"):k.toast.error("delete chapter failed"),q(!1)};return(0,c.useEffect)(()=>{r()},[e,l]),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(y.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;await f(b)},children:g.map(a=>(0,b.jsxs)(z.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>o(!n),children:n?"finish":"edit"}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:r,children:"refresh"})]}),n&&(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,b.jsx)(x.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:a=>j(a.target.value)}),(0,b.jsx)(x.Input,{label:"Name of Book",size:"sm",onChange:a=>m(a.target.value)}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",isDisabled:p,onPress:s,children:"add"})]}),g.map(a=>(0,b.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[a.order_num," - ",a.name,(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:()=>u(a.uuid),children:"delete"})]},a.uuid))]})]})}var G=a.i(69268);function H({email:a}){let[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),[l,m]=(0,c.useState)(!1),[n,o]=c.default.useState(!1),[q,u]=(0,c.useState)([]),[v,w]=c.default.useState(!1),[x,y]=c.default.useState(!1),z=(0,c.useRef)([]),C=(0,c.useRef)(null),D=async a=>{y(!0);let b=await B(a);"success"===b.status&&u(b.data.map(a=>({...(0,t.toExactType)(a),modified_db:!1,modified_fs:!1}))),y(!1)},E=a=>{u(b=>b.map(b=>b.uuid===a.uuid?a:b))},H=a=>{u(b=>b.filter(b=>b.uuid!==a))},I=async()=>{try{await Promise.all(q.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await p(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");u(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_fs:!1}:a))}if(b.modified_db){let d=await r({uuid:b.uuid,chapter_uuid:h,order_num:c,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed");u(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_db:!1}:a))}return!0})),k.toast.success("All sentences saved successfully!")}catch(a){k.toast.error(a.message||"Failed to save sentences")}},J=async()=>{w(await (0,G.checkSTTServiceStatus)())};return(0,c.useEffect)(()=>{let a=a=>{if(a.ctrlKey&&"y"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}};document.addEventListener("keydown",a),J();let b=setInterval(J,3e4);return()=>{clearInterval(b),window.removeEventListener("keydown",a)}},[l,n]),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,b.jsxs)(d.Button,{size:"sm",variant:"solid",color:v?"success":"danger",onPress:J,children:["Speech-to-Text service is ",v?"available":"not available",", click to refresh"]})}),(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsx)(A,{user_id:a,onSelect:async a=>{g(a)}}),(0,b.jsx)(F,{user_id:a,book_uuid:f,onSelect:async a=>{i(a),await D(a)}})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!l&&n,onPress:()=>{f&&h?(0,j.toggleRecording)(l,m,z,C,v,o,a=>{console.log(a)},(a,b)=>{"success"===a.status?u(c=>[...c,{uuid:(0,t.getUUID)(),chapter_uuid:"",order_num:q.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):k.toast.error(a.error)}):alert("select book and chapter first")},children:l?"⏹ Stop Recording (Ctrl+Y)":"🎤 Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:I,children:"save all sentences"})]}),x&&(0,b.jsx)(e.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),q.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...q].reverse().map(c=>(0,b.jsx)(s,{user_id:a,item:c,onUpdate:E,onDelete:H},c.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map