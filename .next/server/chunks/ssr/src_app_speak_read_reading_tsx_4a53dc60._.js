module.exports=[23614,a=>{"use strict";a.s(["default",()=>E],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(21694),f=a.i(3220),g=a.i(92481),h=a.i(4655),i=a.i(24647),j=a.i(72571),k=a.i(75090),l=a.i(47977),m=a.i(88206),n=a.i(328),o=a.i(84850),p=a.i(20094);function q({rsp:a,onUpdate:e,onDelete:f}){let[g,h]=(0,c.useState)(!1),[i,j]=c.default.useState(!1),[q,r]=(0,c.useState)(a.original),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)([]),v=(0,c.useRef)(null);return(0,b.jsxs)("div",{className:"flex flex-col w-full gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(m.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,b.jsx)(n.MdHelpOutline,{size:24})}),s?(0,b.jsx)(k.Input,{size:"lg",className:"w-full",onValueChange:b=>{r(b),e(a.uuid,b,"",null)},value:q}):(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:q}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(m.Tooltip,{content:s?"done":"edit",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>t(!s),children:s?(0,b.jsx)(n.MdDone,{size:30}):(0,b.jsx)(n.MdEdit,{size:30})})}),(0,b.jsx)(m.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>f(a.uuid),children:(0,b.jsx)(n.MdDelete,{size:30})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(m.Tooltip,{placement:"right",content:"recognised from audio",children:(0,b.jsx)(n.MdHelpOutline,{size:24})}),(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:a.recognized}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!g&&i,onPress:()=>{(0,o.toggleRecording)(g,h,u,v,!0,j,a=>{console.log(a)},(b,c)=>{"success"===b.status?e(a.uuid,"",b.data,c):p.toast.error(b.error)})},children:g?(0,b.jsx)(n.MdMic,{size:30}):(0,b.jsx)(n.MdMicOff,{size:30})})}),(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,b.jsx)(n.MdPlayCircle,{size:30})})}),(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:l.Link,href:a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path,download:`reading_${a.uuid}.wav`,children:(0,b.jsx)(n.MdDownloadForOffline,{size:30})})})]})]}),(a.modified_db||a.modified_fs)&&(0,b.jsx)("div",{className:"text-red-500",children:"unsaved"})]})}var r=a.i(68114),s=a.i(39210),t=a.i(95245);function u({email:a}){let{register:d,handleSubmit:e}=(0,t.useForm)(),[f,g]=c.default.useState(!1),h=async b=>{if(g(!0),!a){p.toast.error("not logged in"),g(!1);return}if("success"===(await (0,s.saveBook)({...b,uuid:(0,r.getUUID)(),user_id:a,created_by:a,created_at:new Date,updated_at:new Date})).status)p.toast.success("save book success");else{p.toast.error("save book failed"),g(!1);return}};return(0,b.jsx)("form",{onSubmit:e(h),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(k.Input,{label:"Name",variant:"bordered",size:"sm",...d("name")}),(0,b.jsx)(l.Link,{as:"button",isDisabled:f,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new book"})]})})}var v=a.i(5050),w=(0,v.createServerReference)("40950cbe15b0d077ece61af67ba941d5c8426310c6",v.callServer,void 0,v.findSourceMapURL,"getBookAll"),x=(0,v.createServerReference)("40808bc8e00ed6faa7062798ae89866c9bec60d14a",v.callServer,void 0,v.findSourceMapURL,"getChapterAll"),y=(0,v.createServerReference)("40f1ea34084732e3f1028514afd9b2415f51cd7f11",v.callServer,void 0,v.findSourceMapURL,"getSentenceAll"),z=(0,v.createServerReference)("40152add411a10d61c1a41e52571ee20284c39e87e",v.callServer,void 0,v.findSourceMapURL,"saveSentence"),A=(0,v.createServerReference)("403492b1442a1ab10ddf407145e51c59bd3d9c7330",v.callServer,void 0,v.findSourceMapURL,"saveChapter");function B({book_uuid:a,email:d}){let{register:e,handleSubmit:f}=(0,t.useForm)(),[g,h]=c.default.useState(!1),i=async b=>{if(h(!0),!a){p.toast.error("no book selected"),h(!1);return}if(!d){p.toast.error("not logged in"),h(!1);return}if("success"===(await A({...b,uuid:(0,r.getUUID)(),book_uuid:a,order_num:parseInt(`${b.order_num}`,10),created_by:d,created_at:new Date,updated_at:new Date})).status)p.toast.success("save chapter success");else{p.toast.error("save chapter failed"),h(!1);return}};return(0,b.jsx)("form",{onSubmit:f(i),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(k.Input,{label:"Order",variant:"bordered",type:"number",size:"sm",...e("order_num")}),(0,b.jsx)(k.Input,{label:"Name",variant:"bordered",size:"sm",...e("name")}),(0,b.jsx)(l.Link,{as:"button",isDisabled:g,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new chapter"})]})})}var C=a.i(77220),D=(0,v.createServerReference)("70d34a1c9c9123d474972dd50bb7306d42410a70ad",v.callServer,void 0,v.findSourceMapURL,"saveAudio");function E({email:a}){let[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),[s,t]=(0,c.useState)([]),[v,A]=(0,c.useState)(""),[E,F]=(0,c.useState)(!1),[G,H]=c.default.useState(!1),[I,J]=(0,c.useState)([]),[K,L]=c.default.useState(!1),[M,N]=c.default.useState(!1),O=(0,c.useRef)([]),P=(0,c.useRef)(null),Q=async a=>{N(!0);let b=await w(a);"success"===b.status&&l(b.data),N(!1)},R=async a=>{N(!0);let b=await x(a);"success"===b.status&&t(b.data),N(!1)},S=async a=>{N(!0);let b=await y(a);"success"===b.status&&J(b.data.map(a=>({...(0,r.toExactType)(a),modified_db:!1,modified_fs:!1}))),N(!1)},T=(a,b,c,d)=>{J(e=>e.map(e=>e.uuid===a?{...e,original:b||e.original,recognized:c||e.recognized,audioBlob:d||e.audioBlob,modified_db:!!b,modified_fs:!!d}:e))},U=a=>{J(b=>b.filter(b=>b.uuid!==a))},V=async()=>{try{await Promise.all(I.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await D(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");J(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_fs:!1}:a))}if(b.modified_db){let d=await z({uuid:b.uuid,chapter_uuid:v,order_num:c,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed");J(a=>a.map(a=>a.uuid===b.uuid?{...a,modified_db:!1}:a))}return!0})),p.toast.success("All sentences saved successfully!")}catch(a){p.toast.error(a.message||"Failed to save sentences")}},W=async()=>{L(await (0,C.checkSTTServiceStatus)())};return(0,c.useEffect)(()=>{(async()=>{a&&await Q(a)})();let b=a=>{if(a.ctrlKey&&"y"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}};document.addEventListener("keydown",b),W();let c=setInterval(W,3e4);return()=>{clearInterval(c),window.removeEventListener("keydown",b)}},[E,G]),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,b.jsxs)(d.Button,{size:"sm",variant:"solid",color:K?"success":"danger",onPress:W,children:["Speech-to-Text service is ",K?"available":"not available",", click to refresh"]})}),(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;n(b),await R(b)},children:k.map(a=>(0,b.jsx)(i.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(u,{email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>await Q(a),children:"refresh"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;A(b),await S(b)},children:s.map(a=>(0,b.jsxs)(i.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(B,{book_uuid:m,email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>await R(m),children:"refresh"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!E&&G,onPress:()=>{m&&v?(0,o.toggleRecording)(E,F,O,P,K,H,a=>{console.log(a)},(a,b)=>{"success"===a.status?J(c=>[...c,{uuid:(0,r.getUUID)(),chapter_uuid:"",order_num:I.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):p.toast.error(a.error)}):alert("select book and chapter first")},children:E?"â¹ Stop Recording (Ctrl+Y)":"ðŸŽ¤ Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:V,children:"save all sentences"})]}),M&&(0,b.jsx)(j.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),I.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...I].reverse().map(a=>(0,b.jsx)(q,{rsp:a,onUpdate:T,onDelete:U},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map