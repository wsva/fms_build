module.exports=[23614,a=>{"use strict";a.s(["default",()=>D],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(21694),f=a.i(3220),g=a.i(92481),h=a.i(4655),i=a.i(24647),j=a.i(75090),k=a.i(47977),l=a.i(88206),m=a.i(328),n=a.i(84850),o=a.i(20094);function p({rsp:a,onUpdate:e,onDelete:f}){let[g,h]=(0,c.useState)(!1),[i,p]=c.default.useState(!1),[q,r]=(0,c.useState)(a.original),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)([]),v=(0,c.useRef)(null);return(0,b.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(l.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,b.jsx)(m.MdHelpOutline,{size:24})}),s?(0,b.jsx)(j.Input,{size:"lg",className:"w-full",onValueChange:b=>{r(b),e(a.uuid,b,"",null)},value:q}):(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:q}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(l.Tooltip,{content:s?"done":"edit",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>t(!s),children:s?(0,b.jsx)(m.MdDone,{size:30}):(0,b.jsx)(m.MdEdit,{size:30})})}),(0,b.jsx)(l.Tooltip,{content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{},children:(0,b.jsx)(m.MdSave,{size:30})})}),(0,b.jsx)(l.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>f(a.uuid),children:(0,b.jsx)(m.MdDelete,{size:30})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(l.Tooltip,{placement:"right",content:"recognised from audio",children:(0,b.jsx)(m.MdHelpOutline,{size:24})}),(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:a.recognized}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!g&&i,onPress:()=>{(0,n.toggleRecording)(g,h,u,v,!0,p,a=>{console.log(a)},(b,c)=>{"success"===b.status?e(a.uuid,"",b.data,c):o.toast.error(b.error)})},children:g?(0,b.jsx)(m.MdMic,{size:30}):(0,b.jsx)(m.MdMicOff,{size:30})})}),(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,b.jsx)(m.MdPlayCircle,{size:30})})}),(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:k.Link,href:a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path,download:"sentence.wav",children:(0,b.jsx)(m.MdDownloadForOffline,{size:30})})})]})]})]})}var q=a.i(68114),r=a.i(29210),s=a.i(95245);function t({email:a}){let{register:d,handleSubmit:e}=(0,s.useForm)(),[f,g]=c.default.useState(!1),h=async b=>{if(g(!0),!a){o.toast.error("not logged in"),g(!1);return}if("success"===(await (0,r.saveBook)({...b,uuid:(0,q.getUUID)(),user_id:a,created_by:a,created_at:new Date,updated_at:new Date})).status)o.toast.success("save book success");else{o.toast.error("save book failed"),g(!1);return}};return(0,b.jsx)("form",{onSubmit:e(h),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(j.Input,{label:"Name",variant:"bordered",size:"sm",...d("name")}),(0,b.jsx)(k.Link,{as:"button",isDisabled:f,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new book"})]})})}var u=a.i(5050),v=(0,u.createServerReference)("40596cdaa2d07ce59d501b98e173ad35158aa0f6e0",u.callServer,void 0,u.findSourceMapURL,"getBookAll"),w=(0,u.createServerReference)("40a25bb3b9e4ead39e861e48e73e220ce1e53bba2f",u.callServer,void 0,u.findSourceMapURL,"getChapterAll"),x=(0,u.createServerReference)("408604fa4e1bcce96c36d3ada1242803e7abe29c87",u.callServer,void 0,u.findSourceMapURL,"getSentenceAll"),y=(0,u.createServerReference)("40eeb070bcb22c88b97845b5c616d2fc54e272862e",u.callServer,void 0,u.findSourceMapURL,"saveSentence"),z=(0,u.createServerReference)("406cb68d701b0369b0d43174b08affd6ad3d93597d",u.callServer,void 0,u.findSourceMapURL,"saveChapter");function A({book_uuid:a,email:d}){let{register:e,handleSubmit:f}=(0,s.useForm)(),[g,h]=c.default.useState(!1),i=async b=>{if(h(!0),!a){o.toast.error("no book selected"),h(!1);return}if(!d){o.toast.error("not logged in"),h(!1);return}if("success"===(await z({...b,uuid:(0,q.getUUID)(),book_uuid:a,order_num:parseInt(`${b.order_num}`,10),created_by:d,created_at:new Date,updated_at:new Date})).status)o.toast.success("save chapter success");else{o.toast.error("save chapter failed"),h(!1);return}};return(0,b.jsx)("form",{onSubmit:f(i),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(j.Input,{label:"Order",variant:"bordered",type:"number",size:"sm",...e("order_num")}),(0,b.jsx)(j.Input,{label:"Name",variant:"bordered",size:"sm",...e("name")}),(0,b.jsx)(k.Link,{as:"button",isDisabled:g,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new chapter"})]})})}var B=a.i(4851),C=(0,u.createServerReference)("703bb79dc2ac4cd4e855cdf4359c54370760bcf6e2",u.callServer,void 0,u.findSourceMapURL,"saveAudio");function D({email:a}){let[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),[u,z]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),[F,G]=c.default.useState(!1),[H,I]=(0,c.useState)([]),[J,K]=c.default.useState(!1),L=(0,c.useRef)([]),M=(0,c.useRef)(null),N=(a,b,c,d)=>{I(e=>e.map(e=>e.uuid===a?{uuid:e.uuid,chapter_uuid:e.chapter_uuid,order_num:e.order_num,original:b||e.original,recognized:c||e.recognized,audioBlob:d||e.audioBlob,modified_db:!!b,modified_fs:!!d}:e))},O=a=>{I(b=>b.filter(b=>b.uuid!==a))},P=async()=>{try{await Promise.all(H.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await C(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed")}if(b.modified_db){let d=await y({uuid:b.uuid,chapter_uuid:u,order_num:c,original:b.original,recognized:b.recognized,audio_path:`/data/reading/${b.uuid}.wav`,created_by:a,created_at:new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed")}return!0})),o.toast.success("All sentences saved successfully!")}catch(a){o.toast.error(a.message||"Failed to save sentences")}},Q=async()=>{K(await (0,B.checkSTTServiceStatus)())};return(0,c.useEffect)(()=>{(async()=>{if(!a)return;let b=await v(a);"success"===b.status&&k(b.data)})();let b=a=>{if("Space"===a.code){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}};document.addEventListener("keydown",b),Q();let c=setInterval(Q,3e4);return()=>{clearInterval(c),window.removeEventListener("keydown",b)}},[D,F]),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,b.jsxs)(d.Button,{size:"sm",variant:"solid",color:J?"success":"danger",onPress:Q,children:["Speech-to-Text service is ",J?"available":"not available",", click to refresh"]})}),(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;m(b);let c=await w(b);"success"===c.status&&s(c.data)},children:j.map(a=>(0,b.jsx)(i.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(t,{email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>{let b=await v(a);"success"===b.status&&k(b.data)},children:"refresh"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;z(b);let c=await x(b);"success"===c.status&&I(c.data.map(a=>({...a,modified_db:!1,modified_fs:!1})))},children:r.map(a=>(0,b.jsxs)(i.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(A,{book_uuid:l,email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>{let a=await w(l);"success"===a.status&&s(a.data)},children:"refresh"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!D&&F,onPress:()=>{l&&u?(0,n.toggleRecording)(D,E,L,M,J,G,a=>{console.log(a)},(a,b)=>{"success"===a.status?I(c=>[...c,{uuid:(0,q.getUUID)(),chapter_uuid:"",order_num:H.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):o.toast.error(a.error)}):alert("select book and chapter first")},children:D?"⏹ Stop Recording (SPACE)":"🎤 Speak a Sentence (SPACE)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:P,children:"save all sentences"})]}),H.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...H].reverse().map(a=>(0,b.jsx)(p,{rsp:a,onUpdate:N,onDelete:O},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map