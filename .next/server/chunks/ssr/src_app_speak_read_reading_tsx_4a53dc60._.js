module.exports=[23614,a=>{"use strict";a.s(["default",()=>au],23614);var b,c=a.i(87924),d=a.i(72131),e=Symbol.for("immer-nothing"),f=Symbol.for("immer-draftable"),g=Symbol.for("immer-state");function h(a){throw Error(`[Immer] minified error nr: ${a}. Full error at: https://bit.ly/3cXEKWf`)}var i=Object.getPrototypeOf;function j(a){return!!a&&!!a[g]}function k(a){return!!a&&(m(a)||Array.isArray(a)||!!a[f]||!!a.constructor?.[f]||r(a)||s(a))}var l=Object.prototype.constructor.toString();function m(a){if(!a||"object"!=typeof a)return!1;let b=i(a);if(null===b)return!0;let c=Object.hasOwnProperty.call(b,"constructor")&&b.constructor;return c===Object||"function"==typeof c&&Function.toString.call(c)===l}function n(a,b){0===o(a)?Reflect.ownKeys(a).forEach(c=>{b(c,a[c],a)}):a.forEach((c,d)=>b(d,c,a))}function o(a){let b=a[g];return b?b.type_:Array.isArray(a)?1:r(a)?2:3*!!s(a)}function p(a,b){return 2===o(a)?a.has(b):Object.prototype.hasOwnProperty.call(a,b)}function q(a,b,c){let d=o(a);2===d?a.set(b,c):3===d?a.add(c):a[b]=c}function r(a){return a instanceof Map}function s(a){return a instanceof Set}function t(a){return a.copy_||a.base_}function u(a,b){if(r(a))return new Map(a);if(s(a))return new Set(a);if(Array.isArray(a))return Array.prototype.slice.call(a);let c=m(a);if(!0!==b&&("class_only"!==b||c)){let b=i(a);return null!==b&&c?{...a}:Object.assign(Object.create(b),a)}{let b=Object.getOwnPropertyDescriptors(a);delete b[g];let c=Reflect.ownKeys(b);for(let d=0;d<c.length;d++){let e=c[d],f=b[e];!1===f.writable&&(f.writable=!0,f.configurable=!0),(f.get||f.set)&&(b[e]={configurable:!0,writable:!0,enumerable:f.enumerable,value:a[e]})}return Object.create(i(a),b)}}function v(a,b=!1){return x(a)||j(a)||!k(a)||(o(a)>1&&Object.defineProperties(a,{set:{value:w},add:{value:w},clear:{value:w},delete:{value:w}}),Object.freeze(a),b&&Object.values(a).forEach(a=>v(a,!0))),a}function w(){h(2)}function x(a){return Object.isFrozen(a)}var y={};function z(a){let b=y[a];return b||h(0,a),b}function A(a,b){b&&(z("Patches"),a.patches_=[],a.inversePatches_=[],a.patchListener_=b)}function B(a){C(a),a.drafts_.forEach(E),a.drafts_=null}function C(a){a===b&&(b=a.parent_)}function D(a){return b={drafts_:[],parent_:b,immer_:a,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function E(a){let b=a[g];0===b.type_||1===b.type_?b.revoke_():b.revoked_=!0}function F(a,b){b.unfinalizedDrafts_=b.drafts_.length;let c=b.drafts_[0];return void 0!==a&&a!==c?(c[g].modified_&&(B(b),h(4)),k(a)&&(a=G(b,a),b.parent_||I(b,a)),b.patches_&&z("Patches").generateReplacementPatches_(c[g].base_,a,b.patches_,b.inversePatches_)):a=G(b,c,[]),B(b),b.patches_&&b.patchListener_(b.patches_,b.inversePatches_),a!==e?a:void 0}function G(a,b,c){if(x(b))return b;let d=b[g];if(!d)return n(b,(e,f)=>H(a,d,b,e,f,c)),b;if(d.scope_!==a)return b;if(!d.modified_)return I(a,d.base_,!0),d.base_;if(!d.finalized_){d.finalized_=!0,d.scope_.unfinalizedDrafts_--;let b=d.copy_,e=b,f=!1;3===d.type_&&(e=new Set(b),b.clear(),f=!0),n(e,(e,g)=>H(a,d,b,e,g,c,f)),I(a,b,!1),c&&a.patches_&&z("Patches").generatePatches_(d,c,a.patches_,a.inversePatches_)}return d.copy_}function H(a,b,c,d,e,f,g){if(j(e)){let g=G(a,e,f&&b&&3!==b.type_&&!p(b.assigned_,d)?f.concat(d):void 0);if(q(c,d,g),!j(g))return;a.canAutoFreeze_=!1}else g&&c.add(e);if(k(e)&&!x(e)){if(!a.immer_.autoFreeze_&&a.unfinalizedDrafts_<1)return;G(a,e),(!b||!b.scope_.parent_)&&"symbol"!=typeof d&&(r(c)?c.has(d):Object.prototype.propertyIsEnumerable.call(c,d))&&I(a,e)}}function I(a,b,c=!1){!a.parent_&&a.immer_.autoFreeze_&&a.canAutoFreeze_&&v(b,c)}var J={get(a,b){if(b===g)return a;let c=t(a);if(!p(c,b)){var d=a,e=c,f=b;let g=M(e,f);return g?"value"in g?g.value:g.get?.call(d.draft_):void 0}let h=c[b];return a.finalized_||!k(h)?h:h===L(a.base_,b)?(O(a),a.copy_[b]=P(h,a)):h},has:(a,b)=>b in t(a),ownKeys:a=>Reflect.ownKeys(t(a)),set(a,b,c){let d=M(t(a),b);if(d?.set)return d.set.call(a.draft_,c),!0;if(!a.modified_){let d=L(t(a),b),e=d?.[g];if(e&&e.base_===c)return a.copy_[b]=c,a.assigned_[b]=!1,!0;if((c===d?0!==c||1/c==1/d:c!=c&&d!=d)&&(void 0!==c||p(a.base_,b)))return!0;O(a),N(a)}return!!(a.copy_[b]===c&&(void 0!==c||b in a.copy_)||Number.isNaN(c)&&Number.isNaN(a.copy_[b]))||(a.copy_[b]=c,a.assigned_[b]=!0,!0)},deleteProperty:(a,b)=>(void 0!==L(a.base_,b)||b in a.base_?(a.assigned_[b]=!1,O(a),N(a)):delete a.assigned_[b],a.copy_&&delete a.copy_[b],!0),getOwnPropertyDescriptor(a,b){let c=t(a),d=Reflect.getOwnPropertyDescriptor(c,b);return d?{writable:!0,configurable:1!==a.type_||"length"!==b,enumerable:d.enumerable,value:c[b]}:d},defineProperty(){h(11)},getPrototypeOf:a=>i(a.base_),setPrototypeOf(){h(12)}},K={};function L(a,b){let c=a[g];return(c?t(c):a)[b]}function M(a,b){if(!(b in a))return;let c=i(a);for(;c;){let a=Object.getOwnPropertyDescriptor(c,b);if(a)return a;c=i(c)}}function N(a){!a.modified_&&(a.modified_=!0,a.parent_&&N(a.parent_))}function O(a){a.copy_||(a.copy_=u(a.base_,a.scope_.immer_.useStrictShallowCopy_))}function P(a,c){let d=r(a)?z("MapSet").proxyMap_(a,c):s(a)?z("MapSet").proxySet_(a,c):function(a,c){let d=Array.isArray(a),e={type_:+!!d,scope_:c?c.scope_:b,modified_:!1,finalized_:!1,assigned_:{},parent_:c,base_:a,draft_:null,copy_:null,revoke_:null,isManual_:!1},f=e,g=J;d&&(f=[e],g=K);let{revoke:h,proxy:i}=Proxy.revocable(f,g);return e.draft_=i,e.revoke_=h,i}(a,c);return(c?c.scope_:b).drafts_.push(d),d}n(J,(a,b)=>{K[a]=function(){return arguments[0]=arguments[0][0],b.apply(this,arguments)}}),K.deleteProperty=function(a,b){return K.set.call(this,a,b,void 0)},K.set=function(a,b,c){return J.set.call(this,a[0],b,c,a[0])};var Q=new class{constructor(a){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(a,b,c)=>{let d;if("function"==typeof a&&"function"!=typeof b){let c=b;b=a;let d=this;return function(a=c,...e){return d.produce(a,a=>b.call(this,a,...e))}}if("function"!=typeof b&&h(6),void 0!==c&&"function"!=typeof c&&h(7),k(a)){let e=D(this),f=P(a,void 0),g=!0;try{d=b(f),g=!1}finally{g?B(e):C(e)}return A(e,c),F(d,e)}if(a&&"object"==typeof a)h(1,a);else{if(void 0===(d=b(a))&&(d=a),d===e&&(d=void 0),this.autoFreeze_&&v(d,!0),c){let b=[],e=[];z("Patches").generateReplacementPatches_(a,d,b,e),c(b,e)}return d}},this.produceWithPatches=(a,b)=>{let c,d;return"function"==typeof a?(b,...c)=>this.produceWithPatches(b,b=>a(b,...c)):[this.produce(a,b,(a,b)=>{c=a,d=b}),c,d]},"boolean"==typeof a?.autoFreeze&&this.setAutoFreeze(a.autoFreeze),"boolean"==typeof a?.useStrictShallowCopy&&this.setUseStrictShallowCopy(a.useStrictShallowCopy)}createDraft(a){var b;k(a)||h(8),j(a)&&(j(b=a)||h(10,b),a=function a(b){let c;if(!k(b)||x(b))return b;let d=b[g];if(d){if(!d.modified_)return d.base_;d.finalized_=!0,c=u(b,d.scope_.immer_.useStrictShallowCopy_)}else c=u(b,!0);return n(c,(b,d)=>{q(c,b,a(d))}),d&&(d.finalized_=!1),c}(b));let c=D(this),d=P(a,void 0);return d[g].isManual_=!0,C(c),d}finishDraft(a,b){let c=a&&a[g];c&&c.isManual_||h(9);let{scope_:d}=c;return A(d,b),F(void 0,d)}setAutoFreeze(a){this.autoFreeze_=a}setUseStrictShallowCopy(a){this.useStrictShallowCopy_=a}applyPatches(a,b){let c;for(c=b.length-1;c>=0;c--){let d=b[c];if(0===d.path.length&&"replace"===d.op){a=d.value;break}}c>-1&&(b=b.slice(c+1));let d=z("Patches").applyPatches_;return j(a)?d(a,b):this.produce(a,a=>d(a,b))}}().produce,R=a.i(32496),S=a.i(72571),T=a.i(84476),U=a.i(88206),V=a.i(328),W=a.i(84850),X=a.i(20094);function Y(a){return(a=a.replace(/\s+/g," ").trim())?a.split(/(\s+|[.,!?;:\-—()"'“”„«»…])/).filter(a=>null!=a&&""!==a).filter(a=>a.trim().length>0||" "===a):[]}function Z(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let $=(a,b)=>{let d=Y(a),e=Y(b),{matchesB:f}=function(a,b){let c=a.length,d=b.length,e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let f=c-1;f>=0;f--)for(let c=d-1;c>=0;c--)a[f]===b[c]?e[f][c]=1+e[f+1][c+1]:e[f][c]=Math.max(e[f+1][c],e[f][c+1]);let f=0,g=0,h=[];for(;f<c&&g<d;)a[f]===b[g]?(h.push(g),f++,g++):e[f+1][g]>=e[f][g+1]?f++:g++;return{matchesB:h}}(d,e),g=new Set(f);return e.map((a,b)=>g.has(b)?(0,c.jsx)("span",{children:Z(a)},b):(0,c.jsx)("span",{style:{background:"#ffeb3b"},children:Z(a)},b))};var _=a.i(5050),aa=(0,_.createServerReference)("60736db4faccddd5747216b015c6788e7be4ed4932",_.callServer,void 0,_.findSourceMapURL,"removeAudio"),ab=(0,_.createServerReference)("4059a41a4ba7fcc903248f3380d9e38e62aa3850bf",_.callServer,void 0,_.findSourceMapURL,"removeSentence"),ac=(0,_.createServerReference)("60c2b5c567ed266dd8ef878fdc457d7b256258e0a4",_.callServer,void 0,_.findSourceMapURL,"callTTS");function ad({item:a,onUpdate:b,onDelete:e}){let[f,g]=(0,d.useState)(!1),[h,i]=(0,d.useState)(!1),[j,k]=(0,d.useState)(!1),[l,m]=(0,d.useState)(!1),n=(0,d.useRef)([]),o=(0,d.useRef)(null),p=async()=>{if(a.on_fs){if("success"!==(await aa("reading",`${a.uuid}.wav`)).status)return void X.toast.error("delete audio failed");X.toast.success("delete audio success")}if(a.in_db){if("success"!==(await ab(a.uuid)).status)return void X.toast.error("delete sentence failed");X.toast.success("delete sentence success")}e(a.uuid)};return(0,c.jsxs)("div",{className:"flex flex-col items-start justify-start w-full bg-sand-300",children:[(0,c.jsxs)("div",{className:"flex flex-row items-start justify-start w-full my-2",children:[a.modified_db||a.modified_fs?(0,c.jsx)(U.Tooltip,{placement:"bottom",content:"unsaved",children:(0,c.jsx)("div",{className:"text-red-500",children:"●"})}):(0,c.jsx)("div",{className:"text-transparent",children:"●"}),(0,c.jsxs)("div",{className:"flex flex-col w-full ps-2",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start w-full",children:[(0,c.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"re-record",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:!f&&h,onPress:()=>{(0,W.toggleRecording)(f,g,n,o,!0,i,a=>{console.log(a)},(c,d)=>{"success"===c.status?b({...a,recognized:c.data,audioBlob:d,modified_db:!0,modified_fs:!0}):X.toast.error(c.error)})},children:f?(0,c.jsx)(V.MdMic,{size:20}):(0,c.jsx)(V.MdMicOff,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"play audio",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,c.jsx)(V.MdPlayCircle,{size:20})})})]}),(0,c.jsxs)("div",{className:"flex flex-row items-center justify-end",children:[(0,c.jsx)(U.Tooltip,{placement:"top",content:"show/hide original",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>m(!l),children:l?(0,c.jsx)(V.MdOutlineKeyboardDoubleArrowUp,{size:20}):(0,c.jsx)(V.MdOutlineKeyboardDoubleArrowDown,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"delete",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",color:"danger",className:"w-fit h-fit",onPress:()=>{window.confirm("Are you sure to delete?")&&p()},children:(0,c.jsx)(V.MdDelete,{size:20})})})]})]}),(0,c.jsx)("div",{className:"text-xl text-balance hyphens-auto",children:$(a.original,a.recognized)})]}),(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center w-fit gap-1",children:[(0,c.jsx)(U.Tooltip,{placement:"left",content:"move upward",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>b(a,a.order_num+1),children:(0,c.jsx)(V.MdArrowUpward,{size:20})})}),(0,c.jsx)("div",{children:a.order_num}),(0,c.jsx)(U.Tooltip,{placement:"left",content:"move downward",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>b(a,a.order_num-1),children:(0,c.jsx)(V.MdArrowDownward,{size:20})})})]})]}),l&&(0,c.jsx)("div",{className:"flex flex-row items-center justify-start w-full px-2 pb-1",children:(0,c.jsx)(T.Textarea,{size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:a.original,onChange:c=>{b({...a,original:c.target.value,modified_db:!0})},endContent:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:j,onPress:async()=>{let b=`/api/data/tts/${a.uuid}.wav`;if(!await fetch(b,{method:"HEAD"}).then(a=>a.ok).catch(()=>!1)){k(!0);let b=await ac(a.uuid,a.original);if(k(!1),"error"===b.status)return void console.error(b.error)}new Audio(b).play().catch(a=>console.error("error: ",a))},children:(0,c.jsx)(V.MdPlayCircle,{size:20})})})})]})}var ae=a.i(68114),af=(0,_.createServerReference)("402ff995d350b07b764be54afa108a9a015b7d4544",_.callServer,void 0,_.findSourceMapURL,"getBookAll"),ag=a.i(76311),ah=a.i(31465),ai=a.i(27493),aj=a.i(75090),ak=a.i(4655),al=a.i(24647);function am({user_id:a,onSelect:b}){let[e,f]=(0,d.useState)([]),[g,h]=(0,d.useState)(""),[i,j]=(0,d.useState)(!1),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(!1),o=async()=>{n(!0);let b=await af(a);"success"===b.status&&f(b.data),n(!1)},p=async()=>{if(!a)return void X.toast.error("not logged in");l(!0),"success"===(await (0,ah.saveBook)({uuid:(0,ae.getUUID)(),user_id:a,name:g,created_by:a,created_at:new Date,updated_at:new Date})).status?(X.toast.success("save book success"),h("")):X.toast.error("save book failed"),l(!1)},q=async a=>{l(!0),"success"===(await (0,ag.removeBook)(a)).status?X.toast.success("delete book success"):X.toast.error("delete book failed"),l(!1)};return(0,d.useEffect)(()=>{o()},[a]),(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsx)(ak.Select,{label:"Select book",onChange:async a=>{let c=a.target.value;await b(c)},endContent:m&&(0,c.jsx)(ai.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:e.map(a=>(0,c.jsx)(al.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,c.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>j(!i),children:i?"finish":"edit"}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:o,children:"refresh"})]}),i&&(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,c.jsx)(aj.Input,{label:"Name of Book",size:"sm",onChange:a=>h(a.target.value)}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",isDisabled:k,onPress:p,children:"add"})]}),e.map(a=>(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[a.name,(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>q(a.uuid),children:"delete"})]},a.uuid))]})]})}var an=(0,_.createServerReference)("40a951650ffb2cd77bdff5baf97151c8843f76d752",_.callServer,void 0,_.findSourceMapURL,"getSentenceAll"),ao=(0,_.createServerReference)("408a66ba5a7856434fdaf17e0919049ee187872d1c",_.callServer,void 0,_.findSourceMapURL,"saveSentence"),ap=(0,_.createServerReference)("404d323d76e9135dd0601aa83488fb1fb7325c730a",_.callServer,void 0,_.findSourceMapURL,"getChapterAll"),aq=(0,_.createServerReference)("40f066e5cdbce62d62f09c02908bb86dccdaf457fe",_.callServer,void 0,_.findSourceMapURL,"removeChapter"),ar=(0,_.createServerReference)("40eccee39391751d53ba855dbe4711cc360f31cc42",_.callServer,void 0,_.findSourceMapURL,"saveChapter");function as({user_id:a,book_uuid:b,onSelect:e}){let[f,g]=(0,d.useState)([]),[h,i]=(0,d.useState)(""),[j,k]=(0,d.useState)(""),[l,m]=(0,d.useState)(!1),[n,o]=(0,d.useState)(!1),[p,q]=(0,d.useState)(!1),r=async()=>{q(!0);let a=await ap(b);"success"===a.status&&g(a.data),q(!1)},s=async()=>a?b?void(o(!0),"success"===(await ar({uuid:(0,ae.getUUID)(),book_uuid:b,order_num:parseInt(h,10),name:j,created_by:a,created_at:new Date,updated_at:new Date})).status?(X.toast.success("save chapter success"),k("")):X.toast.error("save chapter failed"),o(!1)):void X.toast.error("no book selected"):void X.toast.error("not logged in"),t=async a=>{o(!0),"success"===(await aq(a)).status?X.toast.success("delete chapter success"):X.toast.error("delete chapter failed"),o(!1)};return(0,d.useEffect)(()=>{r()},[b]),(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsx)(ak.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;await e(b)},endContent:p&&(0,c.jsx)(ai.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:f.map(a=>(0,c.jsxs)(al.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,c.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>m(!l),children:l?"finish":"edit"}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:r,children:"refresh"})]}),l&&(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,c.jsx)(aj.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:a=>i(a.target.value)}),(0,c.jsx)(aj.Input,{label:"Name of Book",size:"sm",onChange:a=>k(a.target.value)}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",isDisabled:n,onPress:s,children:"add"})]}),f.map(a=>(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[a.order_num," - ",a.name,(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>t(a.uuid),children:"delete"})]},a.uuid))]})]})}var at=(0,_.createServerReference)("701399286ebb28fa272135bd450c13ddbbaa78738d",_.callServer,void 0,_.findSourceMapURL,"saveAudio");function au({email:a}){var b,e,f;let[g,h]=(0,d.useState)(""),[i,j]=(0,d.useState)(""),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(!1),[o,p]=(0,d.useState)(),[q,r]=(b=[],f=(e=(0,d.useState)(function(){return v("function"==typeof b?b():b,!0)}))[1],[e[0],(0,d.useCallback)(function(a){f("function"==typeof a?Q(a):v(a))},[])]),[s,t]=(0,d.useState)(!1),[u,w]=(0,d.useState)(!1),[x,y]=(0,d.useState)(!1),z=(0,d.useRef)([]),A=(0,d.useRef)(null),B=(0,d.useMemo)(()=>q.slice().reverse(),[q]),C=async a=>{w(!0);let b=await an(a);if("success"===b.status){let a=b.data.map((a,b)=>(a.order_num!==b+1&&t(!0),{...(0,ae.toExactType)(a),order_num:b+1,in_db:!0,on_fs:!0,modified_db:a.order_num!==b+1,modified_fs:!1}));r(b=>{for(let c of(b.length=0,a))b.push(c)})}w(!1)},D=(a,b)=>{r(c=>{let d=c.findIndex(b=>b.uuid===a.uuid);if(-1!==d){if(b){let a=c.splice(d,1)[0],e=Math.max(0,Math.min(c.length,b-1));c.splice(e,0,a)}else c[d]={...c[d],...a};c.forEach((a,b)=>{a.order_num=b+1,a.modified_db=a.order_num!==b+1})}}),t(!0)},E=a=>{r(b=>{let c=b.findIndex(b=>b.uuid===a);-1!==c&&b.splice(c,1),b.forEach((a,b)=>{a.order_num=b+1,a.modified_db=a.order_num!==b+1})}),t(!0)},F=async()=>{if(o){if(y(!0),o.audioBlob&&"error"===(await at(o.audioBlob,"reading",`${o.uuid}.wav`)).status){X.toast.error("save audio failed"),y(!1);return}if("error"===(await ao({uuid:o.uuid,chapter_uuid:o.chapter_uuid,order_num:o.order_num,original:o.original,recognized:o.recognized,audio_path:`/api/data/reading/${o.uuid}.wav`,created_by:a,created_at:o.created_at||new Date,updated_at:new Date})).status){X.toast.error("save db failed"),y(!1);return}r(a=>{a.push(o)}),p(void 0),X.toast.success("added and saved successfully!"),y(!1)}},G=async()=>{y(!0);try{for(let b of q){if(b.modified_fs&&b.audioBlob){let a=await at(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");r(a=>{let c=a.find(a=>a.uuid===b.uuid);c&&(c.audioBlob=void 0,c.on_fs=!0,c.modified_fs=!1)})}let c=await ao({uuid:b.uuid,chapter_uuid:b.chapter_uuid,order_num:b.order_num,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===c.status)throw Error("save sentence failed");r(a=>{let c=a.find(a=>a.uuid===b.uuid);c&&(c.in_db=!0,c.modified_db=!1)})}t(!1),X.toast.success("All sentences saved successfully!")}catch(a){X.toast.error(a.message||"Failed to save sentences")}y(!1)};return(0,d.useEffect)(()=>{let a=a=>{if(a.ctrlKey&&"a"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}if(a.ctrlKey&&"s"===a.key){a.preventDefault();let b=document.getElementById("button-save-all");b?.click()}};return document.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[k,m]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 my-2",children:[(0,c.jsx)(am,{user_id:a,onSelect:async a=>{h(a)}}),(0,c.jsx)(as,{user_id:a,book_uuid:g,onSelect:async a=>{j(a),p(void 0),await C(a)}})]}),(0,c.jsx)("div",{className:"flex flex-row items-center justify-center gap-4 my-8",children:(0,c.jsx)(R.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!k&&m,onPress:()=>{g&&i?(0,W.toggleRecording)(k,l,z,A,!0,n,a=>{console.log(a)},(a,b)=>{"success"===a.status?p({uuid:(0,ae.getUUID)(),chapter_uuid:i,order_num:q.length+1,original:a.data,recognized:a.data,audioBlob:b,in_db:!0,on_fs:!0,modified_db:!1,modified_fs:!1}):X.toast.error(a.error)}):alert("select book and chapter first")},children:k?"⏹ Stop Recording (Ctrl+A)":m?"Processing":"🎤 Read a Sentence (Ctrl+A)"})}),o&&(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center w-full gap-2",children:[(0,c.jsxs)("div",{className:"flex flex-col w-full p-2 bg-sand-300",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,c.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{new Audio(o.audioBlob?URL.createObjectURL(o.audioBlob):o.audio_path).play()},children:(0,c.jsx)(V.MdPlayCircle,{size:20})})]}),(0,c.jsx)("div",{className:"text-xl",children:$(o.original,o.recognized)}),(0,c.jsx)(T.Textarea,{size:"lg",className:"w-full",label:"original text",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:o.original,onChange:a=>p({...o,original:a.target.value})})]}),(0,c.jsx)(R.Button,{variant:"solid",color:"primary",id:"button-save-all",isDisabled:x,onPress:F,children:"Add & Save (Ctrl+S)"})]}),u&&(0,c.jsx)("div",{className:"flex flex-row w-full items-center justify-center gap-4",children:(0,c.jsx)(S.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"})}),s&&(0,c.jsx)("div",{className:"flex flex-row items-center justify-end my-1",children:(0,c.jsx)(R.Button,{variant:"solid",color:"primary",isDisabled:x,onPress:G,children:"Save"})}),q.length>0&&(0,c.jsx)("div",{className:"flex flex-col w-full gap-2",children:B.map(a=>(0,c.jsx)(ad,{item:a,onUpdate:D,onDelete:E},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map