module.exports=[23614,a=>{"use strict";a.s(["default",()=>D],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(81460),f=a.i(21694),g=a.i(3220),h=a.i(92481),i=a.i(4655),j=a.i(24647),k=a.i(75090),l=a.i(47977),m=a.i(88206),n=a.i(328),o=a.i(84850),p=a.i(20094);function q({rsp:a,onUpdate:e,onDelete:f}){let[g,h]=(0,c.useState)(!1),[i,j]=c.default.useState(!1),[q,r]=(0,c.useState)(a.original),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)([]),v=(0,c.useRef)(null);return(0,b.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(m.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,b.jsx)(n.MdHelpOutline,{size:24})}),s?(0,b.jsx)(k.Input,{size:"lg",className:"w-full",onValueChange:b=>{r(b),e(a.uuid,b,"",null)},value:q}):(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:q}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(m.Tooltip,{content:s?"done":"edit",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>t(!s),children:s?(0,b.jsx)(n.MdDone,{size:30}):(0,b.jsx)(n.MdEdit,{size:30})})}),(0,b.jsx)(m.Tooltip,{content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{},children:(0,b.jsx)(n.MdSave,{size:30})})}),(0,b.jsx)(m.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>f(a.uuid),children:(0,b.jsx)(n.MdDelete,{size:30})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(m.Tooltip,{placement:"right",content:"recognised from audio",children:(0,b.jsx)(n.MdHelpOutline,{size:24})}),(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:a.recognized}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!g&&i,onPress:()=>{(0,o.toggleRecording)(g,h,u,v,!0,j,a=>{console.log(a)},(b,c)=>{"success"===b.status?e(a.uuid,"",b.data,c):p.toast.error(b.error)})},children:g?(0,b.jsx)(n.MdMic,{size:30}):(0,b.jsx)(n.MdMicOff,{size:30})})}),(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,b.jsx)(n.MdPlayCircle,{size:30})})}),(0,b.jsx)(m.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:l.Link,href:a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path,download:"sentence.wav",children:(0,b.jsx)(n.MdDownloadForOffline,{size:30})})})]})]})]})}var r=a.i(68114),s=a.i(72569),t=a.i(95245);function u({email:a}){let{register:d,handleSubmit:e}=(0,t.useForm)(),[f,g]=c.default.useState(!1),h=async b=>{if(g(!0),!a){p.toast.error("not logged in"),g(!1);return}if("success"===(await (0,s.saveBook)({...b,uuid:(0,r.getUUID)(),user_id:a,created_by:a,created_at:new Date,updated_at:new Date})).status)p.toast.success("save book success");else{p.toast.error("save book failed"),g(!1);return}};return(0,b.jsx)("form",{onSubmit:e(h),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(k.Input,{label:"Name",variant:"bordered",size:"sm",...d("name")}),(0,b.jsx)(l.Link,{as:"button",isDisabled:f,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new book"})]})})}var v=a.i(5050),w=(0,v.createServerReference)("40efe0bbdd6749da03257db16a2043ad0944ac94f0",v.callServer,void 0,v.findSourceMapURL,"getBookAll"),x=(0,v.createServerReference)("40b46e2431c804ea1f0cbdf7556bfc070ac6f3819c",v.callServer,void 0,v.findSourceMapURL,"getChapterAll"),y=(0,v.createServerReference)("4095ae58d97a8e95da641576dde7568c7756e32b95",v.callServer,void 0,v.findSourceMapURL,"getSentenceAll"),z=(0,v.createServerReference)("403efa30618d2483acc462423457113d4e58d0e8a6",v.callServer,void 0,v.findSourceMapURL,"saveSentence"),A=(0,v.createServerReference)("40b373149bf211352595fe63214c60b6d3fb08a527",v.callServer,void 0,v.findSourceMapURL,"saveChapter");function B({book_uuid:a,email:d}){let{register:e,handleSubmit:f}=(0,t.useForm)(),[g,h]=c.default.useState(!1),i=async b=>{if(h(!0),!a){p.toast.error("no book selected"),h(!1);return}if(!d){p.toast.error("not logged in"),h(!1);return}if("success"===(await A({...b,uuid:(0,r.getUUID)(),book_uuid:a,order_num:parseInt(`${b.order_num}`,10),created_by:d,created_at:new Date,updated_at:new Date})).status)p.toast.success("save chapter success");else{p.toast.error("save chapter failed"),h(!1);return}};return(0,b.jsx)("form",{onSubmit:f(i),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(k.Input,{label:"Order",variant:"bordered",type:"number",size:"sm",...e("order_num")}),(0,b.jsx)(k.Input,{label:"Name",variant:"bordered",size:"sm",...e("name")}),(0,b.jsx)(l.Link,{as:"button",isDisabled:g,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new chapter"})]})})}var C=(0,v.createServerReference)("70188cd95d0a6c86dec2303e1e6f7b32cc16c174b4",v.callServer,void 0,v.findSourceMapURL,"saveAudio");function D({email:a}){let[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(""),[s,t]=(0,c.useState)([]),[v,A]=(0,c.useState)(""),[D,E]=(0,c.useState)(!1),[F,G]=c.default.useState(!1),[H,I]=(0,c.useState)([]),J=(0,c.useRef)([]),K=(0,c.useRef)(null),L=(a,b,c,d)=>{I(e=>e.map(e=>e.uuid===a?{uuid:e.uuid,chapter_uuid:e.chapter_uuid,order_num:e.order_num,original:b||e.original,recognized:c||e.recognized,audioBlob:d||e.audioBlob,modified_db:!!b,modified_fs:!!d}:e))},M=a=>{I(b=>b.filter(b=>b.uuid!==a))},N=()=>{(0,o.toggleRecording)(D,E,J,K,!0,G,a=>{console.log(a)},(a,b)=>{"success"===a.status?I(c=>[...c,{uuid:(0,r.getUUID)(),chapter_uuid:"",order_num:H.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):p.toast.error(a.error)})};return(0,c.useEffect)(()=>{(async()=>{if(!a)return;let b=await w(a);"success"===b.status&&l(b.data)})();let b=a=>{a.ctrlKey&&"y"===a.key.toLowerCase()&&!(!D&&F)&&(a.preventDefault(),N())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[D,F]),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(i.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;n(b);let c=await x(b);"success"===c.status&&t(c.data)},children:k.map(a=>(0,b.jsx)(j.SelectItem,{children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(f.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(h.PopoverTrigger,{children:(0,b.jsx)(e.Chip,{children:"new"})}),(0,b.jsx)(g.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(u,{email:a})})})]}),(0,b.jsx)(e.Chip,{onClick:async()=>{let b=await w(a);"success"===b.status&&l(b.data)},children:"refresh"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(i.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;A(b);let c=await y(b);"success"===c.status&&I(c.data.map(a=>({...a,modified_db:!1,modified_fs:!1})))},children:s.map(a=>(0,b.jsx)(j.SelectItem,{children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(f.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(h.PopoverTrigger,{children:(0,b.jsx)(e.Chip,{children:"new"})}),(0,b.jsx)(g.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(B,{book_uuid:m,email:a})})})]}),(0,b.jsx)(e.Chip,{onClick:async()=>{let a=await x(m);"success"===a.status&&t(a.data)},children:"refresh"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:N,isDisabled:!D&&F,children:D?"⏹ Stop Recording (Ctrl+Y)":"🎤 Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:()=>{H.forEach(async(b,c)=>b.modified_fs&&b.audioBlob&&"error"===(await C(b.audioBlob,"reading",`${b.uuid}.wav`)).status?void p.toast.error("save audio failed"):b.modified_db&&"error"===(await z({uuid:b.uuid,chapter_uuid:v,order_num:c,original:b.original,recognized:b.recognized,audio_path:`reading/${b.uuid}.wav`,created_by:a,created_at:new Date,updated_at:new Date})).status?void p.toast.error("save sentence failed"):void 0)},children:"save all sentences"})]}),H.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...H].reverse().map(a=>(0,b.jsx)(q,{rsp:a,onUpdate:L,onDelete:M},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map