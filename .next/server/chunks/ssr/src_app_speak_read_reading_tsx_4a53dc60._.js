module.exports=[23614,a=>{"use strict";a.s(["default",()=>C],23614);var b=a.i(87924),c=a.i(72131),d=a.i(32496),e=a.i(21694),f=a.i(3220),g=a.i(92481),h=a.i(4655),i=a.i(24647),j=a.i(75090),k=a.i(47977),l=a.i(88206),m=a.i(328),n=a.i(84850),o=a.i(20094);function p({rsp:a,onUpdate:e,onDelete:f}){let[g,h]=(0,c.useState)(!1),[i,p]=c.default.useState(!1),[q,r]=(0,c.useState)(a.original),[s,t]=(0,c.useState)(!1),u=(0,c.useRef)([]),v=(0,c.useRef)(null);return(0,b.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-sand-300",children:[(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(l.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,b.jsx)(m.MdHelpOutline,{size:24})}),s?(0,b.jsx)(j.Input,{size:"lg",className:"w-full",onValueChange:b=>{r(b),e(a.uuid,b,"",null)},value:q}):(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:q}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(l.Tooltip,{content:s?"done":"edit",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>t(!s),children:s?(0,b.jsx)(m.MdDone,{size:30}):(0,b.jsx)(m.MdEdit,{size:30})})}),(0,b.jsx)(l.Tooltip,{content:"save",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{},children:(0,b.jsx)(m.MdSave,{size:30})})}),(0,b.jsx)(l.Tooltip,{content:"delete",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>f(a.uuid),children:(0,b.jsx)(m.MdDelete,{size:30})})})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,b.jsx)(l.Tooltip,{placement:"right",content:"recognised from audio",children:(0,b.jsx)(m.MdHelpOutline,{size:24})}),(0,b.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:a.recognized}),(0,b.jsxs)("div",{className:"flex flex-row",children:[(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"re-record",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",isDisabled:!g&&i,onPress:()=>{(0,n.toggleRecording)(g,h,u,v,!0,p,a=>{console.log(a)},(b,c)=>{"success"===b.status?e(a.uuid,"",b.data,c):o.toast.error(b.error)})},children:g?(0,b.jsx)(m.MdMic,{size:30}):(0,b.jsx)(m.MdMicOff,{size:30})})}),(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"play audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path).play()},children:(0,b.jsx)(m.MdPlayCircle,{size:30})})}),(0,b.jsx)(l.Tooltip,{placement:"bottom",content:"download audio",children:(0,b.jsx)(d.Button,{isIconOnly:!0,variant:"light",as:k.Link,href:a.audioBlob?URL.createObjectURL(a.audioBlob):a.audio_path,download:"sentence.wav",children:(0,b.jsx)(m.MdDownloadForOffline,{size:30})})})]})]})]})}var q=a.i(68114),r=a.i(51515),s=a.i(95245);function t({email:a}){let{register:d,handleSubmit:e}=(0,s.useForm)(),[f,g]=c.default.useState(!1),h=async b=>{if(g(!0),!a){o.toast.error("not logged in"),g(!1);return}if("success"===(await (0,r.saveBook)({...b,uuid:(0,q.getUUID)(),user_id:a,created_by:a,created_at:new Date,updated_at:new Date})).status)o.toast.success("save book success");else{o.toast.error("save book failed"),g(!1);return}};return(0,b.jsx)("form",{onSubmit:e(h),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(j.Input,{label:"Name",variant:"bordered",size:"sm",...d("name")}),(0,b.jsx)(k.Link,{as:"button",isDisabled:f,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new book"})]})})}var u=a.i(5050),v=(0,u.createServerReference)("4030a1147b6dc928df954c3980ce240c2a325f0c28",u.callServer,void 0,u.findSourceMapURL,"getBookAll"),w=(0,u.createServerReference)("4094dd5fe0fa35752e2b0182ffc88e8d0fce09c827",u.callServer,void 0,u.findSourceMapURL,"getChapterAll"),x=(0,u.createServerReference)("40c127717d250ca78aeb0619f65f27a462bdf6913e",u.callServer,void 0,u.findSourceMapURL,"getSentenceAll"),y=(0,u.createServerReference)("40b6a3ac3b25225bf07e52b80bfbfafcbe895f3c9f",u.callServer,void 0,u.findSourceMapURL,"saveSentence"),z=(0,u.createServerReference)("40a8b62364e48b25fcd184211745126964e6fbbaa3",u.callServer,void 0,u.findSourceMapURL,"saveChapter");function A({book_uuid:a,email:d}){let{register:e,handleSubmit:f}=(0,s.useForm)(),[g,h]=c.default.useState(!1),i=async b=>{if(h(!0),!a){o.toast.error("no book selected"),h(!1);return}if(!d){o.toast.error("not logged in"),h(!1);return}if("success"===(await z({...b,uuid:(0,q.getUUID)(),book_uuid:a,order_num:parseInt(`${b.order_num}`,10),created_by:d,created_at:new Date,updated_at:new Date})).status)o.toast.success("save chapter success");else{o.toast.error("save chapter failed"),h(!1);return}};return(0,b.jsx)("form",{onSubmit:f(i),children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,b.jsx)(j.Input,{label:"Order",variant:"bordered",type:"number",size:"sm",...e("order_num")}),(0,b.jsx)(j.Input,{label:"Name",variant:"bordered",size:"sm",...e("name")}),(0,b.jsx)(k.Link,{as:"button",isDisabled:g,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new chapter"})]})})}var B=(0,u.createServerReference)("70e43199e0b036fae73422acbd05c43f3a5b3be580",u.callServer,void 0,u.findSourceMapURL,"saveAudio");function C({email:a}){let[j,k]=(0,c.useState)([]),[l,m]=(0,c.useState)(""),[r,s]=(0,c.useState)([]),[u,z]=(0,c.useState)(""),[C,D]=(0,c.useState)(!1),[E,F]=c.default.useState(!1),[G,H]=(0,c.useState)([]),I=(0,c.useRef)([]),J=(0,c.useRef)(null),K=(a,b,c,d)=>{H(e=>e.map(e=>e.uuid===a?{uuid:e.uuid,chapter_uuid:e.chapter_uuid,order_num:e.order_num,original:b||e.original,recognized:c||e.recognized,audioBlob:d||e.audioBlob,modified_db:!!b,modified_fs:!!d}:e))},L=a=>{H(b=>b.filter(b=>b.uuid!==a))},M=async()=>{try{await Promise.all(G.map(async(b,c)=>{if(b.modified_fs&&b.audioBlob){let a=await B(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed")}if(b.modified_db){let d=await y({uuid:b.uuid,chapter_uuid:u,order_num:c,original:b.original,recognized:b.recognized,audio_path:`/data/reading/${b.uuid}.wav`,created_by:a,created_at:new Date,updated_at:new Date});if("error"===d.status)throw Error("save sentence failed")}return!0})),o.toast.success("All sentences saved successfully!")}catch(a){o.toast.error(a.message||"Failed to save sentences")}},N=()=>{(0,n.toggleRecording)(C,D,I,J,!0,F,a=>{console.log(a)},(a,b)=>{"success"===a.status?H(c=>[...c,{uuid:(0,q.getUUID)(),chapter_uuid:"",order_num:G.length,original:a.data,recognized:a.data,audioBlob:b,modified_db:!0,modified_fs:!0}]):o.toast.error(a.error)})};return(0,c.useEffect)(()=>{(async()=>{if(!a)return;let b=await v(a);"success"===b.status&&k(b.data)})();let b=a=>{a.ctrlKey&&"y"===a.key.toLowerCase()&&!(!C&&E)&&(a.preventDefault(),N())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[C,E]),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select book",onChange:async a=>{let b=a.target.value;m(b);let c=await w(b);"success"===c.status&&s(c.data)},children:j.map(a=>(0,b.jsx)(i.SelectItem,{children:a.name},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(t,{email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>{let b=await v(a);"success"===b.status&&k(b.data)},children:"refresh"})]})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,b.jsx)(h.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;z(b);let c=await x(b);"success"===c.status&&H(c.data.map(a=>({...a,modified_db:!1,modified_fs:!1})))},children:r.map(a=>(0,b.jsxs)(i.SelectItem,{children:[a.order_num," ",a.name]},a.uuid))}),(0,b.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,b.jsxs)(e.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,b.jsx)(g.PopoverTrigger,{children:(0,b.jsx)(d.Button,{size:"sm",radius:"full",children:"new"})}),(0,b.jsx)(f.PopoverContent,{children:(0,b.jsx)("div",{className:"",children:(0,b.jsx)(A,{book_uuid:l,email:a})})})]}),(0,b.jsx)(d.Button,{size:"sm",radius:"full",onPress:async()=>{let a=await w(l);"success"===a.status&&s(a.data)},children:"refresh"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:N,isDisabled:!C&&E,children:C?"⏹ Stop Recording (Ctrl+Y)":"🎤 Speak a Sentence (Ctrl+Y)"}),(0,b.jsx)(d.Button,{variant:"solid",color:"primary",onPress:M,children:"save all sentences"})]}),G.length>0&&(0,b.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...G].reverse().map(a=>(0,b.jsx)(p,{rsp:a,onUpdate:K,onDelete:L},a.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map