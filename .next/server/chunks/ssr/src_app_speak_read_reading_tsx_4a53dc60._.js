module.exports=[23614,a=>{"use strict";a.s(["default",()=>at],23614);var b,c=a.i(87924),d=a.i(72131),e=Symbol.for("immer-nothing"),f=Symbol.for("immer-draftable"),g=Symbol.for("immer-state");function h(a){throw Error(`[Immer] minified error nr: ${a}. Full error at: https://bit.ly/3cXEKWf`)}var i=Object.getPrototypeOf;function j(a){return!!a&&!!a[g]}function k(a){return!!a&&(m(a)||Array.isArray(a)||!!a[f]||!!a.constructor?.[f]||r(a)||s(a))}var l=Object.prototype.constructor.toString();function m(a){if(!a||"object"!=typeof a)return!1;let b=i(a);if(null===b)return!0;let c=Object.hasOwnProperty.call(b,"constructor")&&b.constructor;return c===Object||"function"==typeof c&&Function.toString.call(c)===l}function n(a,b){0===o(a)?Reflect.ownKeys(a).forEach(c=>{b(c,a[c],a)}):a.forEach((c,d)=>b(d,c,a))}function o(a){let b=a[g];return b?b.type_:Array.isArray(a)?1:r(a)?2:3*!!s(a)}function p(a,b){return 2===o(a)?a.has(b):Object.prototype.hasOwnProperty.call(a,b)}function q(a,b,c){let d=o(a);2===d?a.set(b,c):3===d?a.add(c):a[b]=c}function r(a){return a instanceof Map}function s(a){return a instanceof Set}function t(a){return a.copy_||a.base_}function u(a,b){if(r(a))return new Map(a);if(s(a))return new Set(a);if(Array.isArray(a))return Array.prototype.slice.call(a);let c=m(a);if(!0!==b&&("class_only"!==b||c)){let b=i(a);return null!==b&&c?{...a}:Object.assign(Object.create(b),a)}{let b=Object.getOwnPropertyDescriptors(a);delete b[g];let c=Reflect.ownKeys(b);for(let d=0;d<c.length;d++){let e=c[d],f=b[e];!1===f.writable&&(f.writable=!0,f.configurable=!0),(f.get||f.set)&&(b[e]={configurable:!0,writable:!0,enumerable:f.enumerable,value:a[e]})}return Object.create(i(a),b)}}function v(a,b=!1){return x(a)||j(a)||!k(a)||(o(a)>1&&Object.defineProperties(a,{set:{value:w},add:{value:w},clear:{value:w},delete:{value:w}}),Object.freeze(a),b&&Object.values(a).forEach(a=>v(a,!0))),a}function w(){h(2)}function x(a){return Object.isFrozen(a)}var y={};function z(a){let b=y[a];return b||h(0,a),b}function A(a,b){b&&(z("Patches"),a.patches_=[],a.inversePatches_=[],a.patchListener_=b)}function B(a){C(a),a.drafts_.forEach(E),a.drafts_=null}function C(a){a===b&&(b=a.parent_)}function D(a){return b={drafts_:[],parent_:b,immer_:a,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function E(a){let b=a[g];0===b.type_||1===b.type_?b.revoke_():b.revoked_=!0}function F(a,b){b.unfinalizedDrafts_=b.drafts_.length;let c=b.drafts_[0];return void 0!==a&&a!==c?(c[g].modified_&&(B(b),h(4)),k(a)&&(a=G(b,a),b.parent_||I(b,a)),b.patches_&&z("Patches").generateReplacementPatches_(c[g].base_,a,b.patches_,b.inversePatches_)):a=G(b,c,[]),B(b),b.patches_&&b.patchListener_(b.patches_,b.inversePatches_),a!==e?a:void 0}function G(a,b,c){if(x(b))return b;let d=b[g];if(!d)return n(b,(e,f)=>H(a,d,b,e,f,c)),b;if(d.scope_!==a)return b;if(!d.modified_)return I(a,d.base_,!0),d.base_;if(!d.finalized_){d.finalized_=!0,d.scope_.unfinalizedDrafts_--;let b=d.copy_,e=b,f=!1;3===d.type_&&(e=new Set(b),b.clear(),f=!0),n(e,(e,g)=>H(a,d,b,e,g,c,f)),I(a,b,!1),c&&a.patches_&&z("Patches").generatePatches_(d,c,a.patches_,a.inversePatches_)}return d.copy_}function H(a,b,c,d,e,f,g){if(j(e)){let g=G(a,e,f&&b&&3!==b.type_&&!p(b.assigned_,d)?f.concat(d):void 0);if(q(c,d,g),!j(g))return;a.canAutoFreeze_=!1}else g&&c.add(e);if(k(e)&&!x(e)){if(!a.immer_.autoFreeze_&&a.unfinalizedDrafts_<1)return;G(a,e),(!b||!b.scope_.parent_)&&"symbol"!=typeof d&&(r(c)?c.has(d):Object.prototype.propertyIsEnumerable.call(c,d))&&I(a,e)}}function I(a,b,c=!1){!a.parent_&&a.immer_.autoFreeze_&&a.canAutoFreeze_&&v(b,c)}var J={get(a,b){if(b===g)return a;let c=t(a);if(!p(c,b)){var d=a,e=c,f=b;let g=M(e,f);return g?"value"in g?g.value:g.get?.call(d.draft_):void 0}let h=c[b];return a.finalized_||!k(h)?h:h===L(a.base_,b)?(O(a),a.copy_[b]=P(h,a)):h},has:(a,b)=>b in t(a),ownKeys:a=>Reflect.ownKeys(t(a)),set(a,b,c){let d=M(t(a),b);if(d?.set)return d.set.call(a.draft_,c),!0;if(!a.modified_){let d=L(t(a),b),e=d?.[g];if(e&&e.base_===c)return a.copy_[b]=c,a.assigned_[b]=!1,!0;if((c===d?0!==c||1/c==1/d:c!=c&&d!=d)&&(void 0!==c||p(a.base_,b)))return!0;O(a),N(a)}return!!(a.copy_[b]===c&&(void 0!==c||b in a.copy_)||Number.isNaN(c)&&Number.isNaN(a.copy_[b]))||(a.copy_[b]=c,a.assigned_[b]=!0,!0)},deleteProperty:(a,b)=>(void 0!==L(a.base_,b)||b in a.base_?(a.assigned_[b]=!1,O(a),N(a)):delete a.assigned_[b],a.copy_&&delete a.copy_[b],!0),getOwnPropertyDescriptor(a,b){let c=t(a),d=Reflect.getOwnPropertyDescriptor(c,b);return d?{writable:!0,configurable:1!==a.type_||"length"!==b,enumerable:d.enumerable,value:c[b]}:d},defineProperty(){h(11)},getPrototypeOf:a=>i(a.base_),setPrototypeOf(){h(12)}},K={};function L(a,b){let c=a[g];return(c?t(c):a)[b]}function M(a,b){if(!(b in a))return;let c=i(a);for(;c;){let a=Object.getOwnPropertyDescriptor(c,b);if(a)return a;c=i(c)}}function N(a){!a.modified_&&(a.modified_=!0,a.parent_&&N(a.parent_))}function O(a){a.copy_||(a.copy_=u(a.base_,a.scope_.immer_.useStrictShallowCopy_))}function P(a,c){let d=r(a)?z("MapSet").proxyMap_(a,c):s(a)?z("MapSet").proxySet_(a,c):function(a,c){let d=Array.isArray(a),e={type_:+!!d,scope_:c?c.scope_:b,modified_:!1,finalized_:!1,assigned_:{},parent_:c,base_:a,draft_:null,copy_:null,revoke_:null,isManual_:!1},f=e,g=J;d&&(f=[e],g=K);let{revoke:h,proxy:i}=Proxy.revocable(f,g);return e.draft_=i,e.revoke_=h,i}(a,c);return(c?c.scope_:b).drafts_.push(d),d}n(J,(a,b)=>{K[a]=function(){return arguments[0]=arguments[0][0],b.apply(this,arguments)}}),K.deleteProperty=function(a,b){return K.set.call(this,a,b,void 0)},K.set=function(a,b,c){return J.set.call(this,a[0],b,c,a[0])};var Q=new class{constructor(a){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(a,b,c)=>{let d;if("function"==typeof a&&"function"!=typeof b){let c=b;b=a;let d=this;return function(a=c,...e){return d.produce(a,a=>b.call(this,a,...e))}}if("function"!=typeof b&&h(6),void 0!==c&&"function"!=typeof c&&h(7),k(a)){let e=D(this),f=P(a,void 0),g=!0;try{d=b(f),g=!1}finally{g?B(e):C(e)}return A(e,c),F(d,e)}if(a&&"object"==typeof a)h(1,a);else{if(void 0===(d=b(a))&&(d=a),d===e&&(d=void 0),this.autoFreeze_&&v(d,!0),c){let b=[],e=[];z("Patches").generateReplacementPatches_(a,d,b,e),c(b,e)}return d}},this.produceWithPatches=(a,b)=>{let c,d;return"function"==typeof a?(b,...c)=>this.produceWithPatches(b,b=>a(b,...c)):[this.produce(a,b,(a,b)=>{c=a,d=b}),c,d]},"boolean"==typeof a?.autoFreeze&&this.setAutoFreeze(a.autoFreeze),"boolean"==typeof a?.useStrictShallowCopy&&this.setUseStrictShallowCopy(a.useStrictShallowCopy)}createDraft(a){var b;k(a)||h(8),j(a)&&(j(b=a)||h(10,b),a=function a(b){let c;if(!k(b)||x(b))return b;let d=b[g];if(d){if(!d.modified_)return d.base_;d.finalized_=!0,c=u(b,d.scope_.immer_.useStrictShallowCopy_)}else c=u(b,!0);return n(c,(b,d)=>{q(c,b,a(d))}),d&&(d.finalized_=!1),c}(b));let c=D(this),d=P(a,void 0);return d[g].isManual_=!0,C(c),d}finishDraft(a,b){let c=a&&a[g];c&&c.isManual_||h(9);let{scope_:d}=c;return A(d,b),F(void 0,d)}setAutoFreeze(a){this.autoFreeze_=a}setUseStrictShallowCopy(a){this.useStrictShallowCopy_=a}applyPatches(a,b){let c;for(c=b.length-1;c>=0;c--){let d=b[c];if(0===d.path.length&&"replace"===d.op){a=d.value;break}}c>-1&&(b=b.slice(c+1));let d=z("Patches").applyPatches_;return j(a)?d(a,b):this.produce(a,a=>d(a,b))}}().produce,R=a.i(32496),S=a.i(72571),T=a.i(84476),U=a.i(88206),V=a.i(328),W=a.i(84850),X=a.i(20094);function Y(a){return(a=a.replace(/\s+/g," ").trim())?a.split(/(\s+|[.,!?;:\-—()"'“”„«»…])/).filter(a=>null!=a&&""!==a).filter(a=>a.trim().length>0||" "===a):[]}function Z(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var $=a.i(5050),_=(0,$.createServerReference)("6067052aa1a4bd4c07344963f430bfe09d2e498fde",$.callServer,void 0,$.findSourceMapURL,"removeAudio"),aa=(0,$.createServerReference)("7029fd9ab20a7239a86e79563f7aa18e300b7b1eeb",$.callServer,void 0,$.findSourceMapURL,"saveAudio"),ab=(0,$.createServerReference)("4071e8058594d5e5a960a92189bc224fdec09639cb",$.callServer,void 0,$.findSourceMapURL,"removeSentence"),ac=(0,$.createServerReference)("401a148c5eae2320928892b64bad7c9cd6a1ade77d",$.callServer,void 0,$.findSourceMapURL,"saveSentence"),ad=(0,$.createServerReference)("607ff098be52c4cb5d8b934183f876fa6e7d4ede19",$.callServer,void 0,$.findSourceMapURL,"callTTS");function ae({user_id:a,item:b,onUpdate:e,onDelete:f}){let[g,h]=(0,d.useState)(!1),[i,j]=(0,d.useState)(!1),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(!1),o=(0,d.useRef)([]),p=(0,d.useRef)(null),q=async()=>{b.modified_fs&&b.audioBlob&&("success"===(await aa(b.audioBlob,"reading",`${b.uuid}.wav`)).status?(X.toast.success("save audio success"),e({...b,on_fs:!0,modified_fs:!1})):X.toast.error("save audio failed")),b.modified_db&&("success"===(await ac({uuid:b.uuid,chapter_uuid:b.chapter_uuid,order_num:b.order_num,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date})).status?(X.toast.success("save sentence success"),e({...b,in_db:!0,modified_db:!1})):X.toast.error("save sentence failed"))},r=async()=>{if(b.on_fs){if("success"!==(await _("reading",`${b.uuid}.wav`)).status)return void X.toast.error("delete audio failed");X.toast.success("delete audio success")}if(b.in_db){if("success"!==(await ab(b.uuid)).status)return void X.toast.error("delete sentence failed");X.toast.success("delete sentence success")}f(b.uuid)};return(0,c.jsxs)("div",{className:"flex flex-row items-start justify-start w-full bg-sand-300",children:[b.modified_db||b.modified_fs?(0,c.jsx)(U.Tooltip,{placement:"bottom",content:"unsaved",children:(0,c.jsx)("div",{className:"text-red-500",children:"●"})}):(0,c.jsx)("div",{className:"text-transparent",children:"●"}),(0,c.jsxs)("div",{className:"flex flex-col w-full p-2",children:[(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,c.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"re-record",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:!g&&i,onPress:()=>{(0,W.toggleRecording)(g,h,o,p,!0,j,a=>{console.log(a)},(a,c)=>{"success"===a.status?e({...b,recognized:a.data,audioBlob:c,modified_db:!0,modified_fs:!0}):X.toast.error(a.error)})},children:g?(0,c.jsx)(V.MdMic,{size:20}):(0,c.jsx)(V.MdMicOff,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"play audio",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{new Audio(b.audioBlob?URL.createObjectURL(b.audioBlob):b.audio_path).play()},children:(0,c.jsx)(V.MdPlayCircle,{size:20})})})]}),(0,c.jsx)("div",{className:"text-xl",children:((a,b)=>{let d=Y(a),e=Y(b),{matchesB:f}=function(a,b){let c=a.length,d=b.length,e=Array.from({length:c+1},()=>Array(d+1).fill(0));for(let f=c-1;f>=0;f--)for(let c=d-1;c>=0;c--)a[f]===b[c]?e[f][c]=1+e[f+1][c+1]:e[f][c]=Math.max(e[f+1][c],e[f][c+1]);let f=0,g=0,h=[];for(;f<c&&g<d;)a[f]===b[g]?(h.push(g),f++,g++):e[f+1][g]>=e[f][g+1]?f++:g++;return{matchesB:h}}(d,e),g=new Set(f);return e.map((a,b)=>g.has(b)?(0,c.jsx)("span",{children:Z(a)},b):(0,c.jsx)("span",{style:{background:"#ffeb3b"},children:Z(a)},b))})(b.original,b.recognized)})]}),(0,c.jsxs)("div",{className:"flex flex-col",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-4",children:[(0,c.jsx)("div",{className:"text-md text-gray-400",children:"original text:"}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"edit original",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>l(!k),children:k?(0,c.jsx)(V.MdEditOff,{size:20}):(0,c.jsx)(V.MdEdit,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"top",content:"play audio",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:m,onPress:async()=>{let a=`/api/data/tts/${b.uuid}.wav`;if(!await fetch(a,{method:"HEAD"}).then(a=>a.ok).catch(()=>!1)){n(!0);let a=await ad(b.uuid,b.original);if(n(!1),"error"===a.status)return void console.error(a.error)}new Audio(a).play().catch(a=>console.error("error: ",a))},children:(0,c.jsx)(V.MdPlayCircle,{size:20})})})]}),k?(0,c.jsx)(T.Textarea,{size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:b.original,onChange:a=>{e({...b,original:a.target.value,modified_db:!0})}}):(0,c.jsx)("div",{className:"text-xl",children:b.original})]})]}),(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center w-fit gap-1 py-2",children:[(0,c.jsx)(U.Tooltip,{placement:"left",content:"save",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>e(b,b.order_num+1),children:(0,c.jsx)(V.MdArrowUpward,{size:20})})}),(0,c.jsx)("div",{children:b.order_num}),(0,c.jsx)(U.Tooltip,{placement:"left",content:"save",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>e(b,b.order_num-1),children:(0,c.jsx)(V.MdArrowDownward,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"left",content:"save",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:q,children:(0,c.jsx)(V.MdOutlineSave,{size:20})})}),(0,c.jsx)(U.Tooltip,{placement:"left",content:"delete",children:(0,c.jsx)(R.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:r,children:(0,c.jsx)(V.MdDelete,{size:20})})})]})]})}var af=a.i(68114),ag=(0,$.createServerReference)("40df2f6cd288eb6e2b70c661652fed2ffe55de3da9",$.callServer,void 0,$.findSourceMapURL,"getBookAll"),ah=a.i(65791),ai=a.i(92465),aj=a.i(27493),ak=a.i(75090),al=a.i(4655),am=a.i(24647);function an({user_id:a,onSelect:b}){let[e,f]=(0,d.useState)([]),[g,h]=(0,d.useState)(""),[i,j]=(0,d.useState)(!1),[k,l]=(0,d.useState)(!1),[m,n]=(0,d.useState)(!1),o=async()=>{n(!0);let b=await ag(a);"success"===b.status&&f(b.data),n(!1)},p=async()=>{if(!a)return void X.toast.error("not logged in");l(!0),"success"===(await (0,ai.saveBook)({uuid:(0,af.getUUID)(),user_id:a,name:g,created_by:a,created_at:new Date,updated_at:new Date})).status?(X.toast.success("save book success"),h("")):X.toast.error("save book failed"),l(!1)},q=async a=>{l(!0),"success"===(await (0,ah.removeBook)(a)).status?X.toast.success("delete book success"):X.toast.error("delete book failed"),l(!1)};return(0,d.useEffect)(()=>{o()},[a]),(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsx)(al.Select,{label:"Select book",onChange:async a=>{let c=a.target.value;await b(c)},endContent:m&&(0,c.jsx)(aj.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:e.map(a=>(0,c.jsx)(am.SelectItem,{textValue:a.name,children:a.name},a.uuid))}),(0,c.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>j(!i),children:i?"finish":"edit"}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:o,children:"refresh"})]}),i&&(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,c.jsx)(ak.Input,{label:"Name of Book",size:"sm",onChange:a=>h(a.target.value)}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",isDisabled:k,onPress:p,children:"add"})]}),e.map(a=>(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[a.name,(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>q(a.uuid),children:"delete"})]},a.uuid))]})]})}var ao=(0,$.createServerReference)("40c01fdc89ae4608299ddfd0cf559bffc781fbf792",$.callServer,void 0,$.findSourceMapURL,"getSentenceAll"),ap=(0,$.createServerReference)("406ba91567044264a46e98256278b33d78d96b73c3",$.callServer,void 0,$.findSourceMapURL,"getChapterAll"),aq=(0,$.createServerReference)("401f4e21d4a7d808c7b16151a4bf23f55f3124afc0",$.callServer,void 0,$.findSourceMapURL,"removeChapter"),ar=(0,$.createServerReference)("40b141f28a297fa719c5c9d342d7c1c168069c3e42",$.callServer,void 0,$.findSourceMapURL,"saveChapter");function as({user_id:a,book_uuid:b,onSelect:e}){let[f,g]=(0,d.useState)([]),[h,i]=(0,d.useState)(""),[j,k]=(0,d.useState)(""),[l,m]=(0,d.useState)(!1),[n,o]=(0,d.useState)(!1),[p,q]=(0,d.useState)(!1),r=async()=>{q(!0);let a=await ap(b);"success"===a.status&&g(a.data),q(!1)},s=async()=>a?b?void(o(!0),"success"===(await ar({uuid:(0,af.getUUID)(),book_uuid:b,order_num:parseInt(h,10),name:j,created_by:a,created_at:new Date,updated_at:new Date})).status?(X.toast.success("save chapter success"),k("")):X.toast.error("save chapter failed"),o(!1)):void X.toast.error("no book selected"):void X.toast.error("not logged in"),t=async a=>{o(!0),"success"===(await aq(a)).status?X.toast.success("delete chapter success"):X.toast.error("delete chapter failed"),o(!1)};return(0,d.useEffect)(()=>{r()},[b]),(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsx)(al.Select,{label:"Select chapter",onChange:async a=>{let b=a.target.value;await e(b)},endContent:p&&(0,c.jsx)(aj.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:f.map(a=>(0,c.jsxs)(am.SelectItem,{textValue:`${a.order_num}, ${a.name}`,children:[a.order_num,", ",a.name]},a.uuid))}),(0,c.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>m(!l),children:l?"finish":"edit"}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:r,children:"refresh"})]}),l&&(0,c.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,c.jsx)(ak.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:a=>i(a.target.value)}),(0,c.jsx)(ak.Input,{label:"Name of Book",size:"sm",onChange:a=>k(a.target.value)}),(0,c.jsx)(R.Button,{size:"sm",radius:"full",isDisabled:n,onPress:s,children:"add"})]}),f.map(a=>(0,c.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[a.order_num," - ",a.name,(0,c.jsx)(R.Button,{size:"sm",radius:"full",onPress:()=>t(a.uuid),children:"delete"})]},a.uuid))]})]})}function at({email:a}){var b,e,f;let[g,h]=(0,d.useState)(""),[i,j]=(0,d.useState)(""),[k,l]=(0,d.useState)(!1),[m,n]=d.default.useState(!1),[o,p]=(b=[],f=(e=(0,d.useState)(function(){return v("function"==typeof b?b():b,!0)}))[1],[e[0],(0,d.useCallback)(function(a){f("function"==typeof a?Q(a):v(a))},[])]),[q,r]=d.default.useState(!1),[s,t]=d.default.useState(!1),u=(0,d.useRef)([]),w=(0,d.useRef)(null),x=(0,d.useMemo)(()=>o.slice().reverse(),[o]),y=async a=>{r(!0);let b=await ao(a);if("success"===b.status){let a=b.data.map((a,b)=>({...(0,af.toExactType)(a),order_num:b+1,in_db:!0,on_fs:!0,modified_db:a.order_num!==b+1,modified_fs:!1}));p(b=>{for(let c of(b.length=0,a))b.push(c)})}r(!1)},z=(a,b)=>{p(c=>{let d=c.findIndex(b=>b.uuid===a.uuid);if(-1!==d){if(b){let a=c.splice(d,1)[0],e=Math.max(0,Math.min(c.length,b-1));c.splice(e,0,a)}else c[d]={...c[d],...a};c.forEach((a,b)=>{a.order_num=b+1,a.modified_db=a.order_num!==b+1})}})},A=a=>{p(b=>{let c=b.findIndex(b=>b.uuid===a);-1!==c&&b.splice(c,1),b.forEach((a,b)=>{a.order_num=b+1,a.modified_db=a.order_num!==b+1})})},B=async()=>{t(!0);try{for(let b of o){if(b.modified_fs&&b.audioBlob){let a=await aa(b.audioBlob,"reading",`${b.uuid}.wav`);if("error"===a.status)throw Error("save audio failed");p(a=>{let c=a.find(a=>a.uuid===b.uuid);c&&(c.audioBlob=void 0,c.on_fs=!0,c.modified_fs=!1)})}let c=await ac({uuid:b.uuid,chapter_uuid:b.chapter_uuid,order_num:b.order_num,original:b.original,recognized:b.recognized,audio_path:`/api/data/reading/${b.uuid}.wav`,created_by:a,created_at:b.created_at||new Date,updated_at:new Date});if("error"===c.status)throw Error("save sentence failed");p(a=>{let c=a.find(a=>a.uuid===b.uuid);c&&(c.in_db=!0,c.modified_db=!1)})}X.toast.success("All sentences saved successfully!")}catch(a){X.toast.error(a.message||"Failed to save sentences")}t(!1)};return(0,d.useEffect)(()=>{let a=a=>{if(a.ctrlKey&&"a"===a.key){a.preventDefault();let b=document.getElementById("button-toggel-recording");b?.click()}if(a.ctrlKey&&"s"===a.key){a.preventDefault();let b=document.getElementById("button-save-all");b?.click()}};return document.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[k,m]),(0,c.jsxs)("div",{children:[(0,c.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 my-2",children:[(0,c.jsx)(an,{user_id:a,onSelect:async a=>{h(a)}}),(0,c.jsx)(as,{user_id:a,book_uuid:g,onSelect:async a=>{j(a),await y(a)}})]}),(0,c.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,c.jsx)(R.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!k&&m,onPress:()=>{g&&i?(0,W.toggleRecording)(k,l,u,w,!0,n,a=>{console.log(a)},(a,b)=>{"success"===a.status?p(c=>{c.push({uuid:(0,af.getUUID)(),chapter_uuid:i,order_num:c.length+1,original:a.data,recognized:a.data,audioBlob:b,in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0})}):X.toast.error(a.error)}):alert("select book and chapter first")},children:k?"⏹ Stop Recording (Ctrl+A)":m?"Processing":"🎤 Read a Sentence (Ctrl+A)"}),(0,c.jsx)(R.Button,{variant:"solid",color:"primary",id:"button-save-all",isDisabled:s,onPress:B,children:"Save (Ctrl+S)"})]}),q&&(0,c.jsx)(S.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),o.length>0&&(0,c.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:x.map(b=>(0,c.jsx)(ae,{user_id:a,item:b,onUpdate:z,onDelete:A},b.uuid))})]})}}];

//# sourceMappingURL=src_app_speak_read_reading_tsx_4a53dc60._.js.map