(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e.s(["_",()=>t])},24597,e=>{"use strict";e.s(["Link",()=>b],24597);var t=e.i(84898),a=e.i(79754),s=(0,t.tv)({base:["relative inline-flex items-center outline-solid outline-transparent tap-highlight-transparent",...a.dataFocusVisibleClasses],variants:{size:{sm:"text-small",md:"text-medium",lg:"text-large"},color:{foreground:"text-foreground",primary:"text-primary",secondary:"text-secondary",success:"text-success",warning:"text-warning",danger:"text-danger"},underline:{none:"no-underline",hover:"hover:underline",always:"underline",active:"active:underline",focus:"focus:underline"},isBlock:{true:["px-2","py-1","hover:after:opacity-100","after:content-['']","after:inset-0","after:opacity-0","after:w-full","after:h-full","after:rounded-xl","after:transition-background","after:absolute"],false:"hover:opacity-hover active:opacity-disabled transition-opacity"},isDisabled:{true:"opacity-disabled cursor-default pointer-events-none"},disableAnimation:{true:"after:transition-none transition-none"}},compoundVariants:[{isBlock:!0,color:"foreground",class:"hover:after:bg-foreground/10"},{isBlock:!0,color:"primary",class:"hover:after:bg-primary/20"},{isBlock:!0,color:"secondary",class:"hover:after:bg-secondary/20"},{isBlock:!0,color:"success",class:"hover:after:bg-success/20"},{isBlock:!0,color:"warning",class:"hover:after:bg-warning/20"},{isBlock:!0,color:"danger",class:"hover:after:bg-danger/20"},{underline:["hover","always","active","focus"],class:"underline-offset-4"}],defaultVariants:{color:"primary",size:"md",isBlock:!1,underline:"none",isDisabled:!1}}),r=e.i(69080),i=e.i(50179),n=e.i(11458),l=e.i(49962),o=e.i(43027),c=e.i(73830),d=e.i(95494),u=e.i(20253),f=e.i(29427),m=e.i(75540),x=e.i(71645),v=e.i(43476),p=e=>(0,v.jsxs)("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",shapeRendering:"geometricPrecision",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",viewBox:"0 0 24 24",width:"1em",...e,children:[(0,v.jsx)("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),(0,v.jsx)("path",{d:"M15 3h6v6"}),(0,v.jsx)("path",{d:"M10 14L21 3"})]}),h=(0,c.forwardRef)((e,t)=>{let{Component:a,children:h,showAnchorIcon:b,anchorIcon:g=(0,v.jsx)(p,{className:"flex mx-1 text-current self-center"}),getLinkProps:j}=function(e){var t,a,v,p;let h=(0,d.useProviderContext)(),[b,g]=(0,c.mapPropsVariants)(e,s.variantKeys),{ref:j,as:w,children:y,anchorIcon:S,isExternal:k=!1,showAnchorIcon:_=!1,autoFocus:B=!1,className:P,onPress:R,onPressStart:N,onPressEnd:z,onClick:D,...L}=b,M=(0,u.useDOMRef)(j),I=null!=(a=null!=(t=null==e?void 0:e.disableAnimation)?t:null==h?void 0:h.disableAnimation)&&a,{linkProps:U}=function(e,t){let{elementType:a="a",onPress:s,onPressStart:c,onPressEnd:d,onClick:u,isDisabled:f,...m}=e,x={};"a"!==a&&(x={role:"link",tabIndex:f?void 0:0});let{focusableProps:v}=(0,l.useFocusable)(e,t),{pressProps:p,isPressed:h}=(0,o.usePress)({onClick:u,onPress:s,onPressStart:c,onPressEnd:d,isDisabled:f,ref:t}),b=(0,r.filterDOMProps)(m,{labelable:!0,isLink:"a"===a}),g=(0,i.mergeProps)(v,p),j=(0,n.useRouter)(),w=(0,n.useLinkProps)(e);return{isPressed:h,linkProps:(0,i.mergeProps)(b,w,{...g,...x,"aria-disabled":f||void 0,"aria-current":e["aria-current"],onClick:t=>{var a;null==(a=p.onClick)||a.call(p,t),(0,n.handleLinkClick)(t,j,e.href,e.routerOptions)}})}}({...L,onPress:R,onPressStart:N,onPressEnd:z,onClick:D,isDisabled:e.isDisabled,elementType:"".concat(w)},M),{isFocused:C,isFocusVisible:O,focusProps:T}=(0,f.useFocusRing)({autoFocus:B});k&&(L.rel=null!=(v=L.rel)?v:"noopener noreferrer",L.target=null!=(p=L.target)?p:"_blank");let A=(0,x.useMemo)(()=>s({...g,disableAnimation:I,className:P}),[(0,m.objectToDeps)(g),I,P]);return{Component:w||"a",children:y,anchorIcon:S,showAnchorIcon:_,getLinkProps:(0,x.useCallback)(()=>({ref:M,className:A,"data-focus":(0,m.dataAttr)(C),"data-disabled":(0,m.dataAttr)(e.isDisabled),"data-focus-visible":(0,m.dataAttr)(O),...(0,m.mergeProps)(T,U,L)}),[A,C,O,T,U,L])}}({ref:t,...e});return(0,v.jsx)(a,{...j(),children:(0,v.jsxs)(v.Fragment,{children:[h,b&&g]})})});h.displayName="HeroUI.Link";var b=h},7548,e=>{"use strict";e.s(["saveBook",()=>a]);var t=e.i(95187),a=(0,t.createServerReference)("40f8c9ae39c5427ed7bc3b2685c7421c1977f4a0f9",t.callServer,void 0,t.findSourceMapURL,"saveBook")},22980,e=>{"use strict";e.s(["default",()=>N],22980);var t=e.i(43476),a=e.i(71645),s=e.i(35889),r=e.i(42976),i=e.i(35577),n=e.i(46399),l=e.i(56124),o=e.i(76220),c=e.i(212),d=e.i(24597),u=e.i(64925),f=e.i(73665),m=e.i(71508),x=e.i(70319);function v(e){let{rsp:r,onUpdate:i,onDelete:n}=e,[l,o]=(0,a.useState)(!1),[v,p]=a.default.useState(!1),[h,b]=(0,a.useState)(r.original),[g,j]=(0,a.useState)(!1),w=(0,a.useRef)([]),y=(0,a.useRef)(null);return(0,t.jsxs)("div",{className:"flex flex-col gap-2 p-2 bg-sand-300",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,t.jsx)(u.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,t.jsx)(f.MdHelpOutline,{size:24})}),g?(0,t.jsx)(c.Input,{size:"lg",className:"w-full",onValueChange:e=>{b(e),i(r.uuid,e,"",null)},value:h}):(0,t.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:h}),(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)(u.Tooltip,{content:g?"done":"edit",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",onPress:()=>j(!g),children:g?(0,t.jsx)(f.MdDone,{size:30}):(0,t.jsx)(f.MdEdit,{size:30})})}),(0,t.jsx)(u.Tooltip,{content:"save",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",onPress:()=>{},children:(0,t.jsx)(f.MdSave,{size:30})})}),(0,t.jsx)(u.Tooltip,{content:"delete",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",onPress:()=>n(r.uuid),children:(0,t.jsx)(f.MdDelete,{size:30})})})]})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,t.jsx)(u.Tooltip,{placement:"right",content:"recognised from audio",children:(0,t.jsx)(f.MdHelpOutline,{size:24})}),(0,t.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:r.recognized}),(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)(u.Tooltip,{placement:"bottom",content:"re-record",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",isDisabled:!l&&v,onPress:()=>{(0,m.toggleRecording)(l,o,w,y,!0,p,e=>{console.log(e)},(e,t)=>{"success"===e.status?i(r.uuid,"",e.data,t):x.toast.error(e.error)})},children:l?(0,t.jsx)(f.MdMic,{size:30}):(0,t.jsx)(f.MdMicOff,{size:30})})}),(0,t.jsx)(u.Tooltip,{placement:"bottom",content:"play audio",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(r.audioBlob?URL.createObjectURL(r.audioBlob):r.audio_path).play()},children:(0,t.jsx)(f.MdPlayCircle,{size:30})})}),(0,t.jsx)(u.Tooltip,{placement:"bottom",content:"download audio",children:(0,t.jsx)(s.Button,{isIconOnly:!0,variant:"light",as:d.Link,href:r.audioBlob?URL.createObjectURL(r.audioBlob):r.audio_path,download:"reading_".concat(r.uuid,".wav"),children:(0,t.jsx)(f.MdDownloadForOffline,{size:30})})})]})]})]})}var p=e.i(75157),h=e.i(7548),b=e.i(53145);function g(e){let{email:s}=e,{register:r,handleSubmit:i}=(0,b.useForm)(),[n,l]=a.default.useState(!1),o=async e=>{if(l(!0),!s){x.toast.error("not logged in"),l(!1);return}if("success"===(await (0,h.saveBook)({...e,uuid:(0,p.getUUID)(),user_id:s,created_by:s,created_at:new Date,updated_at:new Date})).status)x.toast.success("save book success");else{x.toast.error("save book failed"),l(!1);return}};return(0,t.jsx)("form",{onSubmit:i(o),children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)(c.Input,{label:"Name",variant:"bordered",size:"sm",...r("name")}),(0,t.jsx)(d.Link,{as:"button",isDisabled:n,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new book"})]})})}var j=e.i(95187),w=(0,j.createServerReference)("40f77ed0bcacb88d93f0541d7efd97d64c14b158f9",j.callServer,void 0,j.findSourceMapURL,"getBookAll"),y=(0,j.createServerReference)("40803f42fe929e04791e8208d22867677e8bcb0df8",j.callServer,void 0,j.findSourceMapURL,"getChapterAll"),S=(0,j.createServerReference)("4001be4f715f886056ac05352ddd1559fec5f58a49",j.callServer,void 0,j.findSourceMapURL,"getSentenceAll"),k=(0,j.createServerReference)("400f7d6c12a51b8db62c6ab9131b9c49b49dea750e",j.callServer,void 0,j.findSourceMapURL,"saveSentence"),_=(0,j.createServerReference)("40123e8d0bb6dc088972f157813c6201ddfddd49ca",j.callServer,void 0,j.findSourceMapURL,"saveChapter");function B(e){let{book_uuid:s,email:r}=e,{register:i,handleSubmit:n}=(0,b.useForm)(),[l,o]=a.default.useState(!1),u=async e=>{if(o(!0),!s){x.toast.error("no book selected"),o(!1);return}if(!r){x.toast.error("not logged in"),o(!1);return}if("success"===(await _({...e,uuid:(0,p.getUUID)(),book_uuid:s,order_num:parseInt("".concat(e.order_num),10),created_by:r,created_at:new Date,updated_at:new Date})).status)x.toast.success("save chapter success");else{x.toast.error("save chapter failed"),o(!1);return}};return(0,t.jsx)("form",{onSubmit:n(u),children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)(c.Input,{label:"Order",variant:"bordered",type:"number",size:"sm",...i("order_num")}),(0,t.jsx)(c.Input,{label:"Name",variant:"bordered",size:"sm",...i("name")}),(0,t.jsx)(d.Link,{as:"button",isDisabled:l,type:"submit",className:"bg-blue-500 rounded-md text-slate-50 px-2",children:"add new chapter"})]})})}var P=e.i(65213),R=(0,j.createServerReference)("70afd9896584254b489776cce2d25c7700eea542bb",j.callServer,void 0,j.findSourceMapURL,"saveAudio");function N(e){let{email:c}=e,[d,u]=(0,a.useState)([]),[f,h]=(0,a.useState)(""),[b,j]=(0,a.useState)([]),[_,N]=(0,a.useState)(""),[z,D]=(0,a.useState)(!1),[L,M]=a.default.useState(!1),[I,U]=(0,a.useState)([]),[C,O]=a.default.useState(!1),T=(0,a.useRef)([]),A=(0,a.useRef)(null),F=(e,t,a,s)=>{U(r=>r.map(r=>r.uuid===e?{uuid:r.uuid,chapter_uuid:r.chapter_uuid,order_num:r.order_num,original:t||r.original,recognized:a||r.recognized,audioBlob:s||r.audioBlob,modified_db:!!t,modified_fs:!!s}:r))},V=e=>{U(t=>t.filter(t=>t.uuid!==e))},E=async()=>{try{await Promise.all(I.map(async(e,t)=>{if(e.modified_fs&&e.audioBlob){let t=await R(e.audioBlob,"reading","".concat(e.uuid,".wav"));if("error"===t.status)throw Error("save audio failed")}if(e.modified_db){let a=await k({uuid:e.uuid,chapter_uuid:_,order_num:t,original:e.original,recognized:e.recognized,audio_path:"/api/data/reading/".concat(e.uuid,".wav"),created_by:c,created_at:new Date,updated_at:new Date});if("error"===a.status)throw Error("save sentence failed")}return!0})),x.toast.success("All sentences saved successfully!")}catch(e){x.toast.error(e.message||"Failed to save sentences")}},H=async()=>{O(await (0,P.checkSTTServiceStatus)())};return(0,a.useEffect)(()=>{(async()=>{if(!c)return;let e=await w(c);"success"===e.status&&u(e.data)})();let e=e=>{if(e.ctrlKey&&"y"===e.key){e.preventDefault();let t=document.getElementById("button-toggel-recording");null==t||t.click()}};document.addEventListener("keydown",e),H();let t=setInterval(H,3e4);return()=>{clearInterval(t),window.removeEventListener("keydown",e)}},[z,L]),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,t.jsxs)(s.Button,{size:"sm",variant:"solid",color:C?"success":"danger",onPress:H,children:["Speech-to-Text service is ",C?"available":"not available",", click to refresh"]})}),(0,t.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(l.Select,{label:"Select book",onChange:async e=>{let t=e.target.value;h(t);let a=await y(t);"success"===a.status&&j(a.data)},children:d.map(e=>(0,t.jsx)(o.SelectItem,{textValue:e.name,children:e.name},e.uuid))}),(0,t.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,t.jsxs)(r.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,t.jsx)(n.PopoverTrigger,{children:(0,t.jsx)(s.Button,{size:"sm",radius:"full",children:"new"})}),(0,t.jsx)(i.PopoverContent,{children:(0,t.jsx)("div",{className:"",children:(0,t.jsx)(g,{email:c})})})]}),(0,t.jsx)(s.Button,{size:"sm",radius:"full",onPress:async()=>{let e=await w(c);"success"===e.status&&u(e.data)},children:"refresh"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(l.Select,{label:"Select chapter",onChange:async e=>{let t=e.target.value;N(t);let a=await S(t);"success"===a.status&&U(a.data.map(e=>({...e,modified_db:!1,modified_fs:!1})))},children:b.map(e=>(0,t.jsxs)(o.SelectItem,{textValue:"".concat(e.order_num,", ").concat(e.name),children:[e.order_num,", ",e.name]},e.uuid))}),(0,t.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,t.jsxs)(r.Popover,{placement:"bottom",classNames:{content:"bg-slate-200"},children:[(0,t.jsx)(n.PopoverTrigger,{children:(0,t.jsx)(s.Button,{size:"sm",radius:"full",children:"new"})}),(0,t.jsx)(i.PopoverContent,{children:(0,t.jsx)("div",{className:"",children:(0,t.jsx)(B,{book_uuid:f,email:c})})})]}),(0,t.jsx)(s.Button,{size:"sm",radius:"full",onPress:async()=>{let e=await y(f);"success"===e.status&&j(e.data)},children:"refresh"})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,t.jsx)(s.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!z&&L,onPress:()=>{f&&_?(0,m.toggleRecording)(z,D,T,A,C,M,e=>{console.log(e)},(e,t)=>{"success"===e.status?U(a=>[...a,{uuid:(0,p.getUUID)(),chapter_uuid:"",order_num:I.length,original:e.data,recognized:e.data,audioBlob:t,modified_db:!0,modified_fs:!0}]):x.toast.error(e.error)}):alert("select book and chapter first")},children:z?"⏹ Stop Recording (Ctrl+Y)":"🎤 Speak a Sentence (Ctrl+Y)"}),(0,t.jsx)(s.Button,{variant:"solid",color:"primary",onPress:E,children:"save all sentences"})]}),I.length>0&&(0,t.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...I].reverse().map(e=>(0,t.jsx)(v,{rsp:e,onUpdate:F,onDelete:V},e.uuid))})]})}},75977,e=>{e.v(t=>Promise.all(["static/chunks/1301d5d9c51b8254.js"].map(t=>e.l(t))).then(()=>t(40588)))}]);