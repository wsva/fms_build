(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function t(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}e.s(["_",()=>t])},24597,e=>{"use strict";e.s(["Link",()=>g],24597);var t=e.i(84898),a=e.i(79754),r=(0,t.tv)({base:["relative inline-flex items-center outline-solid outline-transparent tap-highlight-transparent",...a.dataFocusVisibleClasses],variants:{size:{sm:"text-small",md:"text-medium",lg:"text-large"},color:{foreground:"text-foreground",primary:"text-primary",secondary:"text-secondary",success:"text-success",warning:"text-warning",danger:"text-danger"},underline:{none:"no-underline",hover:"hover:underline",always:"underline",active:"active:underline",focus:"focus:underline"},isBlock:{true:["px-2","py-1","hover:after:opacity-100","after:content-['']","after:inset-0","after:opacity-0","after:w-full","after:h-full","after:rounded-xl","after:transition-background","after:absolute"],false:"hover:opacity-hover active:opacity-disabled transition-opacity"},isDisabled:{true:"opacity-disabled cursor-default pointer-events-none"},disableAnimation:{true:"after:transition-none transition-none"}},compoundVariants:[{isBlock:!0,color:"foreground",class:"hover:after:bg-foreground/10"},{isBlock:!0,color:"primary",class:"hover:after:bg-primary/20"},{isBlock:!0,color:"secondary",class:"hover:after:bg-secondary/20"},{isBlock:!0,color:"success",class:"hover:after:bg-success/20"},{isBlock:!0,color:"warning",class:"hover:after:bg-warning/20"},{isBlock:!0,color:"danger",class:"hover:after:bg-danger/20"},{underline:["hover","always","active","focus"],class:"underline-offset-4"}],defaultVariants:{color:"primary",size:"md",isBlock:!1,underline:"none",isDisabled:!1}}),s=e.i(69080),i=e.i(50179),n=e.i(11458),o=e.i(49962),l=e.i(43027),d=e.i(73830),c=e.i(95494),u=e.i(20253),f=e.i(29427),m=e.i(75540),v=e.i(71645),h=e.i(43476),p=e=>(0,h.jsxs)("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",shapeRendering:"geometricPrecision",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",viewBox:"0 0 24 24",width:"1em",...e,children:[(0,h.jsx)("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),(0,h.jsx)("path",{d:"M15 3h6v6"}),(0,h.jsx)("path",{d:"M10 14L21 3"})]}),x=(0,d.forwardRef)((e,t)=>{let{Component:a,children:x,showAnchorIcon:g,anchorIcon:b=(0,h.jsx)(p,{className:"flex mx-1 text-current self-center"}),getLinkProps:y}=function(e){var t,a,h,p;let x=(0,c.useProviderContext)(),[g,b]=(0,d.mapPropsVariants)(e,r.variantKeys),{ref:y,as:j,children:S,anchorIcon:w,isExternal:_=!1,showAnchorIcon:k=!1,autoFocus:R=!1,className:B,onPress:z,onPressStart:P,onPressEnd:L,onClick:M,...N}=g,C=(0,u.useDOMRef)(y),D=null!=(a=null!=(t=null==e?void 0:e.disableAnimation)?t:null==x?void 0:x.disableAnimation)&&a,{linkProps:U}=function(e,t){let{elementType:a="a",onPress:r,onPressStart:d,onPressEnd:c,onClick:u,isDisabled:f,...m}=e,v={};"a"!==a&&(v={role:"link",tabIndex:f?void 0:0});let{focusableProps:h}=(0,o.useFocusable)(e,t),{pressProps:p,isPressed:x}=(0,l.usePress)({onClick:u,onPress:r,onPressStart:d,onPressEnd:c,isDisabled:f,ref:t}),g=(0,s.filterDOMProps)(m,{labelable:!0,isLink:"a"===a}),b=(0,i.mergeProps)(h,p),y=(0,n.useRouter)(),j=(0,n.useLinkProps)(e);return{isPressed:x,linkProps:(0,i.mergeProps)(g,j,{...b,...v,"aria-disabled":f||void 0,"aria-current":e["aria-current"],onClick:t=>{var a;null==(a=p.onClick)||a.call(p,t),(0,n.handleLinkClick)(t,y,e.href,e.routerOptions)}})}}({...N,onPress:z,onPressStart:P,onPressEnd:L,onClick:M,isDisabled:e.isDisabled,elementType:"".concat(j)},C),{isFocused:I,isFocusVisible:O,focusProps:T}=(0,f.useFocusRing)({autoFocus:R});_&&(N.rel=null!=(h=N.rel)?h:"noopener noreferrer",N.target=null!=(p=N.target)?p:"_blank");let A=(0,v.useMemo)(()=>r({...b,disableAnimation:D,className:B}),[(0,m.objectToDeps)(b),D,B]);return{Component:j||"a",children:S,anchorIcon:w,showAnchorIcon:k,getLinkProps:(0,v.useCallback)(()=>({ref:C,className:A,"data-focus":(0,m.dataAttr)(I),"data-disabled":(0,m.dataAttr)(e.isDisabled),"data-focus-visible":(0,m.dataAttr)(O),...(0,m.mergeProps)(T,U,N)}),[A,I,O,T,U,N])}}({ref:t,...e});return(0,h.jsx)(a,{...y(),children:(0,h.jsxs)(h.Fragment,{children:[x,g&&b]})})});x.displayName="HeroUI.Link";var g=x},77148,e=>{"use strict";e.s(["Textarea",()=>B],77148);var t=e.i(34738),a=e.i(75540),r=e.i(73830),s=e.i(71645);function i(){return(i=Object.assign.bind()).apply(null,arguments)}var n=s.useLayoutEffect,o=function(e){var t=s.default.useRef(e);return n(function(){t.current=e}),t},l=function(e,t){if("function"==typeof e)return void e(t);e.current=t},d=function(e,t){var a=s.default.useRef();return s.default.useCallback(function(r){e.current=r,a.current&&l(a.current,null),a.current=t,t&&l(t,r)},[t])},c={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},u=function(e){Object.keys(c).forEach(function(t){e.style.setProperty(t,c[t],"important")})},f=null,m=function(e,t){var a=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?a+t.borderSize:a-t.paddingSize},v=function(){},h=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],p=!!document.documentElement.currentStyle,x=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var a=h.reduce(function(e,a){return e[a]=t[a],e},{}),r=a.boxSizing;if(""===r)return null;p&&"border-box"===r&&(a.width=parseFloat(a.width)+parseFloat(a.borderRightWidth)+parseFloat(a.borderLeftWidth)+parseFloat(a.paddingRight)+parseFloat(a.paddingLeft)+"px");var s=parseFloat(a.paddingBottom)+parseFloat(a.paddingTop),i=parseFloat(a.borderBottomWidth)+parseFloat(a.borderTopWidth);return{sizingStyle:a,paddingSize:s,borderSize:i}};function g(e,t,a){var r=o(a);s.useLayoutEffect(function(){var a=function(e){return r.current(e)};if(e)return e.addEventListener(t,a),function(){return e.removeEventListener(t,a)}},[])}var b=function(e,t){g(document.body,"reset",function(a){e.current.form===a.target&&t(a)})},y=function(e){g(window,"resize",e)},j=function(e){g(document.fonts,"loadingdone",e)},S=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],w=s.forwardRef(function(e,t){var a=e.cacheMeasurements,r=e.maxRows,n=e.minRows,o=e.onChange,l=void 0===o?v:o,c=e.onHeightChange,h=void 0===c?v:c,p=function(e,t){if(null==e)return{};var a={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;a[r]=e[r]}return a}(e,S),g=void 0!==p.value,w=s.useRef(null),_=d(w,t),k=s.useRef(0),R=s.useRef(),B=function(){var e=w.current,t=a&&R.current?R.current:x(e);if(t){R.current=t;var s,i,o,l,d,c,v,p,g,b,y,j=(s=e.value||e.placeholder||"x",void 0===(i=n)&&(i=1),void 0===(o=r)&&(o=1/0),f||((f=document.createElement("textarea")).setAttribute("tabindex","-1"),f.setAttribute("aria-hidden","true"),u(f)),null===f.parentNode&&document.body.appendChild(f),l=t.paddingSize,d=t.borderSize,v=(c=t.sizingStyle).boxSizing,Object.keys(c).forEach(function(e){f.style[e]=c[e]}),u(f),f.value=s,p=m(f,t),f.value=s,p=m(f,t),f.value="x",b=(g=f.scrollHeight-l)*i,"border-box"===v&&(b=b+l+d),p=Math.max(b,p),y=g*o,"border-box"===v&&(y=y+l+d),[p=Math.min(y,p),g]),S=j[0],_=j[1];k.current!==S&&(k.current=S,e.style.setProperty("height",S+"px","important"),h(S,{rowHeight:_}))}};return s.useLayoutEffect(B),b(w,function(){if(!g){var e=w.current.value;requestAnimationFrame(function(){var t=w.current;t&&e!==t.value&&B()})}}),y(B),j(B),s.createElement("textarea",i({},p,{onChange:function(e){g||B(),l(e)},ref:_}))}),_=e.i(19110),k=e.i(43476),R=(0,r.forwardRef)((e,r)=>{let{style:i,minRows:n=3,maxRows:o=8,cacheMeasurements:l=!1,disableAutosize:d=!1,onHeightChange:c,...u}=e,{Component:f,label:m,description:v,startContent:h,endContent:p,hasHelper:x,shouldLabelBeOutside:g,shouldLabelBeInside:b,isInvalid:y,errorMessage:j,getBaseProps:S,getLabelProps:R,getInputProps:B,getInnerWrapperProps:z,getInputWrapperProps:P,getHelperWrapperProps:L,getDescriptionProps:M,getErrorMessageProps:N,isClearable:C,getClearButtonProps:D}=(0,t.useInput)({...u,ref:r,isMultiline:!0}),[U,I]=(0,s.useState)(n>1),[O,T]=(0,s.useState)(!1),A=m?(0,k.jsx)("label",{...R(),children:m}):null,E=B(),F=d?(0,k.jsx)("textarea",{...E,style:(0,a.mergeProps)(E.style,null!=i?i:{})}):(0,k.jsx)(w,{...E,cacheMeasurements:l,"data-hide-scroll":(0,a.dataAttr)(!O),maxRows:o,minRows:n,style:(0,a.mergeProps)(E.style,null!=i?i:{}),onHeightChange:(e,t)=>{1===n&&I(e>=2*t.rowHeight),o>n&&T(e>=o*t.rowHeight),null==c||c(e,t)}}),H=(0,s.useMemo)(()=>C?(0,k.jsx)("button",{...D(),children:(0,k.jsx)(_.CloseFilledIcon,{})}):null,[C,D]),W=(0,s.useMemo)(()=>h||p?(0,k.jsxs)("div",{...z(),children:[h,F,p]}):(0,k.jsx)("div",{...z(),children:F}),[h,E,p,z]),V=y&&j,K=V||v;return(0,k.jsxs)(f,{...S(),children:[g?A:null,(0,k.jsxs)("div",{...P(),"data-has-multiple-rows":(0,a.dataAttr)(U),children:[b?A:null,W,H]}),x&&K?(0,k.jsx)("div",{...L(),children:V?(0,k.jsx)("div",{...N(),children:j}):(0,k.jsx)("div",{...M(),children:v})}):null]})});R.displayName="HeroUI.Textarea";var B=R},32479,e=>{"use strict";e.s(["removeBook",()=>a]);var t=e.i(95187),a=(0,t.createServerReference)("4057d159d3c099e0f881f2bb30d85aa11524a0a764",t.callServer,void 0,t.findSourceMapURL,"removeBook")},22327,e=>{"use strict";e.s(["saveBook",()=>a]);var t=e.i(95187),a=(0,t.createServerReference)("407373f67bdf00e34e07ac057df2a04a35d5d936da",t.callServer,void 0,t.findSourceMapURL,"saveBook")},22980,e=>{"use strict";e.s(["default",()=>C],22980);var t=e.i(43476),a=e.i(71645),r=e.i(35889),s=e.i(12041),i=e.i(24597),n=e.i(77148),o=e.i(64925),l=e.i(73665),d=e.i(71508),c=e.i(70319);function u(e){return(e=e.replace(/\s+/g," ").trim())?e.split(/(\s+|[.,!?;:\-â€”()"'â€œâ€â€žÂ«Â»â€¦])/).filter(e=>null!=e&&""!==e).filter(e=>e.trim().length>0||" "===e):[]}function f(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var m=e.i(95187),v=(0,m.createServerReference)("605456d8df6e41c104084dd7768d7f7821c0d0b225",m.callServer,void 0,m.findSourceMapURL,"removeAudio"),h=(0,m.createServerReference)("70aaa950c3dad1f6bd4698d44294775540f412f7f8",m.callServer,void 0,m.findSourceMapURL,"saveAudio"),p=(0,m.createServerReference)("4095d819de22f68e612be43d96f6e22b1ce1267350",m.callServer,void 0,m.findSourceMapURL,"removeSentence"),x=(0,m.createServerReference)("402a6c09497e6aaa4f632ce7845f73480417461d96",m.callServer,void 0,m.findSourceMapURL,"saveSentence");function g(e){let{user_id:s,item:m,onUpdate:g,onDelete:b}=e,[y,j]=(0,a.useState)(!1),[S,w]=(0,a.useState)(!1),[_,k]=(0,a.useState)(m),[R,B]=(0,a.useState)(!1),z=(0,a.useRef)([]),P=(0,a.useRef)(null),L=async()=>{_.modified_fs&&_.audioBlob&&("success"===(await h(_.audioBlob,"reading","".concat(_.uuid,".wav"))).status?(c.toast.success("save audio success"),k({..._,on_fs:!0,modified_fs:!1})):c.toast.error("save audio failed")),_.modified_db&&("success"===(await x({..._,audio_path:"/api/data/reading/".concat(_.uuid,".wav"),created_by:s,created_at:_.created_at||new Date,updated_at:new Date})).status?(c.toast.success("save sentence success"),k({..._,in_db:!0,modified_db:!1})):c.toast.error("save sentence failed")),g(_)},M=async()=>{if(_.on_fs){if("success"!==(await v("reading","".concat(_.uuid,".wav"))).status)return void c.toast.error("delete audio failed");c.toast.success("delete audio success")}if(_.in_db){if("success"!==(await p(_.uuid)).status)return void c.toast.error("delete sentence failed");c.toast.success("delete sentence success")}b(_.uuid)};return(0,t.jsxs)("div",{className:"flex flex-col w-full gap-2 p-2 bg-sand-300",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,t.jsx)("div",{className:"text-xl",children:((e,a)=>{let r=u(e),s=u(a),{matchesB:i}=function(e,t){let a=e.length,r=t.length,s=Array.from({length:a+1},()=>Array(r+1).fill(0));for(let i=a-1;i>=0;i--)for(let a=r-1;a>=0;a--)e[i]===t[a]?s[i][a]=1+s[i+1][a+1]:s[i][a]=Math.max(s[i+1][a],s[i][a+1]);let i=0,n=0,o=[];for(;i<a&&n<r;)e[i]===t[n]?(o.push(n),i++,n++):s[i+1][n]>=s[i][n+1]?i++:n++;return{matchesB:o}}(r,s),n=new Set(i);return s.map((e,a)=>n.has(a)?(0,t.jsx)("span",{children:f(e)},a):(0,t.jsx)("span",{style:{background:"#ffeb3b"},children:f(e)},a))})(_.original,_.recognized)})]}),R?(0,t.jsx)(n.Textarea,{label:"original text",size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:_.original,onChange:e=>{k({..._,original:e.target.value,modified_db:!0}),g(_)}}):(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"text-md text-gray-400",children:"original text:"}),(0,t.jsx)("div",{className:"text-xl",children:_.original})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,t.jsx)("div",{className:"text-red-500 w-full",children:_.modified_db||_.modified_fs?"unsaved":""}),(0,t.jsx)(o.Tooltip,{placement:"bottom",content:"edit original",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",onPress:()=>B(!R),children:R?(0,t.jsx)(l.MdEditOff,{size:30}):(0,t.jsx)(l.MdEdit,{size:30})})}),(0,t.jsx)(o.Tooltip,{placement:"bottom",content:"save",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",onPress:L,children:(0,t.jsx)(l.MdOutlineSave,{size:30})})}),(0,t.jsx)(o.Tooltip,{placement:"bottom",content:"re-record",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",isDisabled:!y&&S,onPress:()=>{(0,d.toggleRecording)(y,j,z,P,!0,w,e=>{console.log(e)},(e,t)=>{"success"===e.status?(k({..._,recognized:e.data,audioBlob:t,modified_db:!0,modified_fs:!0}),g(_)):c.toast.error(e.error)})},children:y?(0,t.jsx)(l.MdMic,{size:30}):(0,t.jsx)(l.MdMicOff,{size:30})})}),(0,t.jsx)(o.Tooltip,{placement:"bottom",content:"play audio",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(_.audioBlob?URL.createObjectURL(_.audioBlob):_.audio_path).play()},children:(0,t.jsx)(l.MdPlayCircle,{size:30})})}),(0,t.jsx)(o.Tooltip,{placement:"bottom",content:"download audio",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",as:i.Link,href:_.audioBlob?URL.createObjectURL(_.audioBlob):_.audio_path,download:"reading_".concat(_.uuid,".wav"),children:(0,t.jsx)(l.MdDownloadForOffline,{size:30})})}),(0,t.jsx)(o.Tooltip,{content:"delete",children:(0,t.jsx)(r.Button,{isIconOnly:!0,variant:"light",onPress:M,children:(0,t.jsx)(l.MdDelete,{size:30})})})]})]})}var b=e.i(75157),y=(0,m.createServerReference)("40716bcc58739f5e73813d8a20b6d273ac078aa35f",m.callServer,void 0,m.findSourceMapURL,"getBookAll"),j=e.i(32479),S=e.i(22327),w=e.i(212),_=e.i(56124),k=e.i(76220);function R(e){let{user_id:s,onSelect:i}=e,[n,o]=(0,a.useState)([]),[l,d]=(0,a.useState)(""),[u,f]=(0,a.useState)(!1),[m,v]=(0,a.useState)(!1),h=async()=>{let e=await y(s);"success"===e.status&&o(e.data)},p=async()=>{if(!s)return void c.toast.error("not logged in");v(!0),"success"===(await (0,S.saveBook)({uuid:(0,b.getUUID)(),user_id:s,name:l,created_by:s,created_at:new Date,updated_at:new Date})).status?(c.toast.success("save book success"),d("")):c.toast.error("save book failed"),v(!1)},x=async e=>{v(!0),"success"===(await (0,j.removeBook)(e)).status?c.toast.success("delete book success"):c.toast.error("delete book failed"),v(!1)};return(0,a.useEffect)(()=>{h()},[l]),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(_.Select,{label:"Select book",onChange:async e=>{let t=e.target.value;await i(t)},children:n.map(e=>(0,t.jsx)(k.SelectItem,{textValue:e.name,children:e.name},e.uuid))}),(0,t.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:()=>f(!u),children:u?"finish":"edit"}),(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:h,children:"refresh"})]}),u&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,t.jsx)(w.Input,{label:"Name of Book",size:"sm",onChange:e=>d(e.target.value)}),(0,t.jsx)(r.Button,{size:"sm",radius:"full",isDisabled:m,onPress:p,children:"add"})]}),n.map(e=>(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[e.name,(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:()=>x(e.uuid),children:"delete"})]},e.uuid))]})]})}var B=(0,m.createServerReference)("40e21a81b46670b0c7e2f59192d5fdebb0f5d5c73c",m.callServer,void 0,m.findSourceMapURL,"getSentenceAll"),z=(0,m.createServerReference)("4048bd40eac02db62d347600003faba1a09c3a96b3",m.callServer,void 0,m.findSourceMapURL,"getChapterAll"),P=(0,m.createServerReference)("40e63e82646acd5f65db4e307b454e1ecde99cf4c2",m.callServer,void 0,m.findSourceMapURL,"removeChapter"),L=(0,m.createServerReference)("4056a4dd1428e0c7ca55055b2808da05f48476645c",m.callServer,void 0,m.findSourceMapURL,"saveChapter");function M(e){let{user_id:s,book_uuid:i,onSelect:n}=e,[o,l]=(0,a.useState)([]),[d,u]=(0,a.useState)(""),[f,m]=(0,a.useState)(""),[v,h]=(0,a.useState)(!1),[p,x]=(0,a.useState)(!1),g=async()=>{let e=await z(i);"success"===e.status&&l(e.data)},y=async()=>s?i?void(x(!0),"success"===(await L({uuid:(0,b.getUUID)(),book_uuid:i,order_num:parseInt(d,10),name:f,created_by:s,created_at:new Date,updated_at:new Date})).status?(c.toast.success("save chapter success"),m("")):c.toast.error("save chapter failed"),x(!1)):void c.toast.error("no book selected"):void c.toast.error("not logged in"),j=async e=>{x(!0),"success"===(await P(e)).status?c.toast.success("delete chapter success"):c.toast.error("delete chapter failed"),x(!1)};return(0,a.useEffect)(()=>{g()},[i,f]),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(_.Select,{label:"Select chapter",onChange:async e=>{let t=e.target.value;await n(t)},children:o.map(e=>(0,t.jsxs)(k.SelectItem,{textValue:"".concat(e.order_num,", ").concat(e.name),children:[e.order_num,", ",e.name]},e.uuid))}),(0,t.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:()=>h(!v),children:v?"finish":"edit"}),(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:g,children:"refresh"})]}),v&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,t.jsx)(w.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:e=>u(e.target.value)}),(0,t.jsx)(w.Input,{label:"Name of Book",size:"sm",onChange:e=>m(e.target.value)}),(0,t.jsx)(r.Button,{size:"sm",radius:"full",isDisabled:p,onPress:y,children:"add"})]}),o.map(e=>(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[e.order_num," - ",e.name,(0,t.jsx)(r.Button,{size:"sm",radius:"full",onPress:()=>j(e.uuid),children:"delete"})]},e.uuid))]})]})}var N=(0,m.createServerReference)("00b8629b21ea4717ae42313a420542014396181252",m.callServer,void 0,m.findSourceMapURL,"checkSTTServiceStatus");function C(e){let{email:i}=e,[n,o]=(0,a.useState)(""),[l,u]=(0,a.useState)(""),[f,m]=(0,a.useState)(!1),[v,p]=a.default.useState(!1),[y,j]=(0,a.useState)([]),[S,w]=a.default.useState(!1),[_,k]=a.default.useState(!1),z=(0,a.useRef)([]),P=(0,a.useRef)(null),L=async e=>{k(!0);let t=await B(e);"success"===t.status&&j(t.data.map(e=>({...(0,b.toExactType)(e),in_db:!0,on_fs:!0,modified_db:!1,modified_fs:!1}))),k(!1)},C=e=>{j(t=>t.map((t,a)=>t.uuid===e.uuid?{...e,order_num:a,modified_db:e.order_num===a}:{...t,order_num:a,modified_db:t.order_num===a}))},D=e=>{j(t=>t.filter(t=>t.uuid!==e)),j(e=>e.map((e,t)=>({...e,order_num:t,modified_db:e.order_num===t})))},U=async()=>{try{await Promise.all(y.map(async(e,t)=>{if(e.modified_fs&&e.audioBlob){let t=await h(e.audioBlob,"reading","".concat(e.uuid,".wav"));if("error"===t.status)throw Error("save audio failed");j(t=>t.map(t=>t.uuid===e.uuid?{...t,on_fs:!0,modified_fs:!1}:t))}let a=await x({...e,chapter_uuid:l,order_num:t,audio_path:"/api/data/reading/".concat(e.uuid,".wav"),created_by:i,created_at:e.created_at||new Date,updated_at:new Date});if("error"===a.status)throw Error("save sentence failed");return j(t=>t.map(t=>t.uuid===e.uuid?{...t,in_db:!0,modified_db:!1}:t)),!0})),c.toast.success("All sentences saved successfully!")}catch(e){c.toast.error(e.message||"Failed to save sentences")}},I=async()=>{w(await N())};return(0,a.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"y"===e.key){e.preventDefault();let t=document.getElementById("button-toggel-recording");null==t||t.click()}};document.addEventListener("keydown",e),I();let t=setInterval(I,3e4);return()=>{clearInterval(t),window.removeEventListener("keydown",e)}},[f,v]),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,t.jsxs)(r.Button,{size:"sm",variant:"solid",color:S?"success":"danger",onPress:I,children:["Speech-to-Text service is ",S?"available":"not available",", click to refresh"]})}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 my-2",children:[(0,t.jsx)(R,{user_id:i,onSelect:async e=>{o(e)}}),(0,t.jsx)(M,{user_id:i,book_uuid:n,onSelect:async e=>{u(e),await L(e)}})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,t.jsx)(r.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!f&&v,onPress:()=>{n&&l?(0,d.toggleRecording)(f,m,z,P,S,p,e=>{console.log(e)},(e,t)=>{"success"===e.status?j(a=>[...a,{uuid:(0,b.getUUID)(),chapter_uuid:"",order_num:y.length,original:e.data,recognized:e.data,audioBlob:t,in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}]):c.toast.error(e.error)}):alert("select book and chapter first")},children:f?"â¹ Stop Recording (Ctrl+Y)":"ðŸŽ¤ Speak a Sentence (Ctrl+Y)"}),(0,t.jsx)(r.Button,{variant:"solid",color:"primary",onPress:U,children:"save all sentences"})]}),_&&(0,t.jsx)(s.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),y.length>0&&(0,t.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...y].reverse().map(e=>(0,t.jsx)(g,{user_id:i,item:e,onUpdate:C,onDelete:D},e.uuid))})]})}},75977,e=>{e.v(t=>Promise.all(["static/chunks/1301d5d9c51b8254.js"].map(t=>e.l(t))).then(()=>t(40588)))}]);