(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,377148,e=>{"use strict";e.s(["Textarea",()=>D],377148);var t=e.i(834738),r=e.i(75540),a=e.i(273830),i=e.i(271645);function n(){return(n=Object.assign.bind()).apply(null,arguments)}var o=i.useLayoutEffect,s=function(e){var t=i.default.useRef(e);return o(function(){t.current=e}),t},l=function(e,t){if("function"==typeof e)return void e(t);e.current=t},d=function(e,t){var r=i.default.useRef();return i.default.useCallback(function(a){e.current=a,r.current&&l(r.current,null),r.current=t,t&&l(t,a)},[t])},c={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},u=function(e){Object.keys(c).forEach(function(t){e.style.setProperty(t,c[t],"important")})},f=null,m=function(e,t){var r=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?r+t.borderSize:r-t.paddingSize},p=function(){},h=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],g=!!document.documentElement.currentStyle,b=function(e){var t=window.getComputedStyle(e);if(null===t)return null;var r=h.reduce(function(e,r){return e[r]=t[r],e},{}),a=r.boxSizing;if(""===a)return null;g&&"border-box"===a&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px");var i=parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),n=parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth);return{sizingStyle:r,paddingSize:i,borderSize:n}};function v(e,t,r){var a=s(r);i.useLayoutEffect(function(){var r=function(e){return a.current(e)};if(e)return e.addEventListener(t,r),function(){return e.removeEventListener(t,r)}},[])}var y=function(e,t){v(document.body,"reset",function(r){e.current.form===r.target&&t(r)})},x=function(e){v(window,"resize",e)},_=function(e){v(document.fonts,"loadingdone",e)},w=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],j=i.forwardRef(function(e,t){var r=e.cacheMeasurements,a=e.maxRows,o=e.minRows,s=e.onChange,l=void 0===s?p:s,c=e.onHeightChange,h=void 0===c?p:c,g=function(e,t){if(null==e)return{};var r={};for(var a in e)if(({}).hasOwnProperty.call(e,a)){if(-1!==t.indexOf(a))continue;r[a]=e[a]}return r}(e,w),v=void 0!==g.value,j=i.useRef(null),S=d(j,t),P=i.useRef(0),z=i.useRef(),D=function(){var e=j.current,t=r&&z.current?z.current:b(e);if(t){z.current=t;var i,n,s,l,d,c,p,g,v,y,x,_=(i=e.value||e.placeholder||"x",void 0===(n=o)&&(n=1),void 0===(s=a)&&(s=1/0),f||((f=document.createElement("textarea")).setAttribute("tabindex","-1"),f.setAttribute("aria-hidden","true"),u(f)),null===f.parentNode&&document.body.appendChild(f),l=t.paddingSize,d=t.borderSize,p=(c=t.sizingStyle).boxSizing,Object.keys(c).forEach(function(e){f.style[e]=c[e]}),u(f),f.value=i,g=m(f,t),f.value=i,g=m(f,t),f.value="x",y=(v=f.scrollHeight-l)*n,"border-box"===p&&(y=y+l+d),g=Math.max(y,g),x=v*s,"border-box"===p&&(x=x+l+d),[g=Math.min(x,g),v]),w=_[0],S=_[1];P.current!==w&&(P.current=w,e.style.setProperty("height",w+"px","important"),h(w,{rowHeight:S}))}};return i.useLayoutEffect(D),y(j,function(){if(!v){var e=j.current.value;requestAnimationFrame(function(){var t=j.current;t&&e!==t.value&&D()})}}),x(D),_(D),i.createElement("textarea",n({},g,{onChange:function(e){v||D(),l(e)},ref:S}))}),S=e.i(619110),P=e.i(843476),z=(0,a.forwardRef)((e,a)=>{let{style:n,minRows:o=3,maxRows:s=8,cacheMeasurements:l=!1,disableAutosize:d=!1,onHeightChange:c,...u}=e,{Component:f,label:m,description:p,startContent:h,endContent:g,hasHelper:b,shouldLabelBeOutside:v,shouldLabelBeInside:y,isInvalid:x,errorMessage:_,getBaseProps:w,getLabelProps:z,getInputProps:D,getInnerWrapperProps:R,getInputWrapperProps:B,getHelperWrapperProps:N,getDescriptionProps:k,getErrorMessageProps:C,isClearable:I,getClearButtonProps:M}=(0,t.useInput)({...u,ref:a,isMultiline:!0}),[T,O]=(0,i.useState)(o>1),[A,F]=(0,i.useState)(!1),E=m?(0,P.jsx)("label",{...z(),children:m}):null,L=D(),U=d?(0,P.jsx)("textarea",{...L,style:(0,r.mergeProps)(L.style,null!=n?n:{})}):(0,P.jsx)(j,{...L,cacheMeasurements:l,"data-hide-scroll":(0,r.dataAttr)(!A),maxRows:s,minRows:o,style:(0,r.mergeProps)(L.style,null!=n?n:{}),onHeightChange:(e,t)=>{1===o&&O(e>=2*t.rowHeight),s>o&&F(e>=s*t.rowHeight),null==c||c(e,t)}}),W=(0,i.useMemo)(()=>I?(0,P.jsx)("button",{...M(),children:(0,P.jsx)(S.CloseFilledIcon,{})}):null,[I,M]),K=(0,i.useMemo)(()=>h||g?(0,P.jsxs)("div",{...R(),children:[h,U,g]}):(0,P.jsx)("div",{...R(),children:U}),[h,L,g,R]),H=x&&_,V=H||p;return(0,P.jsxs)(f,{...w(),children:[v?E:null,(0,P.jsxs)("div",{...B(),"data-has-multiple-rows":(0,r.dataAttr)(T),children:[y?E:null,K,W]}),b&&V?(0,P.jsx)("div",{...N(),children:H?(0,P.jsx)("div",{...C(),children:_}):(0,P.jsx)("div",{...k(),children:p})}):null]})});z.displayName="HeroUI.Textarea";var D=z},805483,104688,e=>{"use strict";e.s(["CircularProgress",()=>_],805483);var t=e.i(273830),r=e.i(595494),a=e.i(984898);(0,a.tv)({slots:{base:"flex flex-col gap-2 w-full",label:"",labelWrapper:"flex justify-between",value:"",track:"z-0 relative bg-default-300/50 overflow-hidden rtl:rotate-180",indicator:"h-full"},variants:{color:{default:{indicator:"bg-default-400"},primary:{indicator:"bg-primary"},secondary:{indicator:"bg-secondary"},success:{indicator:"bg-success"},warning:{indicator:"bg-warning"},danger:{indicator:"bg-danger"}},size:{sm:{label:"text-small",value:"text-small",track:"h-1"},md:{label:"text-medium",value:"text-medium",track:"h-3"},lg:{label:"text-large",value:"text-large",track:"h-5"}},radius:{none:{track:"rounded-none",indicator:"rounded-none"},sm:{track:"rounded-small",indicator:"rounded-small"},md:{track:"rounded-medium",indicator:"rounded-medium"},lg:{track:"rounded-large",indicator:"rounded-large"},full:{track:"rounded-full",indicator:"rounded-full"}},isStriped:{true:{indicator:"bg-stripe-gradient-default bg-stripe-size"}},isIndeterminate:{true:{indicator:["absolute","w-full","origin-left","animate-indeterminate-bar"]}},isDisabled:{true:{base:"opacity-disabled cursor-not-allowed"}},disableAnimation:{true:{},false:{indicator:"transition-transform !duration-500"}}},defaultVariants:{color:"primary",size:"md",radius:"full",isStriped:!1,isIndeterminate:!1,isDisabled:!1},compoundVariants:[{disableAnimation:!0,isIndeterminate:!1,class:{indicator:"!transition-none motion-reduce:transition-none"}},{color:"primary",isStriped:!0,class:{indicator:"bg-stripe-gradient-primary bg-stripe-size"}},{color:"secondary",isStriped:!0,class:{indicator:"bg-stripe-gradient-secondary bg-stripe-size"}},{color:"success",isStriped:!0,class:{indicator:"bg-stripe-gradient-success bg-stripe-size"}},{color:"warning",isStriped:!0,class:{indicator:"bg-stripe-gradient-warning bg-stripe-size"}},{color:"danger",isStriped:!0,class:{indicator:"bg-stripe-gradient-danger bg-stripe-size"}}]},{twMerge:!0});var i=(0,a.tv)({slots:{base:"flex flex-col justify-center gap-1 max-w-fit items-center",label:"",svgWrapper:"relative block",svg:"z-0 relative overflow-hidden",track:"h-full stroke-default-300/50",indicator:"h-full stroke-current",value:"absolute font-normal inset-0 flex items-center justify-center"},variants:{color:{default:{svg:"text-default-400"},primary:{svg:"text-primary"},secondary:{svg:"text-secondary"},success:{svg:"text-success"},warning:{svg:"text-warning"},danger:{svg:"text-danger"}},size:{sm:{svg:"w-8 h-8",label:"text-small",value:"text-[0.5rem]"},md:{svg:"w-10 h-10",label:"text-small",value:"text-[0.55rem]"},lg:{svg:"w-12 h-12",label:"text-medium",value:"text-[0.6rem]"}},isIndeterminate:{true:{svg:"animate-spinner-ease-spin"}},isDisabled:{true:{base:"opacity-disabled cursor-not-allowed"}},disableAnimation:{true:{},false:{indicator:"transition-all !duration-500"}}},defaultVariants:{color:"primary",size:"md",isDisabled:!1},compoundVariants:[{disableAnimation:!0,isIndeterminate:!1,class:{svg:"!transition-none motion-reduce:transition-none"}}]}),n=e.i(620253),o=e.i(75540),s=e.i(271645);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{rerender:t=!1,delay:r=0}=e,a=(0,s.useRef)(!1),[i,n]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{a.current=!0;let e=null;return t&&(r>0?e=setTimeout(()=>{n(!0)},r):n(!0)),()=>{a.current=!1,t&&n(!1),e&&clearTimeout(e)}},[t]),[(0,s.useCallback)(()=>a.current,[]),i]}e.s(["useIsMounted",()=>l],104688);var d=e.i(569080),c=e.i(368919),u=e.i(750179),f=e.i(84079),m=e.i(596102);let p=new Map,h=!1;try{h="exceptZero"===new Intl.NumberFormat("de-DE",{signDisplay:"exceptZero"}).resolvedOptions().signDisplay}catch(e){}let g=!1;try{g="unit"===new Intl.NumberFormat("de-DE",{style:"unit",unit:"degree"}).resolvedOptions().style}catch(e){}let b={degree:{narrow:{default:"Â°","ja-JP":" åº¦","zh-TW":"åº¦","sl-SI":" Â°"}}};class v{format(e){let t="";if(t=h||null==this.options.signDisplay?this.numberFormatter.format(e):function(e,t,r){if("auto"===t)return e.format(r);{if("never"===t)return e.format(Math.abs(r));let a=!1;if("always"===t?a=r>0||Object.is(r,0):"exceptZero"===t&&(Object.is(r,-0)||Object.is(r,0)?r=Math.abs(r):a=r>0),!a)return e.format(r);{let t=e.format(-r),a=e.format(r),i=t.replace(a,"").replace(/\u200e|\u061C/,"");return 1!=[...i].length&&console.warn("@react-aria/i18n polyfill for NumberFormat signDisplay: Unsupported case"),t.replace(a,"!!!").replace(i,"+").replace("!!!",a)}}}(this.numberFormatter,this.options.signDisplay,e),"unit"===this.options.style&&!g){var r;let{unit:e,unitDisplay:a="short",locale:i}=this.resolvedOptions();if(!e)return t;let n=null==(r=b[e])?void 0:r[a];t+=n[i]||n.default}return t}formatToParts(e){return this.numberFormatter.formatToParts(e)}formatRange(e,t){if("function"==typeof this.numberFormatter.formatRange)return this.numberFormatter.formatRange(e,t);if(t<e)throw RangeError("End date must be >= start date");return"".concat(this.format(e)," â€“ ").concat(this.format(t))}formatRangeToParts(e,t){if("function"==typeof this.numberFormatter.formatRangeToParts)return this.numberFormatter.formatRangeToParts(e,t);if(t<e)throw RangeError("End date must be >= start date");let r=this.numberFormatter.formatToParts(e),a=this.numberFormatter.formatToParts(t);return[...r.map(e=>({...e,source:"startRange"})),{type:"literal",value:" â€“ ",source:"shared"},...a.map(e=>({...e,source:"endRange"}))]}resolvedOptions(){let e=this.numberFormatter.resolvedOptions();return h||null==this.options.signDisplay||(e={...e,signDisplay:this.options.signDisplay}),g||"unit"!==this.options.style||(e={...e,style:"unit",unit:this.options.unit,unitDisplay:this.options.unitDisplay}),e}constructor(e,t={}){this.numberFormatter=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{numberingSystem:r}=t;if(r&&e.includes("-nu-")&&(e.includes("-u-")||(e+="-u-"),e+="-nu-".concat(r)),"unit"===t.style&&!g){var a;let{unit:e,unitDisplay:r="short"}=t;if(!e)throw Error('unit option must be provided with style: "unit"');if(!(null==(a=b[e])?void 0:a[r]))throw Error("Unsupported unit ".concat(e," with unitDisplay = ").concat(r));t={...t,style:"decimal"}}let i=e+(t?Object.entries(t).sort((e,t)=>e[0]<t[0]?-1:1).join():"");if(p.has(i))return p.get(i);let n=new Intl.NumberFormat(e,t);return p.set(i,n),n}(e,t),this.options=t}}var y=e.i(843476),x=(0,t.forwardRef)((e,a)=>{let{Component:p,slots:h,classNames:g,label:b,showValueLabel:x,getProgressBarProps:_,getLabelProps:w,getSvgProps:j,getIndicatorProps:S,getTrackProps:P}=function(e){var a,p,h;let g=(0,r.useProviderContext)(),[b,y]=(0,t.mapPropsVariants)(e,i.variantKeys),{ref:x,as:_,id:w,className:j,classNames:S,label:P,valueLabel:z,value:D,minValue:R=0,maxValue:B=100,strokeWidth:N,showValueLabel:k=!1,formatOptions:C={style:"percent"},...I}=b,M=(0,n.useDOMRef)(x),T=(0,o.clsx)(null==S?void 0:S.base,j),[,O]=l({rerender:!0,delay:100}),A=(null==(a=e.isIndeterminate)||a)&&void 0===D,F=null!=(h=null!=(p=e.disableAnimation)?p:null==g?void 0:g.disableAnimation)&&h,{progressBarProps:E,labelProps:L}=function(e){let{value:t=0,minValue:r=0,maxValue:a=100,valueLabel:i,isIndeterminate:n,formatOptions:o={style:"percent"}}=e,l=(0,d.filterDOMProps)(e,{labelable:!0}),{labelProps:p,fieldProps:h}=(0,f.useLabel)({...e,labelElementType:"span"}),g=((t=(0,c.clamp)(t,r,a))-r)/(a-r),b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{locale:t}=(0,m.useLocale)();return(0,s.useMemo)(()=>new v(t,e),[t,e])}(o);if(!n&&!i){let e="percent"===o.style?g:t;i=b.format(e)}return{progressBarProps:(0,u.mergeProps)(l,{...h,"aria-valuenow":n?void 0:t,"aria-valuemin":r,"aria-valuemax":a,"aria-valuetext":n?void 0:i,role:"progressbar"}),labelProps:p}}({id:w,label:P,value:D,minValue:R,maxValue:B,valueLabel:z,formatOptions:C,isIndeterminate:A,"aria-labelledby":e["aria-labelledby"],"aria-label":e["aria-label"]}),U=(0,s.useMemo)(()=>i({...y,disableAnimation:F,isIndeterminate:A}),[(0,o.objectToDeps)(y),F,A]),W=!!F||O,K=N||("sm"===e.size?2:3),H=16-K,V=2*H*Math.PI,Z=V-(0,s.useMemo)(()=>W?A?.25:D?(0,o.clampPercentage)((D-R)/(B-R),1):0:0,[W,D,R,B,A])*V,q=(0,s.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{ref:M,"data-indeterminate":(0,o.dataAttr)(A),"data-disabled":(0,o.dataAttr)(e.isDisabled),className:U.base({class:T}),...(0,o.mergeProps)(E,I,t)}},[M,U,A,e.isDisabled,T,E,I]),G=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{className:U.label({class:null==S?void 0:S.label}),...(0,o.mergeProps)(L,e)}},[U,S,L]),J=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{viewBox:"0 0 32 32",fill:"none",strokeWidth:K,className:U.svg({class:null==S?void 0:S.svg}),...e}},[K,U,S]),X=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{cx:16,cy:16,r:H,role:"presentation",strokeDasharray:"".concat(V," ").concat(V),strokeDashoffset:Z,transform:"rotate(-90 16 16)",strokeLinecap:"round",className:U.indicator({class:null==S?void 0:S.indicator}),...e}},[U,S,Z,V,H]),Q=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{cx:16,cy:16,r:H,role:"presentation",strokeDasharray:"".concat(V," ").concat(V),strokeDashoffset:0,transform:"rotate(-90 16 16)",strokeLinecap:"round",className:U.track({class:null==S?void 0:S.track}),...e}},[U,S,V,H]);return{Component:_||"div",domRef:M,slots:U,classNames:S,label:P,showValueLabel:k,getProgressBarProps:q,getLabelProps:G,getSvgProps:J,getIndicatorProps:X,getTrackProps:Q}}({ref:a,...e}),z=_();return(0,y.jsxs)(p,{...z,children:[(0,y.jsxs)("div",{className:h.svgWrapper({class:null==g?void 0:g.svgWrapper}),children:[(0,y.jsxs)("svg",{...j(),children:[(0,y.jsx)("circle",{...P()}),(0,y.jsx)("circle",{...S()})]}),x&&(0,y.jsx)("span",{className:h.value({class:null==g?void 0:g.value}),children:z["aria-valuetext"]})]}),b&&(0,y.jsx)("span",{...w(),children:b})]})});x.displayName="HeroUI.CircularProgress";var _=x},682455,953220,e=>{"use strict";e.s(["removeAudio",()=>r],682455);var t=e.i(95187),r=(0,t.createServerReference)("60c010d65280bbe2bcb54110c16151746eb42a5c0e",t.callServer,void 0,t.findSourceMapURL,"removeAudio");e.s(["saveAudio",()=>a],953220);var a=(0,t.createServerReference)("709eb17f1ad29b7b3119924a27e54f93230de7f55b",t.callServer,void 0,t.findSourceMapURL,"saveAudio")},935035,e=>{"use strict";e.s(["callTTS",()=>r]);var t=e.i(95187),r=(0,t.createServerReference)("60be943a0e257ddbc07b82f7ce75037b419f0e4bd4",t.callServer,void 0,t.findSourceMapURL,"callTTS")},673101,e=>{"use strict";e.s(["deleteBlobFromIndexedDB",()=>n,"getBlobFromIndexedDB",()=>i,"saveBlobToIndexedDB",()=>a]);let t="blobs";function r(){return new Promise((e,r)=>{let a=indexedDB.open("audio-store",1);a.onupgradeneeded=e=>{let r=e.target.result;r.objectStoreNames.contains(t)||r.createObjectStore(t,{keyPath:"uuid"})},a.onsuccess=()=>{e(a.result)},a.onerror=()=>{r(a.error)}})}async function a(e,a){let i=await r();return new Promise((r,n)=>{let o=i.transaction(t,"readwrite").objectStore(t),s={uuid:e,audioBlob:a,createdAt:Date.now()},l=o.put(s);l.onsuccess=()=>r(),l.onerror=()=>n(l.error)})}async function i(e){let a=await r();return new Promise((r,i)=>{let n=a.transaction(t,"readonly").objectStore(t).get(e);n.onsuccess=()=>{let e=n.result;r(e?e.audioBlob:null)},n.onerror=()=>i(n.error)})}async function n(e){let a=await r();return new Promise((r,i)=>{let n=a.transaction(t,"readwrite").objectStore(t).delete(e);n.onsuccess=()=>r(),n.onerror=()=>i(n.error)})}},820738,e=>{"use strict";e.s(["cacheBlobInMemory",()=>a,"dropWeakCache",()=>n,"getBlobFromWeakCache",()=>i]);let t=new Map,r=new FinalizationRegistry(e=>{t.delete(e)});function a(e,a){if("undefined"==typeof WeakRef)return;let i=new WeakRef(a);t.set(e,i);try{r.register(a,e,a)}catch(e){console.log(e)}}function i(e){let r=t.get(e);if(!r)return null;let a=r.deref();return a||(t.delete(e),null)}function n(e){t.delete(e)}},917648,e=>{"use strict";e.s(["highlightDifferences",()=>i]);var t=e.i(843476);function r(e){return(e=e.replace(/\s+/g," ").trim())?e.split(/(\s+|[.,!?;:\-â€”()"'â€œâ€â€žÂ«Â»â€¦])/).filter(e=>null!=e&&""!==e).filter(e=>e.trim().length>0||" "===e):[]}function a(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}let i=(e,i)=>{let n=r(e),o=r(i),{matchesB:s}=function(e,t){let r=e.length,a=t.length,i=Array.from({length:r+1},()=>Array(a+1).fill(0));for(let n=r-1;n>=0;n--)for(let r=a-1;r>=0;r--)e[n]===t[r]?i[n][r]=1+i[n+1][r+1]:i[n][r]=Math.max(i[n+1][r],i[n][r+1]);let n=0,o=0,s=[];for(;n<r&&o<a;)e[n]===t[o]?(s.push(o),n++,o++):i[n+1][o]>=i[n][o+1]?n++:o++;return{matchesB:s}}(n,o),l=new Set(s);return o.map((e,r)=>l.has(r)?(0,t.jsx)("span",{children:a(e)},r):(0,t.jsx)("span",{style:{background:"#ffeb3b"},children:a(e)},r))}},649980,e=>{"use strict";e.s(["useImmer",()=>W],649980),e.i(247167);var t,r=Symbol.for("immer-nothing"),a=Symbol.for("immer-draftable"),i=Symbol.for("immer-state");function n(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];throw Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var o=Object.getPrototypeOf;function s(e){return!!e&&!!e[i]}function l(e){var t;return!!e&&(c(e)||Array.isArray(e)||!!e[a]||!!(null==(t=e.constructor)?void 0:t[a])||h(e)||g(e))}var d=Object.prototype.constructor.toString();function c(e){if(!e||"object"!=typeof e)return!1;let t=o(e);if(null===t)return!0;let r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return r===Object||"function"==typeof r&&Function.toString.call(r)===d}function u(e,t){0===f(e)?Reflect.ownKeys(e).forEach(r=>{t(r,e[r],e)}):e.forEach((r,a)=>t(a,r,e))}function f(e){let t=e[i];return t?t.type_:Array.isArray(e)?1:h(e)?2:3*!!g(e)}function m(e,t){return 2===f(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function p(e,t,r){let a=f(e);2===a?e.set(t,r):3===a?e.add(r):e[t]=r}function h(e){return e instanceof Map}function g(e){return e instanceof Set}function b(e){return e.copy_||e.base_}function v(e,t){if(h(e))return new Map(e);if(g(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);let r=c(e);if(!0!==t&&("class_only"!==t||r)){let t=o(e);return null!==t&&r?{...e}:Object.assign(Object.create(t),e)}{let t=Object.getOwnPropertyDescriptors(e);delete t[i];let r=Reflect.ownKeys(t);for(let a=0;a<r.length;a++){let i=r[a],n=t[i];!1===n.writable&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[i]={configurable:!0,writable:!0,enumerable:n.enumerable,value:e[i]})}return Object.create(o(e),t)}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _(e)||s(e)||!l(e)||(f(e)>1&&Object.defineProperties(e,{set:{value:x},add:{value:x},clear:{value:x},delete:{value:x}}),Object.freeze(e),t&&Object.values(e).forEach(e=>y(e,!0))),e}function x(){n(2)}function _(e){return Object.isFrozen(e)}var w={};function j(e){let t=w[e];return t||n(0,e),t}function S(e,t){t&&(j("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function P(e){z(e),e.drafts_.forEach(R),e.drafts_=null}function z(e){e===t&&(t=e.parent_)}function D(e){return t={drafts_:[],parent_:t,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function R(e){let t=e[i];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function B(e,t){t.unfinalizedDrafts_=t.drafts_.length;let a=t.drafts_[0];return void 0!==e&&e!==a?(a[i].modified_&&(P(t),n(4)),l(e)&&(e=N(t,e),t.parent_||C(t,e)),t.patches_&&j("Patches").generateReplacementPatches_(a[i].base_,e,t.patches_,t.inversePatches_)):e=N(t,a,[]),P(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==r?e:void 0}function N(e,t,r){if(_(t))return t;let a=t[i];if(!a)return u(t,(i,n)=>k(e,a,t,i,n,r)),t;if(a.scope_!==e)return t;if(!a.modified_)return C(e,a.base_,!0),a.base_;if(!a.finalized_){a.finalized_=!0,a.scope_.unfinalizedDrafts_--;let t=a.copy_,i=t,n=!1;3===a.type_&&(i=new Set(t),t.clear(),n=!0),u(i,(i,o)=>k(e,a,t,i,o,r,n)),C(e,t,!1),r&&e.patches_&&j("Patches").generatePatches_(a,r,e.patches_,e.inversePatches_)}return a.copy_}function k(e,t,r,a,i,n,o){if(s(i)){let o=N(e,i,n&&t&&3!==t.type_&&!m(t.assigned_,a)?n.concat(a):void 0);if(p(r,a,o),!s(o))return;e.canAutoFreeze_=!1}else o&&r.add(i);if(l(i)&&!_(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;N(e,i),(!t||!t.scope_.parent_)&&"symbol"!=typeof a&&(h(r)?r.has(a):Object.prototype.propertyIsEnumerable.call(r,a))&&C(e,i)}}function C(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&y(t,r)}var I={get(e,t){if(t===i)return e;let r=b(e);if(!m(r,t)){var a,n=e,o=r,s=t;let i=O(o,s);return i?"value"in i?i.value:null==(a=i.get)?void 0:a.call(n.draft_):void 0}let d=r[t];return e.finalized_||!l(d)?d:d===T(e.base_,t)?(F(e),e.copy_[t]=E(d,e)):d},has:(e,t)=>t in b(e),ownKeys:e=>Reflect.ownKeys(b(e)),set(e,t,r){let a=O(b(e),t);if(null==a?void 0:a.set)return a.set.call(e.draft_,r),!0;if(!e.modified_){let a=T(b(e),t),n=null==a?void 0:a[i];if(n&&n.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if((r===a?0!==r||1/r==1/a:r!=r&&a!=a)&&(void 0!==r||m(e.base_,t)))return!0;F(e),A(e)}return!!(e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t]))||(e.copy_[t]=r,e.assigned_[t]=!0,!0)},deleteProperty:(e,t)=>(void 0!==T(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,F(e),A(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){let r=b(e),a=Reflect.getOwnPropertyDescriptor(r,t);return a?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:a.enumerable,value:r[t]}:a},defineProperty(){n(11)},getPrototypeOf:e=>o(e.base_),setPrototypeOf(){n(12)}},M={};function T(e,t){let r=e[i];return(r?b(r):e)[t]}function O(e,t){if(!(t in e))return;let r=o(e);for(;r;){let e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=o(r)}}function A(e){!e.modified_&&(e.modified_=!0,e.parent_&&A(e.parent_))}function F(e){e.copy_||(e.copy_=v(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function E(e,r){let a=h(e)?j("MapSet").proxyMap_(e,r):g(e)?j("MapSet").proxySet_(e,r):function(e,r){let a=Array.isArray(e),i={type_:+!!a,scope_:r?r.scope_:t,modified_:!1,finalized_:!1,assigned_:{},parent_:r,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1},n=i,o=I;a&&(n=[i],o=M);let{revoke:s,proxy:l}=Proxy.revocable(n,o);return i.draft_=l,i.revoke_=s,l}(e,r);return(r?r.scope_:t).drafts_.push(a),a}u(I,(e,t)=>{M[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),M.deleteProperty=function(e,t){return M.set.call(this,e,t,void 0)},M.set=function(e,t,r){return I.set.call(this,e[0],t,r,e[0])};var L=new class{createDraft(e){var t;l(e)||n(8),s(e)&&(s(t=e)||n(10,t),e=function e(t){let r;if(!l(t)||_(t))return t;let a=t[i];if(a){if(!a.modified_)return a.base_;a.finalized_=!0,r=v(t,a.scope_.immer_.useStrictShallowCopy_)}else r=v(t,!0);return u(r,(t,a)=>{p(r,t,e(a))}),a&&(a.finalized_=!1),r}(t));let r=D(this),a=E(e,void 0);return a[i].isManual_=!0,z(r),a}finishDraft(e,t){let r=e&&e[i];r&&r.isManual_||n(9);let{scope_:a}=r;return S(a,t),B(void 0,a)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){let a=t[r];if(0===a.path.length&&"replace"===a.op){e=a.value;break}}r>-1&&(t=t.slice(r+1));let a=j("Patches").applyPatches_;return s(e)?a(e,t):this.produce(e,e=>a(e,t))}constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,a)=>{let i;if("function"==typeof e&&"function"!=typeof t){let r=t;t=e;let a=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;for(var i=arguments.length,n=Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];return a.produce(e,e=>t.call(this,e,...n))}}if("function"!=typeof t&&n(6),void 0!==a&&"function"!=typeof a&&n(7),l(e)){let r=D(this),n=E(e,void 0),o=!0;try{i=t(n),o=!1}finally{o?P(r):z(r)}return S(r,a),B(i,r)}if(e&&"object"==typeof e)n(1,e);else{if(void 0===(i=t(e))&&(i=e),i===r&&(i=void 0),this.autoFreeze_&&y(i,!0),a){let t=[],r=[];j("Patches").generateReplacementPatches_(e,i,t,r),a(t,r)}return i}},this.produceWithPatches=(e,t)=>{let r,a;if("function"==typeof e){var i=this;return function(t){for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];return i.produceWithPatches(t,t=>e(t,...a))}}return[this.produce(e,t,(e,t)=>{r=e,a=t}),r,a]},"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof(null==e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}}().produce,U=e.i(271645);function W(e){var t=(0,U.useState)(function(){return y("function"==typeof e?e():e,!0)}),r=t[1];return[t[0],(0,U.useCallback)(function(e){r("function"==typeof e?L(e):y(e))},[])]}},830902,662549,e=>{"use strict";e.s(["default",()=>p],830902);var t=e.i(843476),r=e.i(95187),a=(0,r.createServerReference)("4085d987925109a583a692a54ae6adb4674e36da5a",r.callServer,void 0,r.findSourceMapURL,"getBookAll"),i=(0,r.createServerReference)("40a55856972ec5500be70169436d5090b029b8ef3c",r.callServer,void 0,r.findSourceMapURL,"removeBook"),n=(0,r.createServerReference)("402295d8e36b5601d0dd36ef473927abb7c82a61d2",r.callServer,void 0,r.findSourceMapURL,"saveBook"),o=e.i(975157),s=e.i(736132),l=e.i(335889),d=e.i(805483),c=e.i(900212),u=e.i(356124),f=e.i(76220),m=e.i(271645);function p(e){let{user_id:r,onSelect:p}=e,[h,g]=(0,m.useState)([]),[b,v]=(0,m.useState)(1),[y,x]=(0,m.useState)(""),[_,w]=(0,m.useState)(!1),[j,S]=(0,m.useState)(!1),[P,z]=(0,m.useState)(!1),D=async()=>{S(!0);let e=await n({uuid:(0,o.getUUID)(),user_id:r,name:y,created_by:r,created_at:new Date,updated_at:new Date});"success"===e.status?(x(""),v(e=>e+1)):(console.log(e.error),(0,s.addToast)({title:"save data error",color:"danger"})),S(!1)},R=async e=>{S(!0);let t=await i(e);"success"===t.status?v(e=>e+1):(console.log(t.error),(0,s.addToast)({title:"remove data error",color:"danger"})),S(!1)};return(0,m.useEffect)(()=>{(async()=>{z(!0);let e=await a(r);"success"===e.status?g(e.data):(console.log(e.error),(0,s.addToast)({title:"load data error",color:"danger"})),z(!1)})()},[r,b]),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(u.Select,{label:"Select book",onChange:async e=>{let t=e.target.value;await p(t)},endContent:P&&(0,t.jsx)(d.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:h.map(e=>(0,t.jsx)(f.SelectItem,{textValue:e.name,children:e.name},e.uuid))}),(0,t.jsx)("div",{className:"flex flex-row gap-1",children:(0,t.jsx)(l.Button,{size:"sm",radius:"full",onPress:()=>w(!_),children:_?"finish":"edit"})}),_&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 mx-0",children:[(0,t.jsx)(c.Input,{label:"Name",labelPlacement:"outside-left",size:"sm",classNames:{mainWrapper:"w-full"},onChange:e=>x(e.target.value)}),(0,t.jsx)(l.Button,{size:"sm",isDisabled:j,onPress:D,children:"add"})]}),h.map(e=>(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[e.name,(0,t.jsx)(l.Button,{size:"sm",isDisabled:j,onPress:()=>R(e.uuid),children:"delete"})]},e.uuid))]})]})}e.s(["default",()=>v],662549);var h=(0,r.createServerReference)("4034c0fc10e98467ec616c1eb4719df239587e995e",r.callServer,void 0,r.findSourceMapURL,"getChapterAll"),g=(0,r.createServerReference)("402b315fd650ffdcbc99f22867d27052f2ff2508d7",r.callServer,void 0,r.findSourceMapURL,"removeChapter"),b=(0,r.createServerReference)("40fc60b064ce3fe2fb7a13d6baa31541896716f46e",r.callServer,void 0,r.findSourceMapURL,"saveChapter");function v(e){let{user_id:r,book_uuid:a,onSelect:i}=e,[n,p]=(0,m.useState)([]),[v,y]=(0,m.useState)(1),[x,_]=(0,m.useState)(""),[w,j]=(0,m.useState)(""),[S,P]=(0,m.useState)(!1),[z,D]=(0,m.useState)(!1),[R,B]=(0,m.useState)(!1),N=async()=>{if(!a)return void(0,s.addToast)({title:"no book selected",color:"danger"});D(!0);let e=await b({uuid:(0,o.getUUID)(),book_uuid:a,order_num:parseInt(x,10),name:w,created_by:r,created_at:new Date,updated_at:new Date});"success"===e.status?(j(""),y(e=>e+1)):(console.log(e.error),(0,s.addToast)({title:"save data error",color:"danger"})),D(!1)},k=async e=>{D(!0);let t=await g(e);"success"===t.status?y(e=>e+1):(console.log(t.error),(0,s.addToast)({title:"remove data error",color:"danger"})),D(!1)};return(0,m.useEffect)(()=>{(async()=>{if(!a)return;B(!0);let e=await h(a);"success"===e.status?p(e.data):(console.log(e.error),(0,s.addToast)({title:"load data error",color:"danger"})),B(!1)})()},[a,v]),(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsx)(u.Select,{label:"Select chapter",onChange:async e=>{let t=e.target.value;await i(t)},endContent:R&&(0,t.jsx)(d.CircularProgress,{"aria-label":"Loading...",color:"default"}),children:n.map(e=>(0,t.jsxs)(f.SelectItem,{textValue:"".concat(e.order_num,", ").concat(e.name),children:[e.order_num,", ",e.name]},e.uuid))}),(0,t.jsx)("div",{className:"flex flex-row gap-1",children:(0,t.jsx)(l.Button,{size:"sm",radius:"full",onPress:()=>P(!S),children:S?"finish":"edit"})}),S&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,t.jsx)(c.Input,{label:"Order",labelPlacement:"outside-left",type:"number",size:"sm",className:"w-2/5",onChange:e=>_(e.target.value)}),(0,t.jsx)(c.Input,{label:"Name",labelPlacement:"outside-left",size:"sm",classNames:{mainWrapper:"w-full"},onChange:e=>j(e.target.value)}),(0,t.jsx)(l.Button,{size:"sm",isDisabled:z,onPress:N,children:"add"})]}),n.map(e=>(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[e.order_num," - ",e.name,(0,t.jsx)(l.Button,{size:"sm",isDisabled:z,onPress:()=>k(e.uuid),children:"delete"})]},e.uuid))]})]})}},485529,e=>{"use strict";e.s(["default",()=>D],485529);var t=e.i(843476),r=e.i(271645),a=e.i(649980),i=e.i(736132),n=e.i(335889),o=e.i(356124),s=e.i(76220),l=e.i(112041),d=e.i(377148),c=e.i(564925),u=e.i(473665),f=e.i(671508),m=e.i(935035),p=e.i(673101),h=e.i(820738),g=e.i(917648);function b(e){let{item:a,engine:o,handleUpdate:s,handleDelete:l}=e,[b,v]=(0,r.useState)([]),[y,x]=(0,r.useState)(!1),[_,w]=(0,r.useState)(!1),[j,S]=(0,r.useState)(!1),[P,z]=(0,r.useState)(!1),D=async()=>{let e=async(e,t)=>{"success"===e.status?(await (0,p.saveBlobToIndexedDB)(a.uuid,t),(0,h.cacheBlobInMemory)(a.uuid,t),s({...a,recognized:e.data,modified_db:!0,modified_fs:!0})):(0,i.addToast)({title:e.error,color:"danger"})};a.modified_fs&&(await (0,p.deleteBlobFromIndexedDB)(a.uuid),(0,h.dropWeakCache)(a.uuid)),await (0,f.toggleRecording)({mode:"audio",stateRecorder:b,setStateRecorder:v,stateRecording:y,setStateRecording:x,recognize:!0,sttEngine:o,setStateProcessing:w,handleAudio:e})};return(0,t.jsxs)("div",{className:"flex flex-col items-start justify-start w-full rounded-lg bg-sand-300",children:[(0,t.jsxs)("div",{className:"flex flex-row items-start justify-start w-full my-2",children:[a.modified_db||a.modified_fs?(0,t.jsx)(c.Tooltip,{placement:"bottom",content:"unsaved",children:(0,t.jsx)("div",{className:"text-red-500",children:"â—"})}):(0,t.jsx)("div",{className:"text-transparent",children:"â—"}),(0,t.jsxs)("div",{className:"flex flex-col w-full ps-2",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start w-full",children:[(0,t.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,t.jsx)(c.Tooltip,{placement:"top",content:"re-record",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:!y&&_,onPress:D,children:y?(0,t.jsx)(u.MdMic,{size:20}):(0,t.jsx)(u.MdMicOff,{size:20})})}),(0,t.jsx)(c.Tooltip,{placement:"top",content:"play audio",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:async()=>{if(a.modified_fs){let e=(0,h.getBlobFromWeakCache)(a.uuid);if(e||((e=await (0,p.getBlobFromIndexedDB)(a.uuid))?(0,h.cacheBlobInMemory)(a.uuid,e):(0,i.addToast)({title:"Blob of audio not found",color:"danger"})),e){let t=URL.createObjectURL(e),r=new Audio(t);r.play(),r.onended=()=>{URL.revokeObjectURL(t)}}}else new Audio(a.audio_path).play()},children:(0,t.jsx)(u.MdPlayCircle,{size:20})})})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-end",children:[(0,t.jsx)(c.Tooltip,{placement:"top",content:"show/hide original",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>z(!P),children:P?(0,t.jsx)(u.MdOutlineKeyboardDoubleArrowUp,{size:20}):(0,t.jsx)(u.MdOutlineKeyboardDoubleArrowDown,{size:20})})}),(0,t.jsx)(c.Tooltip,{placement:"top",content:"delete",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",color:"danger",className:"w-fit h-fit",onPress:async()=>{window.confirm("Are you sure to delete?")&&await l(a)},children:(0,t.jsx)(u.MdDelete,{size:20})})})]})]}),(0,t.jsx)("div",{className:"text-xl text-balance hyphens-auto",children:(0,g.highlightDifferences)(a.original,a.recognized)})]}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-fit gap-1",children:[(0,t.jsx)(c.Tooltip,{placement:"left",content:"move upward",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{s({...a,order_num:a.order_num+1,modified_db:!0})},children:(0,t.jsx)(u.MdArrowUpward,{size:20})})}),(0,t.jsx)("div",{children:a.order_num}),(0,t.jsx)(c.Tooltip,{placement:"left",content:"move downward",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:()=>{s({...a,order_num:a.order_num-1,modified_db:!0})},children:(0,t.jsx)(u.MdArrowDownward,{size:20})})})]})]}),P&&(0,t.jsx)("div",{className:"flex flex-row items-center justify-start w-full px-2 pb-1",children:(0,t.jsx)(d.Textarea,{size:"lg",className:"w-full",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:a.original,onChange:e=>{s({...a,original:e.target.value,modified_db:!0})},endContent:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",isDisabled:j,onPress:async()=>{let e="/api/data/tts/".concat(a.uuid,".wav");if(!await fetch(e,{method:"HEAD"}).then(e=>e.ok).catch(()=>!1)){S(!0);let e=await (0,m.callTTS)(a.uuid,a.original);if(S(!1),"error"===e.status)return void console.error(e.error)}new Audio(e).play().catch(e=>console.error("error: ",e))},children:(0,t.jsx)(u.MdPlayCircle,{size:20})})})})]})}var v=e.i(975157),y=e.i(830902),x=e.i(95187),_=(0,x.createServerReference)("40a0e03ed6ce8f3d9d213564ebed60470d4fee4b5b",x.callServer,void 0,x.findSourceMapURL,"getSentenceAll"),w=(0,x.createServerReference)("40ce3cd80363d66f4fcc3edc2b1ac679783d66efca",x.callServer,void 0,x.findSourceMapURL,"removeSentence"),j=(0,x.createServerReference)("40f21d31373b3f79f227511ce08c685fc125bf15bb",x.callServer,void 0,x.findSourceMapURL,"saveSentence"),S=e.i(662549),P=e.i(682455),z=e.i(953220);function D(e){let{email:c}=e,[m,x]=(0,r.useState)(""),[D,R]=(0,r.useState)(""),[B,N]=(0,r.useState)("local"),[k,C]=(0,r.useState)([]),[I,M]=(0,r.useState)(!1),[T,O]=(0,r.useState)(!1),[A,F]=(0,r.useState)(),[E,L]=(0,a.useImmer)([]),[U,W]=(0,r.useState)(!1),[K,H]=(0,r.useState)(!1),[V,Z]=(0,r.useState)(!1),[q,G]=(0,r.useState)(!1),J=(0,r.useMemo)(()=>E.slice().reverse(),[E]),X=async e=>{H(!0);let t=await _(e);if("success"===t.status){let e=t.data.map((e,t)=>(e.order_num!==t+1&&W(!0),{...(0,v.toExactType)(e),order_num:t+1,in_db:!0,on_fs:!0,modified_db:e.order_num!==t+1,modified_fs:!1}));L(t=>{for(let r of(t.length=0,e))t.push(r)})}H(!1)},Q=e=>{L(t=>{let r=t.findIndex(t=>t.uuid===e.uuid);if(-1!==r){if(t[r].order_num!==e.order_num){t.splice(r,1);let a=Math.max(0,Math.min(t.length,e.order_num-1));t.splice(a,0,{...e})}else t[r]={...e};t.forEach((e,t)=>{e.modified_db||e.order_num===t+1||(e.modified_db=e.order_num!==t+1),e.order_num=t+1})}}),W(!0)},Y=async e=>{if(e.modified_fs&&(await (0,p.deleteBlobFromIndexedDB)(e.uuid),(0,h.dropWeakCache)(e.uuid)),e.on_fs){let t=await (0,P.removeAudio)("reading","".concat(e.uuid,".wav"));if("success"!==t.status){console.log(t.error),(0,i.addToast)({title:"remove data error",color:"danger"});return}}if(e.in_db){let t=await w(e.uuid);if("success"!==t.status){console.log(t.error),(0,i.addToast)({title:"remove data error",color:"danger"});return}}L(t=>{let r=t.findIndex(t=>t.uuid===e.uuid);-1!==r&&t.splice(r,1),t.forEach((e,t)=>{e.modified_db||e.order_num===t+1||(e.modified_db=e.order_num!==t+1),e.order_num=t+1,e.order_num=t+1})}),W(!0),(0,i.addToast)({title:"remove data success",color:"success"})},$=async()=>{if(!A)return;Z(!0);let e=(0,h.getBlobFromWeakCache)(A.uuid);if(e||(e=await (0,p.getBlobFromIndexedDB)(A.uuid)),!e){(0,i.addToast)({title:"Blob of audio not found",color:"danger"}),Z(!1);return}let t=await (0,z.saveAudio)(e,"reading","".concat(A.uuid,".wav"));if("success"===t.status)await (0,p.deleteBlobFromIndexedDB)(A.uuid),(0,h.dropWeakCache)(A.uuid);else{console.log(t.error),(0,i.addToast)({title:"save data error",color:"danger"}),Z(!1);return}let r=await j({uuid:A.uuid,chapter_uuid:A.chapter_uuid,order_num:A.order_num,original:A.original,recognized:A.recognized,audio_path:"/api/data/reading/".concat(A.uuid,".wav"),created_by:c,created_at:A.created_at||new Date,updated_at:new Date});if("error"===r.status){console.log(r.error),(0,i.addToast)({title:"save data error",color:"danger"}),Z(!1);return}L(e=>{e.push({...A,in_db:!0,on_fs:!0,modified_db:!1,modified_fs:!1})}),F(void 0),(0,i.addToast)({title:"save data success",color:"success"}),Z(!1)},ee=async()=>{Z(!0);try{for(let e of E){if(e.modified_fs){let t=(0,h.getBlobFromWeakCache)(e.uuid);if(t||(t=await (0,p.getBlobFromIndexedDB)(e.uuid)),!t)throw Error("".concat(e.order_num,": Blob of audio not found"));let r=await (0,z.saveAudio)(t,"reading","".concat(e.uuid,".wav"));if("success"===r.status)await (0,p.deleteBlobFromIndexedDB)(e.uuid),(0,h.dropWeakCache)(e.uuid),L(t=>{let r=t.find(t=>t.uuid===e.uuid);r&&(r.on_fs=!0,r.modified_fs=!1)});else throw Error("".concat(e.order_num,": save audio failed"))}let t=await j({uuid:e.uuid,chapter_uuid:e.chapter_uuid,order_num:e.order_num,original:e.original,recognized:e.recognized,audio_path:e.audio_path,created_by:c,created_at:e.created_at||new Date,updated_at:new Date});if("error"===t.status)throw Error("save sentence failed");L(t=>{let r=t.find(t=>t.uuid===e.uuid);r&&(r.in_db=!0,r.modified_db=!1)})}W(!1),(0,i.addToast)({title:"save data success",color:"success"})}catch(e){console.log(e),(0,i.addToast)({title:"save data error",color:"danger"})}Z(!1)},et=async()=>{let e=async(e,t)=>{let r=(0,v.getUUID)();await (0,p.saveBlobToIndexedDB)(r,t),(0,h.cacheBlobInMemory)(r,t),F({uuid:r,chapter_uuid:D,order_num:E.length+1,original:"success"===e.status?e.data:"",recognized:"success"===e.status?e.data:"",audio_path:"/api/data/reading/".concat(r,".wav"),in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}),"error"===e.status&&(0,i.addToast)({title:e.error,color:"danger"})};await (0,f.toggleRecording)({mode:"audio",stateRecorder:k,setStateRecorder:C,stateRecording:I,setStateRecording:M,recognize:!0,sttEngine:B,setStateProcessing:O,handleAudio:e})};return(0,r.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"a"===e.key){e.preventDefault();let t=document.getElementById("button-toggel-recording");null==t||t.click()}if(e.ctrlKey&&"s"===e.key){e.preventDefault();let t=document.getElementById("button-add-save");null==t||t.click()}};return document.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[I,T]),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-end w-full gap-4",children:(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",onPress:()=>G(!q),children:(0,t.jsx)(u.MdChromeReaderMode,{size:24})})}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 my-4",children:[(0,t.jsx)(y.default,{user_id:c,onSelect:async e=>{x(e)}}),(0,t.jsx)(S.default,{user_id:c,book_uuid:m,onSelect:async e=>{R(e),F(void 0),W(!1),await X(e)}})]}),(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 my-4",children:[(0,t.jsx)(o.Select,{"aria-label":"stt engine",className:"max-w-sm",selectedKeys:[B],onChange:e=>N(e.target.value),startContent:(0,t.jsx)("div",{className:"whitespace-nowrap font-bold",children:"AI Engine"}),children:f.EngineList.map(e=>(0,t.jsx)(s.SelectItem,{textValue:e.value,children:e.value},e.key))}),(0,t.jsx)(n.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!I&&T,onPress:async()=>{m&&D?(A&&F(void 0),await et()):alert("select book and chapter first")},children:I?"â¹ Stop Recording (Ctrl+A)":T?"Processing":"ðŸŽ¤ Read a Sentence (Ctrl+A)"})]}),A&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full gap-2 my-4",children:[(0,t.jsxs)("div",{className:"flex flex-col w-full p-2 rounded-lg bg-sand-300",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-start",children:[(0,t.jsx)("div",{className:"text-md text-gray-400",children:"recognized from audio:"}),(0,t.jsx)(n.Button,{isIconOnly:!0,variant:"light",className:"h-fit",onPress:async()=>{let e=(0,h.getBlobFromWeakCache)(A.uuid);if(e||((e=await (0,p.getBlobFromIndexedDB)(A.uuid))?(0,h.cacheBlobInMemory)(A.uuid,e):(0,i.addToast)({title:"Blob of audio not found",color:"danger"})),e){let t=URL.createObjectURL(e),r=new Audio(t);r.play(),r.onended=()=>{URL.revokeObjectURL(t)}}},children:(0,t.jsx)(u.MdPlayCircle,{size:20})})]}),(0,t.jsx)("div",{className:"text-xl",children:(0,g.highlightDifferences)(A.original,A.recognized)}),(0,t.jsx)(d.Textarea,{size:"lg",className:"w-full",label:"original text",classNames:{inputWrapper:"bg-sand-200",input:"text-xl"},defaultValue:A.original,onChange:e=>F({...A,original:e.target.value})})]}),(0,t.jsx)(n.Button,{variant:"solid",color:"primary",id:"button-add-save",isDisabled:V,onPress:$,children:"Add & Save (Ctrl+S)"})]}),K&&(0,t.jsx)("div",{className:"flex flex-row w-full items-center justify-center gap-4 my-4",children:(0,t.jsx)(l.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"})}),U&&(0,t.jsx)("div",{className:"flex flex-row items-center justify-end my-4 mb-0",children:(0,t.jsx)(n.Button,{variant:"solid",color:"primary",isDisabled:V,onPress:ee,children:"Save"})}),E.length>0&&(0,t.jsx)("div",{className:"flex flex-col w-full gap-4 my-4",children:J.map((e,r)=>(0,t.jsx)(b,{item:e,engine:B,handleUpdate:Q,handleDelete:Y},"".concat(r,"-").concat(e.uuid)))})]})}}]);