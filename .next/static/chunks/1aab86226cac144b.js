(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function a(e,a,s){return a in e?Object.defineProperty(e,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[a]=s,e}e.s(["_",()=>a])},24597,e=>{"use strict";e.s(["Link",()=>g],24597);var a=e.i(84898),s=e.i(79754),t=(0,a.tv)({base:["relative inline-flex items-center outline-solid outline-transparent tap-highlight-transparent",...s.dataFocusVisibleClasses],variants:{size:{sm:"text-small",md:"text-medium",lg:"text-large"},color:{foreground:"text-foreground",primary:"text-primary",secondary:"text-secondary",success:"text-success",warning:"text-warning",danger:"text-danger"},underline:{none:"no-underline",hover:"hover:underline",always:"underline",active:"active:underline",focus:"focus:underline"},isBlock:{true:["px-2","py-1","hover:after:opacity-100","after:content-['']","after:inset-0","after:opacity-0","after:w-full","after:h-full","after:rounded-xl","after:transition-background","after:absolute"],false:"hover:opacity-hover active:opacity-disabled transition-opacity"},isDisabled:{true:"opacity-disabled cursor-default pointer-events-none"},disableAnimation:{true:"after:transition-none transition-none"}},compoundVariants:[{isBlock:!0,color:"foreground",class:"hover:after:bg-foreground/10"},{isBlock:!0,color:"primary",class:"hover:after:bg-primary/20"},{isBlock:!0,color:"secondary",class:"hover:after:bg-secondary/20"},{isBlock:!0,color:"success",class:"hover:after:bg-success/20"},{isBlock:!0,color:"warning",class:"hover:after:bg-warning/20"},{isBlock:!0,color:"danger",class:"hover:after:bg-danger/20"},{underline:["hover","always","active","focus"],class:"underline-offset-4"}],defaultVariants:{color:"primary",size:"md",isBlock:!1,underline:"none",isDisabled:!1}}),r=e.i(69080),i=e.i(50179),l=e.i(11458),o=e.i(49962),n=e.i(43027),d=e.i(73830),c=e.i(95494),u=e.i(20253),f=e.i(29427),m=e.i(75540),v=e.i(71645),x=e.i(43476),p=e=>(0,x.jsxs)("svg",{"aria-hidden":"true",fill:"none",focusable:"false",height:"1em",shapeRendering:"geometricPrecision",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",viewBox:"0 0 24 24",width:"1em",...e,children:[(0,x.jsx)("path",{d:"M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"}),(0,x.jsx)("path",{d:"M15 3h6v6"}),(0,x.jsx)("path",{d:"M10 14L21 3"})]}),h=(0,d.forwardRef)((e,a)=>{let{Component:s,children:h,showAnchorIcon:g,anchorIcon:b=(0,x.jsx)(p,{className:"flex mx-1 text-current self-center"}),getLinkProps:j}=function(e){var a,s,x,p;let h=(0,c.useProviderContext)(),[g,b]=(0,d.mapPropsVariants)(e,t.variantKeys),{ref:j,as:w,children:y,anchorIcon:S,isExternal:k=!1,showAnchorIcon:B=!1,autoFocus:_=!1,className:R,onPress:P,onPressStart:z,onPressEnd:N,onClick:D,...M}=g,L=(0,u.useDOMRef)(j),U=null!=(s=null!=(a=null==e?void 0:e.disableAnimation)?a:null==h?void 0:h.disableAnimation)&&s,{linkProps:C}=function(e,a){let{elementType:s="a",onPress:t,onPressStart:d,onPressEnd:c,onClick:u,isDisabled:f,...m}=e,v={};"a"!==s&&(v={role:"link",tabIndex:f?void 0:0});let{focusableProps:x}=(0,o.useFocusable)(e,a),{pressProps:p,isPressed:h}=(0,n.usePress)({onClick:u,onPress:t,onPressStart:d,onPressEnd:c,isDisabled:f,ref:a}),g=(0,r.filterDOMProps)(m,{labelable:!0,isLink:"a"===s}),b=(0,i.mergeProps)(x,p),j=(0,l.useRouter)(),w=(0,l.useLinkProps)(e);return{isPressed:h,linkProps:(0,i.mergeProps)(g,w,{...b,...v,"aria-disabled":f||void 0,"aria-current":e["aria-current"],onClick:a=>{var s;null==(s=p.onClick)||s.call(p,a),(0,l.handleLinkClick)(a,j,e.href,e.routerOptions)}})}}({...M,onPress:P,onPressStart:z,onPressEnd:N,onClick:D,isDisabled:e.isDisabled,elementType:"".concat(w)},L),{isFocused:I,isFocusVisible:O,focusProps:T}=(0,f.useFocusRing)({autoFocus:_});k&&(M.rel=null!=(x=M.rel)?x:"noopener noreferrer",M.target=null!=(p=M.target)?p:"_blank");let A=(0,v.useMemo)(()=>t({...b,disableAnimation:U,className:R}),[(0,m.objectToDeps)(b),U,R]);return{Component:w||"a",children:y,anchorIcon:S,showAnchorIcon:B,getLinkProps:(0,v.useCallback)(()=>({ref:L,className:A,"data-focus":(0,m.dataAttr)(I),"data-disabled":(0,m.dataAttr)(e.isDisabled),"data-focus-visible":(0,m.dataAttr)(O),...(0,m.mergeProps)(T,C,M)}),[A,I,O,T,C,M])}}({ref:a,...e});return(0,x.jsx)(s,{...j(),children:(0,x.jsxs)(x.Fragment,{children:[h,g&&b]})})});h.displayName="HeroUI.Link";var g=h},75717,e=>{"use strict";e.s(["removeBook",()=>s]);var a=e.i(95187),s=(0,a.createServerReference)("40014a58fd31256c28afdd74d6ccf15d0d1ac81d60",a.callServer,void 0,a.findSourceMapURL,"removeBook")},66753,e=>{"use strict";e.s(["saveBook",()=>s]);var a=e.i(95187),s=(0,a.createServerReference)("400b8c672a5383d645426d252514b30bdf0e0b3409",a.callServer,void 0,a.findSourceMapURL,"saveBook")},22980,e=>{"use strict";e.s(["default",()=>P],22980);var a=e.i(43476),s=e.i(71645),t=e.i(35889),r=e.i(12041),i=e.i(212),l=e.i(24597),o=e.i(64925),n=e.i(73665),d=e.i(71508),c=e.i(70319);function u(e){let{rsp:r,onUpdate:u,onDelete:f}=e,[m,v]=(0,s.useState)(!1),[x,p]=s.default.useState(!1),[h,g]=(0,s.useState)(r.original),[b,j]=(0,s.useState)(!1),w=(0,s.useRef)([]),y=(0,s.useRef)(null);return(0,a.jsxs)("div",{className:"flex flex-col w-full gap-2 p-2 bg-sand-300",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,a.jsx)(o.Tooltip,{placement:"right",content:"original text, should be corrected",children:(0,a.jsx)(n.MdHelpOutline,{size:24})}),b?(0,a.jsx)(i.Input,{size:"lg",className:"w-full",onValueChange:e=>{g(e),u(r.uuid,e,"",null)},value:h}):(0,a.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:h}),(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(o.Tooltip,{content:b?"done":"edit",children:(0,a.jsx)(t.Button,{isIconOnly:!0,variant:"light",onPress:()=>j(!b),children:b?(0,a.jsx)(n.MdDone,{size:30}):(0,a.jsx)(n.MdEdit,{size:30})})}),(0,a.jsx)(o.Tooltip,{content:"delete",children:(0,a.jsx)(t.Button,{isIconOnly:!0,variant:"light",onPress:()=>f(r.uuid),children:(0,a.jsx)(n.MdDelete,{size:30})})})]})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 w-full",children:[(0,a.jsx)(o.Tooltip,{placement:"right",content:"recognised from audio",children:(0,a.jsx)(n.MdHelpOutline,{size:24})}),(0,a.jsx)("div",{className:"flex-grow whitespace-normal break-words text-2xl",children:r.recognized}),(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsx)(o.Tooltip,{placement:"bottom",content:"re-record",children:(0,a.jsx)(t.Button,{isIconOnly:!0,variant:"light",isDisabled:!m&&x,onPress:()=>{(0,d.toggleRecording)(m,v,w,y,!0,p,e=>{console.log(e)},(e,a)=>{"success"===e.status?u(r.uuid,"",e.data,a):c.toast.error(e.error)})},children:m?(0,a.jsx)(n.MdMic,{size:30}):(0,a.jsx)(n.MdMicOff,{size:30})})}),(0,a.jsx)(o.Tooltip,{placement:"bottom",content:"play audio",children:(0,a.jsx)(t.Button,{isIconOnly:!0,variant:"light",onPress:()=>{new Audio(r.audioBlob?URL.createObjectURL(r.audioBlob):r.audio_path).play()},children:(0,a.jsx)(n.MdPlayCircle,{size:30})})}),(0,a.jsx)(o.Tooltip,{placement:"bottom",content:"download audio",children:(0,a.jsx)(t.Button,{isIconOnly:!0,variant:"light",as:l.Link,href:r.audioBlob?URL.createObjectURL(r.audioBlob):r.audio_path,download:"reading_".concat(r.uuid,".wav"),children:(0,a.jsx)(n.MdDownloadForOffline,{size:30})})})]})]}),(r.modified_db||r.modified_fs)&&(0,a.jsx)("div",{className:"text-red-500",children:"unsaved"})]})}var f=e.i(75157),m=e.i(95187),v=(0,m.createServerReference)("404bf7b2307228a423d14e9c7673e6d5addebaea75",m.callServer,void 0,m.findSourceMapURL,"getBookAll"),x=e.i(75717),p=e.i(66753),h=e.i(56124),g=e.i(76220);function b(e){let{user_id:r,onSelect:l}=e,[o,n]=(0,s.useState)([]),[d,u]=(0,s.useState)(""),[m,b]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),y=async()=>{let e=await v(r);"success"===e.status&&n(e.data)},S=async()=>{if(!r)return void c.toast.error("not logged in");w(!0),"success"===(await (0,p.saveBook)({uuid:(0,f.getUUID)(),user_id:r,name:d,created_by:r,created_at:new Date,updated_at:new Date})).status?(c.toast.success("save book success"),u("")):c.toast.error("save book failed"),w(!1)},k=async e=>{w(!0),"success"===(await (0,x.removeBook)(e)).status?c.toast.success("delete book success"):c.toast.error("delete book failed"),w(!1)};return(0,s.useEffect)(()=>{y()},[d]),(0,a.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,a.jsx)(h.Select,{label:"Select book",onChange:async e=>{let a=e.target.value;await l(a)},children:o.map(e=>(0,a.jsx)(g.SelectItem,{textValue:e.name,children:e.name},e.uuid))}),(0,a.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:()=>b(!m),children:m?"finish":"edit"}),(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:y,children:"refresh"})]}),m&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,a.jsx)(i.Input,{label:"Name of Book",size:"sm",onChange:e=>u(e.target.value)}),(0,a.jsx)(t.Button,{size:"sm",radius:"full",isDisabled:j,onPress:S,children:"add"})]}),o.map(e=>(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start px-2 gap-2 bg-sand-300",children:[e.name,(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:()=>k(e.uuid),children:"delete"})]},e.uuid))]})]})}var j=(0,m.createServerReference)("401ce1d186071dfc33e6ed3c3d0f8d3fc2009ce44d",m.callServer,void 0,m.findSourceMapURL,"getSentenceAll"),w=(0,m.createServerReference)("40a8c0842dd459741d3b3c9caeca940515e565152b",m.callServer,void 0,m.findSourceMapURL,"saveSentence"),y=(0,m.createServerReference)("40f642efbe313a1e69a8823eceb17818ebf8a7b08e",m.callServer,void 0,m.findSourceMapURL,"getChapterAll"),S=(0,m.createServerReference)("4099a3ea4795b55790f5eb864e5002ff1d37b1a24f",m.callServer,void 0,m.findSourceMapURL,"removeChapter"),k=(0,m.createServerReference)("408c32c88857ee1d19d33dbca0ace3948040b804e6",m.callServer,void 0,m.findSourceMapURL,"saveChapter");function B(e){let{user_id:r,book_uuid:l,onSelect:o}=e,[n,d]=(0,s.useState)([]),[u,m]=(0,s.useState)(""),[v,x]=(0,s.useState)(""),[p,b]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),B=async()=>{let e=await y(l);"success"===e.status&&d(e.data)},_=async()=>r?l?void(w(!0),"success"===(await k({uuid:(0,f.getUUID)(),book_uuid:l,order_num:parseInt(u,10),name:v,created_by:r,created_at:new Date,updated_at:new Date})).status?(c.toast.success("save chapter success"),x("")):c.toast.error("save chapter failed"),w(!1)):void c.toast.error("no book selected"):void c.toast.error("not logged in"),R=async e=>{w(!0),"success"===(await S(e)).status?c.toast.success("delete chapter success"):c.toast.error("delete chapter failed"),w(!1)};return(0,s.useEffect)(()=>{B()},[l,v]),(0,a.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,a.jsx)(h.Select,{label:"Select chapter",onChange:async e=>{let a=e.target.value;await o(a)},children:n.map(e=>(0,a.jsxs)(g.SelectItem,{textValue:"".concat(e.order_num,", ").concat(e.name),children:[e.order_num,", ",e.name]},e.uuid))}),(0,a.jsxs)("div",{className:"flex flex-row gap-1",children:[(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:()=>b(!p),children:p?"finish":"edit"}),(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:B,children:"refresh"})]}),p&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 w-full",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2",children:[(0,a.jsx)(i.Input,{label:"Order",type:"number",size:"sm",className:"w-1/5",onChange:e=>m(e.target.value)}),(0,a.jsx)(i.Input,{label:"Name of Book",size:"sm",onChange:e=>x(e.target.value)}),(0,a.jsx)(t.Button,{size:"sm",radius:"full",isDisabled:j,onPress:_,children:"add"})]}),n.map(e=>(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start gap-2 bg-sand-300",children:[e.order_num," - ",e.name,(0,a.jsx)(t.Button,{size:"sm",radius:"full",onPress:()=>R(e.uuid),children:"delete"})]},e.uuid))]})]})}var _=e.i(6787),R=(0,m.createServerReference)("70456b0e211f7e701155e4b9d7697547f0cd7c8d23",m.callServer,void 0,m.findSourceMapURL,"saveAudio");function P(e){let{email:i}=e,[l,o]=(0,s.useState)(""),[n,m]=(0,s.useState)(""),[v,x]=(0,s.useState)(!1),[p,h]=s.default.useState(!1),[g,y]=(0,s.useState)([]),[S,k]=s.default.useState(!1),[P,z]=s.default.useState(!1),N=(0,s.useRef)([]),D=(0,s.useRef)(null),M=async e=>{z(!0);let a=await j(e);"success"===a.status&&y(a.data.map(e=>({...(0,f.toExactType)(e),modified_db:!1,modified_fs:!1}))),z(!1)},L=(e,a,s,t)=>{y(r=>r.map(r=>r.uuid===e?{...r,original:a||r.original,recognized:s||r.recognized,audioBlob:t||r.audioBlob,modified_db:!!a,modified_fs:!!t}:r))},U=e=>{y(a=>a.filter(a=>a.uuid!==e))},C=async()=>{try{await Promise.all(g.map(async(e,a)=>{if(e.modified_fs&&e.audioBlob){let a=await R(e.audioBlob,"reading","".concat(e.uuid,".wav"));if("error"===a.status)throw Error("save audio failed");y(a=>a.map(a=>a.uuid===e.uuid?{...a,modified_fs:!1}:a))}if(e.modified_db){let s=await w({uuid:e.uuid,chapter_uuid:n,order_num:a,original:e.original,recognized:e.recognized,audio_path:"/api/data/reading/".concat(e.uuid,".wav"),created_by:i,created_at:e.created_at||new Date,updated_at:new Date});if("error"===s.status)throw Error("save sentence failed");y(a=>a.map(a=>a.uuid===e.uuid?{...a,modified_db:!1}:a))}return!0})),c.toast.success("All sentences saved successfully!")}catch(e){c.toast.error(e.message||"Failed to save sentences")}},I=async()=>{k(await (0,_.checkSTTServiceStatus)())};return(0,s.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"y"===e.key){e.preventDefault();let a=document.getElementById("button-toggel-recording");null==a||a.click()}};document.addEventListener("keydown",e),I();let a=setInterval(I,3e4);return()=>{clearInterval(a),window.removeEventListener("keydown",e)}},[v,p]),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-row gap-4 my-2",children:(0,a.jsxs)(t.Button,{size:"sm",variant:"solid",color:S?"success":"danger",onPress:I,children:["Speech-to-Text service is ",S?"available":"not available",", click to refresh"]})}),(0,a.jsxs)("div",{className:"flex flex-row gap-4 my-2",children:[(0,a.jsx)(b,{user_id:i,onSelect:async e=>{o(e)}}),(0,a.jsx)(B,{user_id:i,book_uuid:l,onSelect:async e=>{m(e),await M(e)}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-center gap-4 my-2",children:[(0,a.jsx)(t.Button,{variant:"solid",color:"primary",id:"button-toggel-recording",isDisabled:!v&&p,onPress:()=>{l&&n?(0,d.toggleRecording)(v,x,N,D,S,h,e=>{console.log(e)},(e,a)=>{"success"===e.status?y(s=>[...s,{uuid:(0,f.getUUID)(),chapter_uuid:"",order_num:g.length,original:e.data,recognized:e.data,audioBlob:a,modified_db:!0,modified_fs:!0}]):c.toast.error(e.error)}):alert("select book and chapter first")},children:v?"â¹ Stop Recording (Ctrl+Y)":"ðŸŽ¤ Speak a Sentence (Ctrl+Y)"}),(0,a.jsx)(t.Button,{variant:"solid",color:"primary",onPress:C,children:"save all sentences"})]}),P&&(0,a.jsx)(r.Spinner,{classNames:{label:"text-foreground mt-4"},variant:"simple"}),g.length>0&&(0,a.jsx)("div",{className:"flex flex-col items-start justify-start w-full gap-2 my-8",children:[...g].reverse().map(e=>(0,a.jsx)(u,{rsp:e,onUpdate:L,onDelete:U},e.uuid))})]})}},75977,e=>{e.v(a=>Promise.all(["static/chunks/1301d5d9c51b8254.js"].map(a=>e.l(a))).then(()=>a(40588)))}]);