(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.s(["_",()=>t])},20738,e=>{"use strict";e.s(["cacheBlobInMemory",()=>s,"dropWeakCache",()=>a,"getBlobFromWeakCache",()=>o]);let t=new Map,r=new FinalizationRegistry(e=>{t.delete(e)});function s(e,s){if("undefined"==typeof WeakRef)return;let o=new WeakRef(s);t.set(e,o);try{r.register(s,e,s)}catch(e){console.log(e)}}function o(e){let r=t.get(e);if(!r)return null;let s=r.deref();return s||(t.delete(e),null)}function a(e){t.delete(e)}},73101,e=>{"use strict";e.s(["deleteBlobFromIndexedDB",()=>a,"getBlobFromIndexedDB",()=>o,"saveBlobToIndexedDB",()=>s]);let t="blobs";function r(){return new Promise((e,r)=>{let s=indexedDB.open("audio-store",1);s.onupgradeneeded=e=>{let r=e.target.result;r.objectStoreNames.contains(t)||r.createObjectStore(t,{keyPath:"uuid"})},s.onsuccess=()=>{e(s.result)},s.onerror=()=>{r(s.error)}})}async function s(e,s){let o=await r();return new Promise((r,a)=>{let n=o.transaction(t,"readwrite").objectStore(t),i={uuid:e,audioBlob:s,createdAt:Date.now()},c=n.put(i);c.onsuccess=()=>r(),c.onerror=()=>a(c.error)})}async function o(e){let s=await r();return new Promise((r,o)=>{let a=s.transaction(t,"readonly").objectStore(t).get(e);a.onsuccess=()=>{let e=a.result;r(e?e.audioBlob:null)},a.onerror=()=>o(a.error)})}async function a(e){let s=await r();return new Promise((r,o)=>{let a=s.transaction(t,"readwrite").objectStore(t).delete(e);a.onsuccess=()=>r(),a.onerror=()=>o(a.error)})}},91959,e=>{"use strict";e.s(["saveAudio",()=>r]);var t=e.i(95187),r=(0,t.createServerReference)("70b4bf8671f483e4771bd0170223c539632f30f2a4",t.callServer,void 0,t.findSourceMapURL,"saveAudio")},64453,e=>{"use strict";e.s(["saveAudioDB",()=>r]);var t=e.i(95187),r=(0,t.createServerReference)("40f38c83127dafdb8b1209bc563406fd7736c7e714",t.callServer,void 0,t.findSourceMapURL,"saveAudioDB")},22011,e=>{"use strict";e.s(["default",()=>u]);var t=e.i(43476),r=e.i(75157),s=e.i(35889),o=e.i(56124),a=e.i(76220),n=e.i(71645),i=e.i(70319);e.i(64453);var c=e.i(20738),l=e.i(73101);e.i(91959);var d=e.i(71508);function u(e){let{uuid:u,user_id:f}=e,[b,m]=(0,n.useState)(!1),[v,g]=(0,n.useState)("local"),[x,y]=(0,n.useState)(),[j,S]=(0,n.useState)([]),[p,w]=(0,n.useState)(!1),[h,B]=(0,n.useState)(!1),[R,I]=(0,n.useState)(),[U,D]=(0,n.useState)(""),[P,A]=(0,n.useState)(""),N=(0,n.useRef)(null),_=async()=>{D(""),A("");let e=async e=>{let t=(0,r.getUUID)();await (0,l.saveBlobToIndexedDB)(t,e),(0,c.cacheBlobInMemory)(t,e),D(URL.createObjectURL(e))},t=async(e,t)=>{let s=(0,r.getUUID)();console.log(s),await (0,l.saveBlobToIndexedDB)(s,t),(0,c.cacheBlobInMemory)(s,t),A(URL.createObjectURL(t)),I({uuid:s,user_id:f,text_uuid:u,recognized:"success"===e.status?e.data:"",audio_path:"/api/data/video/".concat(s,".mp4"),in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}),"error"===e.status&&i.toast.error(e.error)};await (0,d.toggleRecording)({mode:"video",setStateStream:y,stateRecorder:j,setStateRecorder:S,stateRecording:p,setStateRecording:w,recognize:!0,sttEngine:v,setStateProcessing:B,handleVideo:e,handleAudio:t})};return(0,n.useEffect)(()=>{N.current&&x&&(N.current.srcObject=x)},[N,x]),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full my-10",children:[(0,t.jsxs)("div",{className:"flex flex-row justify-between items-center gap-2 mb-4",children:[(0,t.jsx)(o.Select,{"aria-label":"stt engine",className:"max-w-sm",selectedKeys:[v],onChange:e=>g(e.target.value),startContent:(0,t.jsx)("div",{className:"whitespace-nowrap font-bold",children:"AI Engine"}),children:d.EngineList.map(e=>(0,t.jsx)(a.SelectItem,{textValue:e.value,children:e.value},e.key))}),(0,t.jsx)(s.Button,{color:"primary",size:"sm",onPress:_,children:p?"Stop":"Start"})]}),p&&(0,t.jsx)("video",{ref:N,autoPlay:!0,muted:!0,playsInline:!0}),!p&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[!!U&&(0,t.jsx)("video",{controls:!0,src:U}),!!P&&(0,t.jsx)("audio",{controls:!0,src:P})]}),(0,t.jsxs)("div",{className:"mt-4 text-sm text-gray-700",children:[h&&"正在识别语音…",(null==R?void 0:R.recognized)&&(0,t.jsx)("div",{className:"p-2 border rounded-md bg-gray-50 mt-2",children:R.recognized})]})]})}}]);