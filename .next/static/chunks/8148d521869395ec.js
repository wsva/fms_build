(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,99749,e=>{"use strict";function t(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}e.s(["_",()=>t])},20738,e=>{"use strict";e.s(["cacheBlobInMemory",()=>a,"dropWeakCache",()=>o,"getBlobFromWeakCache",()=>s]);let t=new Map,r=new FinalizationRegistry(e=>{t.delete(e)});function a(e,a){if("undefined"==typeof WeakRef)return;let s=new WeakRef(a);t.set(e,s);try{r.register(a,e,a)}catch(e){console.log(e)}}function s(e){let r=t.get(e);if(!r)return null;let a=r.deref();return a||(t.delete(e),null)}function o(e){t.delete(e)}},73101,e=>{"use strict";e.s(["deleteBlobFromIndexedDB",()=>o,"getBlobFromIndexedDB",()=>s,"saveBlobToIndexedDB",()=>a]);let t="blobs";function r(){return new Promise((e,r)=>{let a=indexedDB.open("audio-store",1);a.onupgradeneeded=e=>{let r=e.target.result;r.objectStoreNames.contains(t)||r.createObjectStore(t,{keyPath:"uuid"})},a.onsuccess=()=>{e(a.result)},a.onerror=()=>{r(a.error)}})}async function a(e,a){let s=await r();return new Promise((r,o)=>{let n=s.transaction(t,"readwrite").objectStore(t),i={uuid:e,audioBlob:a,createdAt:Date.now()},c=n.put(i);c.onsuccess=()=>r(),c.onerror=()=>o(c.error)})}async function s(e){let a=await r();return new Promise((r,s)=>{let o=a.transaction(t,"readonly").objectStore(t).get(e);o.onsuccess=()=>{let e=o.result;r(e?e.audioBlob:null)},o.onerror=()=>s(o.error)})}async function o(e){let a=await r();return new Promise((r,s)=>{let o=a.transaction(t,"readwrite").objectStore(t).delete(e);o.onsuccess=()=>r(),o.onerror=()=>s(o.error)})}},78931,e=>{"use strict";e.s(["saveAudio",()=>r]);var t=e.i(95187),r=(0,t.createServerReference)("70ec0a72725d1a4e70d13842721c16e53e3ea012cf",t.callServer,void 0,t.findSourceMapURL,"saveAudio")},59802,e=>{"use strict";e.s(["saveAudioDB",()=>r]);var t=e.i(95187),r=(0,t.createServerReference)("40507bc2c63e109f2fc2b686f32bda2431e1fa758a",t.callServer,void 0,t.findSourceMapURL,"saveAudioDB")},22011,e=>{"use strict";e.s(["default",()=>d]);var t=e.i(43476),r=e.i(75157),a=e.i(35889),s=e.i(56124),o=e.i(76220),n=e.i(71645),i=e.i(70319);e.i(59802);var c=e.i(20738),l=e.i(73101);e.i(78931);var u=e.i(71508);function d(e){let{uuid:d,user_id:f}=e,[m,b]=(0,n.useState)(!1),[v,g]=(0,n.useState)("local"),[x,y]=(0,n.useState)(),[j,S]=(0,n.useState)([]),[p,w]=(0,n.useState)(!1),[h,B]=(0,n.useState)(!1),[R,I]=(0,n.useState)(),[U,D]=(0,n.useState)(""),[P,A]=(0,n.useState)(""),N=(0,n.useRef)(null),_=async()=>{D(""),A("");let e=async e=>{let t=(0,r.getUUID)();await (0,l.saveBlobToIndexedDB)(t,e),(0,c.cacheBlobInMemory)(t,e),D(URL.createObjectURL(e))},t=async(e,t)=>{let a=(0,r.getUUID)();console.log(a),await (0,l.saveBlobToIndexedDB)(a,t),(0,c.cacheBlobInMemory)(a,t),A(URL.createObjectURL(t)),I({uuid:a,user_id:f,text_uuid:d,recognized:"success"===e.status?e.data:"",audio_path:"/api/data/video/".concat(a,".mp4"),in_db:!1,on_fs:!1,modified_db:!0,modified_fs:!0}),"error"===e.status&&i.toast.error(e.error)};await (0,u.toggleRecording)({mode:"video",setStateStream:y,stateRecorder:j,setStateRecorder:S,stateRecording:p,setStateRecording:w,recognize:!0,sttEngine:v,setStateProcessing:B,handleVideo:e,handleAudio:t})};return(0,n.useEffect)(()=>{N.current&&x&&(N.current.srcObject=x)},[N,x]),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full my-10",children:[(0,t.jsxs)("div",{className:"flex flex-row justify-between items-center gap-2 mb-4",children:[(0,t.jsx)(s.Select,{"aria-label":"stt engine",className:"max-w-sm",selectedKeys:[v],onChange:e=>g(e.target.value),startContent:(0,t.jsx)("div",{className:"whitespace-nowrap font-bold",children:"AI Engine"}),children:u.EngineList.map(e=>(0,t.jsx)(o.SelectItem,{textValue:e.value,children:e.value},e.key))}),(0,t.jsx)(a.Button,{color:"primary",size:"sm",onPress:_,children:p?"Stop":"Start"})]}),p&&(0,t.jsx)("video",{ref:N,autoPlay:!0,muted:!0,playsInline:!0}),!p&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4",children:[!!U&&(0,t.jsx)("video",{controls:!0,src:U}),!!P&&(0,t.jsx)("audio",{controls:!0,src:P})]}),(0,t.jsxs)("div",{className:"mt-4 text-sm text-gray-700",children:[h&&"正在识别语音…",(null==R?void 0:R.recognized)&&(0,t.jsx)("div",{className:"p-2 border rounded-md bg-gray-50 mt-2",children:R.recognized})]})]})}}]);